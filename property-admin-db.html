<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç‰©ä»¶ç®¡ç†å¾Œå°ï¼ˆè³‡æ–™åº«ç‰ˆï¼‰| ä½å•†ä¸å‹•ç”¢</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Microsoft JhengHei', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 2rem;
            /* å„ªåŒ–æ»¾å‹•æ€§èƒ½ */
            -webkit-overflow-scrolling: touch;
            will-change: scroll-position;
            /* ç¦ç”¨æ–‡å­—é¸æ“‡ï¼Œé¿å…å¿«é€Ÿæ»¾å‹•æ™‚å‡ºç¾åç™½ */
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
            /* å„ªåŒ–è§¸æ§éŸ¿æ‡‰ */
            -webkit-tap-highlight-color: transparent;
            touch-action: pan-y;
        }
        
        /* å…è¨±è¼¸å…¥æ¡†é¸æ“‡æ–‡å­— */
        input,
        textarea,
        select {
            -webkit-user-select: text;
            -moz-user-select: text;
            -ms-user-select: text;
            user-select: text;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
            /* å„ªåŒ–æ¸²æŸ“æ€§èƒ½ */
            transform: translateZ(0);
            -webkit-transform: translateZ(0);
            /* ç¦ç”¨æ–‡å­—é¸æ“‡ */
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
        }
        
        .header {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 2rem;
            text-align: center;
        }
        
        .header h1 {
            font-size: 2rem;
            margin-bottom: 0.5rem;
        }
        
        .tabs {
            display: flex;
            background: #f8f9fa;
            border-bottom: 2px solid #e9ecef;
        }
        
        .tab {
            flex: 1;
            padding: 1rem;
            text-align: center;
            cursor: pointer;
            background: #f8f9fa;
            border: none;
            font-size: 1rem;
            font-weight: 600;
            color: #666;
            transition: all 0.3s ease;
            /* ç¦ç”¨æ–‡å­—é¸æ“‡ */
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
            /* é˜²æ­¢é»æ“Šæ™‚å‡ºç¾é«˜äº® */
            -webkit-tap-highlight-color: transparent;
        }
        
        .tab.active {
            background: white;
            color: #667eea;
            border-bottom: 3px solid #667eea;
        }
        
        .tab-content {
            display: none;
            padding: 2rem;
            /* å„ªåŒ–é¡¯ç¤ºæ€§èƒ½ */
            contain: layout style paint;
            /* ç¦ç”¨æ–‡å­—é¸æ“‡ï¼Œé¿å…å¿«é€Ÿæ»¾å‹•æ™‚å‡ºç¾åç™½ */
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
            /* å„ªåŒ–æ»¾å‹•æ€§èƒ½ */
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
            /* é˜²æ­¢æ»¾å‹•æ™‚å‡ºç¾é¸å–é«˜äº® */
            -webkit-tap-highlight-color: transparent;
        }
        
        .tab-content.active {
            display: block;
            /* å•Ÿç”¨ç¡¬é«”åŠ é€Ÿ */
            transform: translateZ(0);
            -webkit-transform: translateZ(0);
        }
        
        .form-section {
            margin-bottom: 2rem;
            padding: 1.5rem;
            background: #f8f9fa;
            border-radius: 12px;
            /* å„ªåŒ–æ¸²æŸ“æ€§èƒ½ */
            contain: layout style;
            transform: translateZ(0);
            -webkit-transform: translateZ(0);
            /* ç¦ç”¨æ–‡å­—é¸æ“‡ï¼Œé¿å…å¿«é€Ÿæ»¾å‹•æ™‚å‡ºç¾åç™½ */
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
        }
        
        .form-section h3 {
            color: #667eea;
            margin-bottom: 1rem;
            font-size: 1.3rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1rem;
        }
        
        .form-group {
            display: flex;
            flex-direction: column;
        }
        
        .form-group label {
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: #333;
            font-size: 0.9rem;
            /* å…è¨±æ¨™ç±¤æ–‡å­—å¯é¸ï¼ˆæ–¹ä¾¿è¤‡è£½ï¼‰ */
            -webkit-user-select: text;
            -moz-user-select: text;
            -ms-user-select: text;
            user-select: text;
            /* é˜²æ­¢é»æ“Šæ™‚å‡ºç¾é«˜äº® */
            -webkit-tap-highlight-color: transparent;
        }
        
        .form-group input,
        .form-group select,
        .form-group textarea {
            padding: 0.7rem;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s ease;
        }
        
        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #667eea;
        }
        
        .form-group.full-width {
            grid-column: 1 / -1;
        }
        
        .form-group textarea {
            min-height: 100px;
            resize: vertical;
        }
        
        /* æ¨™ç±¤é¸æ“‡ç³»çµ± */
        .tag-selector-container {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }
        
        .tag-input-wrapper {
            display: flex;
            gap: 0.5rem;
            align-items: center;
        }
        
        .tag-input {
            flex: 1;
            padding: 0.7rem;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s ease;
        }
        
        .tag-input:focus {
            outline: none;
            border-color: #667eea;
        }
        
        .tag-add-btn {
            padding: 0.7rem 1.2rem;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 0.9rem;
            cursor: pointer;
            transition: background 0.3s ease;
            white-space: nowrap;
        }
        
        .tag-add-btn:hover {
            background: #5568d3;
        }
        
        .tag-add-btn:active {
            transform: scale(0.98);
        }
        
        .selected-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            min-height: 2.5rem;
            padding: 0.5rem;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            background: #fff;
        }
        
        .selected-tags:empty::before {
            content: "å°šæœªé¸æ“‡ä»»ä½•é …ç›®";
            color: #adb5bd;
            font-size: 0.9rem;
            font-style: italic;
        }
        
        .selected-tag {
            display: inline-flex;
            align-items: center;
            gap: 0.4rem;
            padding: 0.4rem 0.8rem;
            background: #667eea;
            color: white;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 500;
            animation: tagSlideIn 0.3s ease;
        }
        
        @keyframes tagSlideIn {
            from {
                opacity: 0;
                transform: scale(0.8);
            }
            to {
                opacity: 1;
                transform: scale(1);
            }
        }
        
        .selected-tag .tag-remove {
            cursor: pointer;
            background: rgba(255, 255, 255, 0.3);
            border: none;
            color: white;
            border-radius: 50%;
            width: 18px;
            height: 18px;
            font-size: 0.75rem;
            display: flex;
            align-items: center;
            justify-content: center;
            line-height: 1;
            transition: background 0.2s ease;
            padding: 0;
        }
        
        .selected-tag .tag-remove:hover {
            background: rgba(255, 255, 255, 0.5);
        }
        
        .selected-tag .tag-edit {
            cursor: pointer;
            background: rgba(255, 255, 255, 0.3);
            border: none;
            color: white;
            border-radius: 50%;
            width: 18px;
            height: 18px;
            font-size: 0.7rem;
            display: flex;
            align-items: center;
            justify-content: center;
            line-height: 1;
            transition: background 0.2s ease;
            padding: 0;
            margin-right: 0.2rem;
        }
        
        .selected-tag .tag-edit:hover {
            background: rgba(255, 255, 255, 0.5);
        }
        
        .selected-tag.editing {
            background: #fff;
            color: #333;
            border: 2px solid #667eea;
        }
        
        .selected-tag .tag-edit-input {
            background: transparent;
            border: none;
            color: #333;
            font-size: 0.85rem;
            font-weight: 500;
            padding: 0;
            margin: 0;
            outline: none;
            min-width: 60px;
            max-width: 200px;
        }
        
        .tag-option .tag-option-edit,
        .tag-option .tag-option-delete {
            display: none;
            margin-left: 0.3rem;
            padding: 0.2rem 0.4rem;
            font-size: 0.7rem;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .tag-option:hover .tag-option-edit,
        .tag-option:hover .tag-option-delete {
            display: inline-block;
        }
        
        .tag-option-edit {
            background: #667eea;
            color: white;
            border: none;
        }
        
        .tag-option-edit:hover {
            background: #5568d3;
        }
        
        .tag-option-delete {
            background: #dc3545;
            color: white;
            border: none;
        }
        
        .tag-option-delete:hover {
            background: #c82333;
        }
        
        .tag-option.editing {
            background: #fff3cd;
            border-color: #ffc107;
        }
        
        .tag-option .tag-edit-input {
            background: transparent;
            border: 1px solid #667eea;
            border-radius: 4px;
            padding: 0.2rem 0.4rem;
            font-size: 0.85rem;
            min-width: 80px;
            outline: none;
        }
        
        .tag-options {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            padding: 0.75rem;
            background: #f8f9fa;
            border-radius: 8px;
            max-height: 200px;
            overflow-y: auto;
        }
        
        .tag-option {
            display: inline-flex;
            align-items: center;
            padding: 0.5rem 0.9rem;
            background: white;
            color: #495057;
            border: 2px solid #e9ecef;
            border-radius: 20px;
            font-size: 0.85rem;
            cursor: pointer;
            transition: all 0.2s ease;
            user-select: none;
            -webkit-user-select: none;
            position: relative;
        }
        
        .tag-option-text {
            flex: 1;
        }
        
        .tag-option:hover {
            border-color: #667eea;
            color: #667eea;
            transform: translateY(-2px);
            box-shadow: 0 2px 4px rgba(102, 126, 234, 0.2);
        }
        
        .tag-option.selected {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }
        
        .tag-option.selected:hover {
            background: #5568d3;
        }
        
        /* åœ–ç‰‡ä¸Šå‚³å€åŸŸ */
        .image-upload-area {
            border: 3px dashed #667eea;
            border-radius: 12px;
            padding: 2rem;
            text-align: center;
            background: #f8f9fa;
            cursor: pointer;
            transition: all 0.3s ease;
            /* ç¦ç”¨æ–‡å­—é¸æ“‡ */
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
            /* é˜²æ­¢é»æ“Šæ™‚å‡ºç¾é«˜äº® */
            -webkit-tap-highlight-color: transparent;
        }
        
        .image-upload-area:hover {
            background: #e9ecef;
            border-color: #764ba2;
        }
        
        .image-upload-area.dragover {
            background: #e7f3ff;
            border-color: #667eea;
        }
        
        .image-upload-area input[type="file"] {
            display: none;
        }
        
        .image-upload-icon {
            font-size: 3rem;
            margin-bottom: 1rem;
        }
        
        .image-preview-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
            gap: 0.75rem;
            margin-top: 1.5rem;
            /* å„ªåŒ–ç¶²æ ¼æ¸²æŸ“ */
            contain: layout;
            will-change: contents;
        }
        
        .image-preview-item {
            position: relative;
            border: 2px solid #e9ecef;
            border-radius: 6px;
            overflow: hidden;
            aspect-ratio: 1;
            min-height: 100px;
            background: #f8f9fa;
            /* ç¦ç”¨æ–‡å­—é¸æ“‡ */
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
            /* é˜²æ­¢é»æ“Šæ™‚å‡ºç¾é«˜äº® */
            -webkit-tap-highlight-color: transparent;
        }
        
        .image-preview-item img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            /* å„ªåŒ–åœ–ç‰‡è¼‰å…¥æ€§èƒ½ */
            will-change: transform;
            transform: translateZ(0);
            -webkit-transform: translateZ(0);
            /* ç¦ç”¨åœ–ç‰‡æ‹–æ‹½å’Œé¸æ“‡ */
            -webkit-user-drag: none;
            -khtml-user-drag: none;
            -moz-user-drag: none;
            -o-user-drag: none;
            pointer-events: none; /* é˜²æ­¢åœ–ç‰‡æˆç‚ºé¸å–ç›®æ¨™ */
        }
        
        .image-preview-item .image-remove {
            position: absolute;
            top: 3px;
            right: 3px;
            background: rgba(220, 53, 69, 0.9);
            color: white;
            border: none;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            cursor: pointer;
            font-size: 14px;
            font-weight: bold;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            z-index: 10;
        }
        
        .image-preview-item .image-remove:hover {
            background: #dc3545;
            transform: scale(1.1) translateZ(0);
            -webkit-transform: scale(1.1) translateZ(0);
            /* å„ªåŒ– hover å‹•ç•« */
            will-change: transform;
        }
        
        .image-preview-item .upload-progress {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: #e9ecef;
        }
        
        .image-preview-item .upload-progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #667eea, #764ba2);
            transition: width 0.3s ease;
        }
        
        .btn-group {
            display: flex;
            gap: 1rem;
            margin-top: 2rem;
            padding-top: 2rem;
            border-top: 2px solid #e9ecef;
        }
        
        .btn {
            flex: 1;
            padding: 1rem;
            border: none;
            border-radius: 10px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            /* ç¦ç”¨æ–‡å­—é¸æ“‡ */
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
            /* é˜²æ­¢é»æ“Šæ™‚å‡ºç¾é«˜äº® */
            -webkit-tap-highlight-color: transparent;
        }
        
        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
        }
        
        .btn-primary:hover:not(:disabled) {
            transform: translateY(-2px) translateZ(0);
            -webkit-transform: translateY(-2px) translateZ(0);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
            /* å„ªåŒ– hover å‹•ç•« */
            will-change: transform;
        }
        
        .btn-secondary {
            background: #6c757d;
            color: white;
        }
        
        .btn-success {
            background: #28a745;
            color: white;
        }
        
        .alert {
            padding: 1rem;
            border-radius: 8px;
            margin-bottom: 1rem;
            display: none;
        }
        
        .alert.show {
            display: block;
        }
        
        .alert-success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .alert-error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        /* å„ªåŒ–çš„å½ˆè·³è¦–çª—æ¨£å¼ */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(4px);
            z-index: 10000;
            display: flex;
            justify-content: center;
            align-items: center;
            animation: fadeIn 0.2s ease-out;
        }
        
        .modal-dialog {
            background: white;
            border-radius: 16px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            max-width: 500px;
            width: 90%;
            max-height: 90vh;
            overflow: hidden;
            animation: slideUp 0.3s ease-out;
            position: relative;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(30px) scale(0.95);
            }
            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }
        
        .modal-header {
            padding: 1.5rem;
            border-bottom: 1px solid #e9ecef;
            display: flex;
            align-items: center;
            gap: 1rem;
        }
        
        .modal-icon {
            width: 48px;
            height: 48px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            flex-shrink: 0;
        }
        
        .modal-icon.warning {
            background: #fff3cd;
            color: #856404;
        }
        
        .modal-icon.danger {
            background: #f8d7da;
            color: #721c24;
        }
        
        .modal-title {
            font-size: 1.25rem;
            font-weight: 600;
            color: #333;
            margin: 0;
            flex: 1;
        }
        
        .modal-close {
            background: none;
            border: none;
            font-size: 24px;
            color: #999;
            cursor: pointer;
            padding: 0;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: all 0.2s;
        }
        
        .modal-close:hover {
            background: #f5f5f5;
            color: #333;
        }
        
        .modal-body {
            padding: 1.5rem;
            color: #666;
            line-height: 1.6;
        }
        
        .modal-footer {
            padding: 1rem 1.5rem;
            border-top: 1px solid #e9ecef;
            display: flex;
            gap: 0.75rem;
            justify-content: flex-end;
        }
        
        .modal-btn {
            padding: 0.625rem 1.5rem;
            border: none;
            border-radius: 8px;
            font-size: 0.95rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            min-width: 100px;
        }
        
        .modal-btn-cancel {
            background: #f8f9fa;
            color: #333;
        }
        
        .modal-btn-cancel:hover {
            background: #e9ecef;
        }
        
        .modal-btn-danger {
            background: #dc3545;
            color: white;
        }
        
        .modal-btn-danger:hover {
            background: #c82333;
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(220, 53, 69, 0.3);
        }
        
        .modal-btn-danger:active {
            transform: translateY(0);
        }
        
        @media (max-width: 768px) {
            .modal-dialog {
                width: 95%;
                margin: 1rem;
            }
            
            .modal-header {
                padding: 1.25rem;
            }
            
            .modal-body {
                padding: 1.25rem;
            }
            
            .modal-footer {
                flex-direction: column-reverse;
            }
            
            .modal-btn {
                width: 100%;
            }
        }
        
        .property-list {
            display: grid;
            gap: 1rem;
        }
        
        .property-item {
            background: white;
            border: 2px solid #e9ecef;
            border-radius: 12px;
            padding: 1.5rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .property-item:hover {
            border-color: #667eea;
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.2);
        }
        
        .property-info h4 {
            color: #333;
            margin-bottom: 0.5rem;
        }
        
        .property-info p {
            color: #666;
            font-size: 0.9rem;
        }
        
        .property-actions {
            display: flex;
            gap: 0.5rem;
        }
        
        .btn-small {
            padding: 0.5rem 1rem;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            font-size: 0.9rem;
        }
        
        .config-section {
            background: #fff3cd;
            border: 2px solid #ffc107;
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 2rem;
        }
        
        .config-section h3 {
            color: #856404;
            margin-bottom: 1rem;
        }
        
        .config-section input {
            width: 100%;
            padding: 0.7rem;
            border: 2px solid #ffc107;
            border-radius: 8px;
            font-size: 1rem;
            margin-bottom: 0.5rem;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ  ç‰©ä»¶ç®¡ç†å¾Œå°ï¼ˆè³‡æ–™åº«ç‰ˆï¼‰</h1>
            <p>åœ–ç‰‡ä¸Šå‚³ + è³‡æ–™åº«å„²å­˜ï¼Œç¯€çœæ™‚é–“è¶…æ–¹ä¾¿ï¼</p>
        </div>
        
        <div class="tabs">
            <button class="tab" id="config-tab-button" onclick="switchTab('config', this)">âš™ï¸ API è¨­å®š</button>
            <button class="tab active" onclick="switchTab('add', this)">â• æ–°å¢ç‰©ä»¶</button>
            <button class="tab" onclick="switchTab('list', this)">ğŸ“‹ ç‰©ä»¶åˆ—è¡¨</button>
        </div>
        
        <!-- Supabase è¨­å®š -->
        <div id="config-tab" class="tab-content">
            <div class="config-section">
                <h3>âš™ï¸ Supabase è¨­å®š</h3>
                <div class="form-group">
                    <label>Supabase URL *</label>
                    <input type="text" id="supabase-url" placeholder="https://cnzqtuuegdqwkgvletaa.supabase.co" value="https://cnzqtuuegdqwkgvletaa.supabase.co">
                </div>
                <div class="form-group">
                    <label>Supabase Anon Key *</label>
                    <input type="text" id="supabase-anon-key" placeholder="è¼¸å…¥æ‚¨çš„ Supabase Anon Key" value="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImNuenF0dXVlZ2Rxd2tndmxldGFhIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjgxMjUxMTksImV4cCI6MjA4MzcwMTExOX0.gsO3RKdMu2bUXW4b5aHseouIkjXtJyIqqP_0x3Y6trE">
                </div>
                <p style="color: #856404; font-size: 0.9rem; margin-top: 0.5rem;">
                    ğŸ’¡ <strong>è¨­å®šèªªæ˜ï¼š</strong>è«‹è¼¸å…¥æ‚¨çš„ Supabase å°ˆæ¡ˆè¨­å®šè³‡è¨Š<br>
                    ğŸ’¡ <strong>å–å¾—è¨­å®šï¼š</strong>å‰å¾€ <a href="https://supabase.com/dashboard/project/cnzqtuuegdqwkgvletaa/settings/api" target="_blank">Supabase Dashboard</a> â†’ Settings â†’ API
                </p>
                <div style="margin-top: 1rem; padding: 1rem; background: #e7f3ff; border-radius: 8px; border-left: 4px solid #2196F3;">
                    <h4 style="margin: 0 0 0.5rem 0; color: #1976D2;">ğŸ“ Supabase è¨­å®šèªªæ˜</h4>
                    <ul style="margin: 0; padding-left: 1.5rem; font-size: 0.9rem; color: #424242;">
                        <li><strong>Supabase URLï¼š</strong>æ‚¨çš„ Supabase å°ˆæ¡ˆ URLï¼ˆä¾‹å¦‚ï¼šhttps://cnzqtuuegdqwkgvletaa.supabase.coï¼‰</li>
                        <li><strong>Anon Keyï¼š</strong>å¾ Supabase Dashboard çš„ API è¨­å®šä¸­å–å¾—</li>
                        <li><strong>åœ–ç‰‡ä¸Šå‚³ï¼š</strong>åœ–ç‰‡æœƒè‡ªå‹•ä¸Šå‚³åˆ° Supabase Storage</li>
                        <li><strong>è³‡æ–™å¤¾çµæ§‹ï¼š</strong>æ¯å€‹ç‰©ä»¶çš„åœ–ç‰‡æœƒå„²å­˜åœ¨ <code>junyang666/properties/{ç‰©ä»¶ç·¨è™Ÿ}/</code> è³‡æ–™å¤¾ä¸­</li>
                        <li><strong>ä¸Šæ¶/ä¸‹æ¶ï¼š</strong>ç‰©ä»¶å¯ä»¥è¨­å®šç‚ºä¸Šæ¶ï¼ˆis_published: trueï¼‰æˆ–ä¸‹æ¶ï¼ˆis_published: falseï¼‰ç‹€æ…‹</li>
                    </ul>
                </div>
                <div style="display: flex; gap: 1rem; margin-top: 1rem;">
                    <button class="btn btn-success" onclick="saveSupabaseConfig()" style="flex: 1;">
                        ğŸ’¾ å„²å­˜è¨­å®š
                    </button>
                    <button class="btn btn-primary" onclick="testSupabaseConnection()" style="flex: 1;">
                        ğŸ” æ¸¬è©¦é€£æ¥
                    </button>
                </div>
                <div style="margin-top: 1rem; padding: 1rem; background: #fff3cd; border-radius: 8px; border-left: 4px solid #ffc107;">
                    <p style="margin: 0; font-size: 0.9rem; color: #856404;">
                        ğŸ’¡ <strong>æç¤ºï¼š</strong>è¨­å®šå®Œæˆä¸¦æˆåŠŸé€£æ¥å¾Œï¼Œè¨­å®šæ¨™ç±¤æœƒè‡ªå‹•éš±è—ã€‚å¦‚éœ€é‡æ–°è¨­å®šï¼Œè«‹åˆ·æ–°é é¢ä¸¦æŒ‰ F12 æ‰“é–‹æ§åˆ¶å°ï¼Œè¼¸å…¥ <code>showConfigTab()</code> é‡æ–°é¡¯ç¤ºã€‚
                    </p>
                </div>
                <div id="supabase-status" style="margin-top: 1rem; padding: 1rem; background: #f8f9fa; border-radius: 8px; display: none;">
                    <h4 style="margin: 0 0 0.5rem 0;">ğŸ” é€£æ¥ç‹€æ…‹</h4>
                    <div id="supabase-status-content"></div>
                </div>
            </div>
        </div>
        
        <!-- æ–°å¢ç‰©ä»¶ -->
        <div id="add-tab" class="tab-content active">
            <div id="alert-container"></div>
            
            <form id="property-form">
                <!-- åŸºæœ¬è³‡è¨Š -->
                <div class="form-section">
                    <h3>ğŸ“ åŸºæœ¬è³‡è¨Š</h3>
                    <div class="form-grid">
                        <div class="form-group">
                            <label>ç‰©ä»¶ä¾†æº *</label>
                            <select id="is_external" required onchange="onExternalSourceChange()">
                                <option value="false">ğŸ  æœ¬åº—ç‰©ä»¶</option>
                                <option value="true">ğŸ¢ éæœ¬åº—ç‰©ä»¶ï¼ˆå…¶ä»–æˆ¿ä»²ï¼‰</option>
                            </select>
                            <small style="color: #666; font-size: 0.85rem; margin-top: 0.25rem; display: block;">
                                éæœ¬åº—ç‰©ä»¶å°‡ä½¿ç”¨ç¨ç«‹çš„ç·¨è™Ÿç³»çµ±ï¼Œä¸æœƒèˆ‡æœ¬åº—ç‰©ä»¶ç·¨è™Ÿæ··åœ¨ä¸€èµ·
                            </small>
                        </div>
                        <div class="form-group">
                            <label>ç‰©ä»¶ç·¨è™Ÿ</label>
                            <input type="text" id="number" placeholder="é¸æ“‡æˆ¿å‹å¾Œè‡ªå‹•ç”Ÿæˆ" style="flex: 1;" readonly>
                            <small style="color: #666; font-size: 0.85rem; margin-top: 0.25rem; display: block;">
                                æœ¬åº—ç‰©ä»¶æ ¼å¼ï¼š{æˆ¿å‹ä»£ç¢¼}{åºè™Ÿ}ï¼ˆå¦‚ï¼šSU00001ã€TW00001ï¼‰<br>
                                éæœ¬åº—ç‰©ä»¶æ ¼å¼ï¼šEX{æˆ¿å‹ä»£ç¢¼}{åºè™Ÿ}ï¼ˆå¦‚ï¼šEXSU0001ã€EXTW0001ï¼‰<br>
                                <span style="color: #007bff;">âš ï¸ ç·¨è™Ÿå°‡è‡ªå‹•ç”Ÿæˆï¼Œç„¡éœ€æ‰‹å‹•è¼¸å…¥</span>
                            </small>
                        </div>
                        <div class="form-group">
                            <label>ç‰©ä»¶æ¨™é¡Œ *</label>
                            <input type="text" id="title" placeholder="ä¾‹å¦‚: ä½è‡ªå‚™ | è¿‘é¾ç§‘ | 2æˆ¿+è»Šä½" required>
                        </div>
                        <div class="form-group">
                            <label>æˆ¿å‹ *</label>
                            <select id="type" required onchange="onTypeChange()">
                                <option value="">è«‹é¸æ“‡</option>
                                <option value="å¥—æˆ¿">å¥—æˆ¿</option>
                                <option value="2æˆ¿">2æˆ¿</option>
                                <option value="3æˆ¿">3æˆ¿</option>
                                <option value="4æˆ¿">4æˆ¿</option>
                                <option value="è¯å»ˆ">è¯å»ˆ</option>
                                <option value="å…¬å¯“">å…¬å¯“</option>
                                <option value="é€å¤©">é€å¤©</option>
                                <option value="åº—é¢">åº—é¢</option>
                                <option value="åˆ¥å¢…">åˆ¥å¢…</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>ç¸£å¸‚ *</label>
                            <select id="city" required onchange="updateDistricts()">
                                <option value="">è«‹é¸æ“‡ç¸£å¸‚</option>
                                <option value="æ¡ƒåœ’å¸‚" selected>æ¡ƒåœ’å¸‚</option>
                                <option value="å°åŒ—å¸‚">å°åŒ—å¸‚</option>
                                <option value="æ–°åŒ—å¸‚">æ–°åŒ—å¸‚</option>
                                <option value="å°ä¸­å¸‚">å°ä¸­å¸‚</option>
                                <option value="å°å—å¸‚">å°å—å¸‚</option>
                                <option value="é«˜é›„å¸‚">é«˜é›„å¸‚</option>
                                <option value="åŸºéš†å¸‚">åŸºéš†å¸‚</option>
                                <option value="æ–°ç«¹å¸‚">æ–°ç«¹å¸‚</option>
                                <option value="æ–°ç«¹ç¸£">æ–°ç«¹ç¸£</option>
                                <option value="è‹—æ —ç¸£">è‹—æ —ç¸£</option>
                                <option value="å½°åŒ–ç¸£">å½°åŒ–ç¸£</option>
                                <option value="å—æŠ•ç¸£">å—æŠ•ç¸£</option>
                                <option value="é›²æ—ç¸£">é›²æ—ç¸£</option>
                                <option value="å˜‰ç¾©å¸‚">å˜‰ç¾©å¸‚</option>
                                <option value="å˜‰ç¾©ç¸£">å˜‰ç¾©ç¸£</option>
                                <option value="å±æ±ç¸£">å±æ±ç¸£</option>
                                <option value="å®œè˜­ç¸£">å®œè˜­ç¸£</option>
                                <option value="èŠ±è“®ç¸£">èŠ±è“®ç¸£</option>
                                <option value="å°æ±ç¸£">å°æ±ç¸£</option>
                                <option value="æ¾æ¹–ç¸£">æ¾æ¹–ç¸£</option>
                                <option value="é‡‘é–€ç¸£">é‡‘é–€ç¸£</option>
                                <option value="é€£æ±Ÿç¸£">é€£æ±Ÿç¸£</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>å€åŸŸ *</label>
                            <select id="district" required>
                                <option value="">è«‹å…ˆé¸æ“‡ç¸£å¸‚</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>è©³ç´°åœ°å€ *</label>
                            <div style="display: flex; flex-direction: column; gap: 0.5rem;">
                                <div style="display: flex; gap: 0.5rem; align-items: flex-start;">
                                    <input type="text" id="address" placeholder="ä¾‹å¦‚: æ¢…ç…è·¯äºŒæ®µ232å··***è™Ÿ10æ¨“" required style="flex: 1;">
                                    <button type="button" onclick="openGoogleStreetView()" class="btn btn-secondary" style="white-space: nowrap; padding: 0.7rem 1rem; font-size: 0.9rem;">
                                        ğŸ™ï¸ æ‰“é–‹ Google è¡—æ™¯
                                    </button>
                                </div>
                                <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer; font-weight: normal; font-size: 0.9rem; color: #666;">
                                    <input type="checkbox" id="hide_address_number" style="width: auto; margin: 0;">
                                    <span>éš±è—é–€ç‰Œè™Ÿç¢¼ï¼ˆåƒ…é¡¯ç¤ºè·¯åã€å··å¼„ï¼Œä¸é¡¯ç¤ºè™Ÿç¢¼ï¼‰</span>
                                </label>
                            </div>
                        </div>
                        <div class="form-group">
                            <label>ç¤¾å€åç¨±</label>
                            <input type="text" id="community" placeholder="ä¾‹å¦‚: ä¸–ç´€åŸ">
                        </div>
                        <div class="form-group">
                            <label>å”®åƒ¹ *</label>
                            <input type="text" id="price" placeholder="ä¾‹å¦‚: 896è¬" required>
                        </div>
                        <div class="form-group">
                            <label>ä¸Šæ¶ç‹€æ…‹ *</label>
                            <select id="is_published" required>
                                <option value="true">âœ… ä¸Šæ¶ï¼ˆé¡¯ç¤ºåœ¨å‰å°ï¼‰</option>
                                <option value="false">âŒ ä¸‹æ¶ï¼ˆä¸é¡¯ç¤ºåœ¨å‰å°ï¼‰</option>
                            </select>
                            <small style="color: #666; font-size: 0.85rem; margin-top: 0.25rem; display: block;">
                                ä¸Šæ¶çš„ç‰©ä»¶æœƒé¡¯ç¤ºåœ¨é¦–é ï¼Œä¸‹æ¶çš„ç‰©ä»¶åƒ…åœ¨å¾Œå°å¯è¦‹
                            </small>
                        </div>
                        <div class="form-group">
                            <label>ç‰©ä»¶ç‹€æ…‹</label>
                            <select id="status">
                                <option value="">ä¸€èˆ¬ç‰©ä»¶</option>
                                <option value="new">æ–°ä¸Šæ¶</option>
                                <option value="sold">å·²å”®å‡º</option>
                                <option value="urgent">æ€¥å”®</option>
                                <option value="selling">ç†±éŠ·ä¸­</option>
                                <option value="below-appraisal">ä½æ–¼é‘‘åƒ¹</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>ç‹€æ…‹æ–‡å­—</label>
                            <input type="text" id="statusText" placeholder="ä¾‹å¦‚: æ–°ä¸Šæ¶">
                        </div>
                    </div>
                </div>
                
                <!-- ç‰©ä»¶è©³æƒ… -->
                <div class="form-section">
                    <h3>ğŸ“ ç‰©ä»¶è©³æƒ…</h3>
                    <div class="form-grid">
                        <div class="form-group">
                            <label>æ ¼å±€ *</label>
                            <input type="text" id="layout" placeholder="ä¾‹å¦‚: 2æˆ¿2å»³1è¡›" required>
                        </div>
                        <div class="form-group">
                            <label>ç¸½åªæ•¸ *</label>
                            <input type="text" id="total_area" placeholder="ä¾‹å¦‚: 40.08åª" required>
                        </div>
                        <div class="form-group">
                            <label>ä¸»å»ºç‰©åªæ•¸</label>
                            <input type="text" id="main_area" placeholder="ä¾‹å¦‚: 18.17åª">
                        </div>
                        <div class="form-group">
                            <label>é™„å±¬å»ºç‰©åªæ•¸</label>
                            <input type="text" id="auxiliary_area" placeholder="ä¾‹å¦‚: 1.63åª">
                        </div>
                        <div class="form-group">
                            <label>å…¬è¨­åªæ•¸</label>
                            <input type="text" id="common_area" placeholder="ä¾‹å¦‚: 9.07åª">
                        </div>
                        <div class="form-group">
                            <label>åœŸåœ°åªæ•¸</label>
                            <input type="text" id="land_area" placeholder="ä¾‹å¦‚: 5.22åª">
                        </div>
                        <div class="form-group">
                            <label>è»Šä½åªæ•¸</label>
                            <input type="text" id="parking_area" placeholder="ä¾‹å¦‚: 8.5åª">
                        </div>
                        <div class="form-group">
                            <label>å±‹é½¡</label>
                            <input type="text" id="age" placeholder="ä¾‹å¦‚: 11å¹´">
                        </div>
                        <div class="form-group">
                            <label>æ¨“å±¤</label>
                            <input type="text" id="floor" placeholder="ä¾‹å¦‚: 10/14æ¨“">
                        </div>
                        <div class="form-group">
                            <label>å»ºç¯‰é¡å‹</label>
                            <select id="building_type">
                                <option value="">è«‹é¸æ“‡</option>
                                <option value="é›»æ¢¯å¤§æ¨“">é›»æ¢¯å¤§æ¨“</option>
                                <option value="è¯å»ˆå…¬å¯“">è¯å»ˆå…¬å¯“</option>
                                <option value="å…¬å¯“">å…¬å¯“</option>
                                <option value="é€å¤©åˆ¥å¢…">é€å¤©åˆ¥å¢…</option>
                                <option value="é€å¤©å">é€å¤©å</option>
                                <option value="å¤§æ¨“">å¤§æ¨“</option>
                                <option value="ä½å®…å¤§æ¨“">ä½å®…å¤§æ¨“</option>
                                <option value="å•†æ¥­å¤§æ¨“">å•†æ¥­å¤§æ¨“</option>
                                <option value="ä½å•†å¤§æ¨“">ä½å•†å¤§æ¨“</option>
                                <option value="åˆ¥å¢…">åˆ¥å¢…</option>
                                <option value="è¾²èˆ">è¾²èˆ</option>
                                <option value="å» æˆ¿">å» æˆ¿</option>
                                <option value="å€‰åº«">å€‰åº«</option>
                                <option value="åº—é¢">åº—é¢</option>
                                <option value="ä½è¾¦">ä½è¾¦</option>
                                <option value="å…¶ä»–">å…¶ä»–</option>
                                <option value="å¤§å»ˆ">å¤§å»ˆ</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>åº§å‘</label>
                            <select id="orientation">
                                <option value="">è«‹é¸æ“‡</option>
                                <option value="åº§åŒ—æœå—">åº§åŒ—æœå—</option>
                                <option value="åº§å—æœåŒ—">åº§å—æœåŒ—</option>
                                <option value="åº§æ±æœè¥¿">åº§æ±æœè¥¿</option>
                                <option value="åº§è¥¿æœæ±">åº§è¥¿æœæ±</option>
                                <option value="åº§æ±åŒ—æœè¥¿å—">åº§æ±åŒ—æœè¥¿å—</option>
                                <option value="åº§è¥¿å—æœæ±åŒ—">åº§è¥¿å—æœæ±åŒ—</option>
                                <option value="åº§è¥¿åŒ—æœæ±å—">åº§è¥¿åŒ—æœæ±å—</option>
                                <option value="åº§æ±å—æœè¥¿åŒ—">åº§æ±å—æœè¥¿åŒ—</option>
                                <option value="åº§åŒ—">åº§åŒ—</option>
                                <option value="åº§å—">åº§å—</option>
                                <option value="åº§æ±">åº§æ±</option>
                                <option value="åº§è¥¿">åº§è¥¿</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>ç®¡ç†è²»</label>
                            <input type="text" id="management_fee" placeholder="ä¾‹å¦‚: 2,077å…ƒ/æœˆ">
                        </div>
                        <div class="form-group">
                            <label>è»Šä½é¡å‹</label>
                            <select id="parking_type">
                                <option value="">è«‹é¸æ“‡</option>
                                <option value="å¹³é¢è»Šä½">å¹³é¢è»Šä½</option>
                                <option value="æ©Ÿæ¢°è»Šä½">æ©Ÿæ¢°è»Šä½</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>è»Šä½ç·¨è™Ÿ</label>
                            <input type="text" id="parking_space" placeholder="ä¾‹å¦‚: B3-14">
                        </div>
                        <div class="form-group">
                            <label>ç¾æ³</label>
                            <input type="text" id="current_status" placeholder="ä¾‹å¦‚: ç©ºå±‹">
                        </div>
                    </div>
                </div>
                
                <!-- åœ–ç‰‡ä¸Šå‚³ -->
                <div class="form-section">
                    <h3>ğŸ“· ç‰©ä»¶åœ–ç‰‡ï¼ˆç›´æ¥ä¸Šå‚³ï¼‰</h3>
                    <div class="image-upload-area" id="upload-area" onclick="document.getElementById('file-input').click()">
                        <div class="image-upload-icon">ğŸ“¸</div>
                        <p style="font-size: 1.1rem; font-weight: 600; color: #667eea; margin-bottom: 0.5rem;">
                            é»æ“Šæˆ–æ‹–æ›³åœ–ç‰‡åˆ°æ­¤è™•ä¸Šå‚³
                        </p>
                        <p style="color: #666; font-size: 0.9rem;">
                            æ”¯æ´ JPGã€PNGã€WEBP æ ¼å¼ï¼Œå¯ä¸€æ¬¡é¸æ“‡å¤šå¼µåœ–ç‰‡ï¼ˆæœ€å¤š 10 å¼µï¼‰
                        </p>
                        <input type="file" id="file-input" multiple accept="image/*">
                    </div>
                    <div id="image-preview-grid" class="image-preview-grid"></div>
                    <p style="text-align: center; color: #666; font-size: 0.9rem; margin-top: 0.5rem;">
                        ğŸ’¡ æç¤ºï¼šå¯ä¸Šå‚³æœ€å¤š 10 å¼µåœ–ç‰‡ï¼Œé»æ“Šã€Œå„²å­˜åˆ°è³‡æ–™åº«ã€æ™‚æ‰æœƒä¸Šå‚³
                    </p>
                </div>
                
                <!-- äº¤é€šèˆ‡è¨­æ–½ -->
                <div class="form-section">
                    <h3>ğŸš— äº¤é€šèˆ‡è¨­æ–½</h3>
                    <div class="form-grid">
                        <!-- ç”Ÿæ´»è¨­æ–½ -->
                        <div class="form-group">
                            <label>ç”Ÿæ´»è¨­æ–½</label>
                            <div class="tag-selector-container" data-type="facilities">
                                <div class="tag-input-wrapper">
                                    <input type="text" class="tag-input" placeholder="è¼¸å…¥æˆ–é¸æ“‡ç”Ÿæ´»è¨­æ–½..." id="facilities-input">
                                    <button type="button" class="tag-add-btn" onclick="addCustomTag('facilities')">æ–°å¢</button>
                        </div>
                                <div class="selected-tags" id="facilities-selected"></div>
                                <div class="tag-options" id="facilities-options">
                                    <span class="tag-option" onclick="toggleTag('facilities', 'å…¨è¯ç¦åˆ©ä¸­å¿ƒ')">
                                        <span class="tag-option-text">å…¨è¯ç¦åˆ©ä¸­å¿ƒ</span>
                                        <button class="tag-option-edit" onclick="editTagOption('facilities', 'å…¨è¯ç¦åˆ©ä¸­å¿ƒ', event)" title="ç·¨è¼¯">âœï¸</button>
                                        <button class="tag-option-delete" onclick="deleteTagOption('facilities', 'å…¨è¯ç¦åˆ©ä¸­å¿ƒ', event)" title="åˆªé™¤">Ã—</button>
                                    </span>
                                    <span class="tag-option" onclick="toggleTag('facilities', 'å®¶æ¨‚ç¦')">
                                        <span class="tag-option-text">å®¶æ¨‚ç¦</span>
                                        <button class="tag-option-edit" onclick="editTagOption('facilities', 'å®¶æ¨‚ç¦', event)" title="ç·¨è¼¯">âœï¸</button>
                                        <button class="tag-option-delete" onclick="deleteTagOption('facilities', 'å®¶æ¨‚ç¦', event)" title="åˆªé™¤">Ã—</button>
                                    </span>
                                    <span class="tag-option" onclick="toggleTag('facilities', '7-ELEVEN')">
                                        <span class="tag-option-text">7-ELEVEN</span>
                                        <button class="tag-option-edit" onclick="editTagOption('facilities', '7-ELEVEN', event)" title="ç·¨è¼¯">âœï¸</button>
                                        <button class="tag-option-delete" onclick="deleteTagOption('facilities', '7-ELEVEN', event)" title="åˆªé™¤">Ã—</button>
                                    </span>
                                    <span class="tag-option" onclick="toggleTag('facilities', 'å…¨å®¶ä¾¿åˆ©å•†åº—')">
                                        <span class="tag-option-text">å…¨å®¶ä¾¿åˆ©å•†åº—</span>
                                        <button class="tag-option-edit" onclick="editTagOption('facilities', 'å…¨å®¶ä¾¿åˆ©å•†åº—', event)" title="ç·¨è¼¯">âœï¸</button>
                                        <button class="tag-option-delete" onclick="deleteTagOption('facilities', 'å…¨å®¶ä¾¿åˆ©å•†åº—', event)" title="åˆªé™¤">Ã—</button>
                                    </span>
                                    <span class="tag-option" onclick="toggleTag('facilities', 'OKä¾¿åˆ©å•†åº—')">
                                        <span class="tag-option-text">OKä¾¿åˆ©å•†åº—</span>
                                        <button class="tag-option-edit" onclick="editTagOption('facilities', 'OKä¾¿åˆ©å•†åº—', event)" title="ç·¨è¼¯">âœï¸</button>
                                        <button class="tag-option-delete" onclick="deleteTagOption('facilities', 'OKä¾¿åˆ©å•†åº—', event)" title="åˆªé™¤">Ã—</button>
                                    </span>
                                    <span class="tag-option" onclick="toggleTag('facilities', 'èŠçˆ¾å¯Œ')">
                                        <span class="tag-option-text">èŠçˆ¾å¯Œ</span>
                                        <button class="tag-option-edit" onclick="editTagOption('facilities', 'èŠçˆ¾å¯Œ', event)" title="ç·¨è¼¯">âœï¸</button>
                                        <button class="tag-option-delete" onclick="deleteTagOption('facilities', 'èŠçˆ¾å¯Œ', event)" title="åˆªé™¤">Ã—</button>
                                    </span>
                                    <span class="tag-option" onclick="toggleTag('facilities', 'åº·æ˜¯ç¾')">
                                        <span class="tag-option-text">åº·æ˜¯ç¾</span>
                                        <button class="tag-option-edit" onclick="editTagOption('facilities', 'åº·æ˜¯ç¾', event)" title="ç·¨è¼¯">âœï¸</button>
                                        <button class="tag-option-delete" onclick="deleteTagOption('facilities', 'åº·æ˜¯ç¾', event)" title="åˆªé™¤">Ã—</button>
                                    </span>
                                    <span class="tag-option" onclick="toggleTag('facilities', 'å±ˆè‡£æ°')">
                                        <span class="tag-option-text">å±ˆè‡£æ°</span>
                                        <button class="tag-option-edit" onclick="editTagOption('facilities', 'å±ˆè‡£æ°', event)" title="ç·¨è¼¯">âœï¸</button>
                                        <button class="tag-option-delete" onclick="deleteTagOption('facilities', 'å±ˆè‡£æ°', event)" title="åˆªé™¤">Ã—</button>
                                    </span>
                                    <span class="tag-option" onclick="toggleTag('facilities', 'é ‚å¥½è¶…å¸‚')">
                                        <span class="tag-option-text">é ‚å¥½è¶…å¸‚</span>
                                        <button class="tag-option-edit" onclick="editTagOption('facilities', 'é ‚å¥½è¶…å¸‚', event)" title="ç·¨è¼¯">âœï¸</button>
                                        <button class="tag-option-delete" onclick="deleteTagOption('facilities', 'é ‚å¥½è¶…å¸‚', event)" title="åˆªé™¤">Ã—</button>
                                    </span>
                                    <span class="tag-option" onclick="toggleTag('facilities', 'ç¾è¯ç¤¾')">
                                        <span class="tag-option-text">ç¾è¯ç¤¾</span>
                                        <button class="tag-option-edit" onclick="editTagOption('facilities', 'ç¾è¯ç¤¾', event)" title="ç·¨è¼¯">âœï¸</button>
                                        <button class="tag-option-delete" onclick="deleteTagOption('facilities', 'ç¾è¯ç¤¾', event)" title="åˆªé™¤">Ã—</button>
                                    </span>
                                    <span class="tag-option" onclick="toggleTag('facilities', 'æ¾é’è¶…å¸‚')">
                                        <span class="tag-option-text">æ¾é’è¶…å¸‚</span>
                                        <button class="tag-option-edit" onclick="editTagOption('facilities', 'æ¾é’è¶…å¸‚', event)" title="ç·¨è¼¯">âœï¸</button>
                                        <button class="tag-option-delete" onclick="deleteTagOption('facilities', 'æ¾é’è¶…å¸‚', event)" title="åˆªé™¤">Ã—</button>
                                    </span>
                                    <span class="tag-option" onclick="toggleTag('facilities', 'æ˜Ÿå·´å…‹')">
                                        <span class="tag-option-text">æ˜Ÿå·´å…‹</span>
                                        <button class="tag-option-edit" onclick="editTagOption('facilities', 'æ˜Ÿå·´å…‹', event)" title="ç·¨è¼¯">âœï¸</button>
                                        <button class="tag-option-delete" onclick="deleteTagOption('facilities', 'æ˜Ÿå·´å…‹', event)" title="åˆªé™¤">Ã—</button>
                                    </span>
                                    <span class="tag-option" onclick="toggleTag('facilities', 'éº¥ç•¶å‹')">
                                        <span class="tag-option-text">éº¥ç•¶å‹</span>
                                        <button class="tag-option-edit" onclick="editTagOption('facilities', 'éº¥ç•¶å‹', event)" title="ç·¨è¼¯">âœï¸</button>
                                        <button class="tag-option-delete" onclick="deleteTagOption('facilities', 'éº¥ç•¶å‹', event)" title="åˆªé™¤">Ã—</button>
                                    </span>
                                    <span class="tag-option" onclick="toggleTag('facilities', 'è‚¯å¾·åŸº')">
                                        <span class="tag-option-text">è‚¯å¾·åŸº</span>
                                        <button class="tag-option-edit" onclick="editTagOption('facilities', 'è‚¯å¾·åŸº', event)" title="ç·¨è¼¯">âœï¸</button>
                                        <button class="tag-option-delete" onclick="deleteTagOption('facilities', 'è‚¯å¾·åŸº', event)" title="åˆªé™¤">Ã—</button>
                                    </span>
                                    <span class="tag-option" onclick="toggleTag('facilities', 'éŠ€è¡Œ')">
                                        <span class="tag-option-text">éŠ€è¡Œ</span>
                                        <button class="tag-option-edit" onclick="editTagOption('facilities', 'éŠ€è¡Œ', event)" title="ç·¨è¼¯">âœï¸</button>
                                        <button class="tag-option-delete" onclick="deleteTagOption('facilities', 'éŠ€è¡Œ', event)" title="åˆªé™¤">Ã—</button>
                                    </span>
                                    <span class="tag-option" onclick="toggleTag('facilities', 'éƒµå±€')">
                                        <span class="tag-option-text">éƒµå±€</span>
                                        <button class="tag-option-edit" onclick="editTagOption('facilities', 'éƒµå±€', event)" title="ç·¨è¼¯">âœï¸</button>
                                        <button class="tag-option-delete" onclick="deleteTagOption('facilities', 'éƒµå±€', event)" title="åˆªé™¤">Ã—</button>
                                    </span>
                                    <span class="tag-option" onclick="toggleTag('facilities', 'è¨ºæ‰€')">
                                        <span class="tag-option-text">è¨ºæ‰€</span>
                                        <button class="tag-option-edit" onclick="editTagOption('facilities', 'è¨ºæ‰€', event)" title="ç·¨è¼¯">âœï¸</button>
                                        <button class="tag-option-delete" onclick="deleteTagOption('facilities', 'è¨ºæ‰€', event)" title="åˆªé™¤">Ã—</button>
                                    </span>
                                    <span class="tag-option" onclick="toggleTag('facilities', 'é†«é™¢')">
                                        <span class="tag-option-text">é†«é™¢</span>
                                        <button class="tag-option-edit" onclick="editTagOption('facilities', 'é†«é™¢', event)" title="ç·¨è¼¯">âœï¸</button>
                                        <button class="tag-option-delete" onclick="deleteTagOption('facilities', 'é†«é™¢', event)" title="åˆªé™¤">Ã—</button>
                                    </span>
                                    <span class="tag-option" onclick="toggleTag('facilities', 'è—¥å±€')">
                                        <span class="tag-option-text">è—¥å±€</span>
                                        <button class="tag-option-edit" onclick="editTagOption('facilities', 'è—¥å±€', event)" title="ç·¨è¼¯">âœï¸</button>
                                        <button class="tag-option-delete" onclick="deleteTagOption('facilities', 'è—¥å±€', event)" title="åˆªé™¤">Ã—</button>
                                    </span>
                                    <span class="tag-option" onclick="toggleTag('facilities', 'å•†åœˆ')">
                                        <span class="tag-option-text">å•†åœˆ</span>
                                        <button class="tag-option-edit" onclick="editTagOption('facilities', 'å•†åœˆ', event)" title="ç·¨è¼¯">âœï¸</button>
                                        <button class="tag-option-delete" onclick="deleteTagOption('facilities', 'å•†åœˆ', event)" title="åˆªé™¤">Ã—</button>
                                    </span>
                                </div>
                            </div>
                        </div>
                        
                        <!-- äº¤é€šè¨­æ–½ -->
                        <div class="form-group">
                            <label>äº¤é€šè¨­æ–½</label>
                            <div class="tag-selector-container" data-type="transport">
                                <div class="tag-input-wrapper">
                                    <input type="text" class="tag-input" placeholder="è¼¸å…¥æˆ–é¸æ“‡äº¤é€šè¨­æ–½..." id="transport-input">
                                    <button type="button" class="tag-add-btn" onclick="addCustomTag('transport')">æ–°å¢</button>
                        </div>
                                <div class="selected-tags" id="transport-selected"></div>
                                <div class="tag-options" id="transport-options">
                                    <span class="tag-option" onclick="toggleTag('transport', 'å°1ç·š')">
                                        <span class="tag-option-text">å°1ç·š</span>
                                        <button class="tag-option-edit" onclick="editTagOption('transport', 'å°1ç·š', event)" title="ç·¨è¼¯">âœï¸</button>
                                        <button class="tag-option-delete" onclick="deleteTagOption('transport', 'å°1ç·š', event)" title="åˆªé™¤">Ã—</button>
                                    </span>
                                    <span class="tag-option" onclick="toggleTag('transport', 'å°3ç·š')">
                                        <span class="tag-option-text">å°3ç·š</span>
                                        <button class="tag-option-edit" onclick="editTagOption('transport', 'å°3ç·š', event)" title="ç·¨è¼¯">âœï¸</button>
                                        <button class="tag-option-delete" onclick="deleteTagOption('transport', 'å°3ç·š', event)" title="åˆªé™¤">Ã—</button>
                                    </span>
                                    <span class="tag-option" onclick="toggleTag('transport', 'å°61ç·š')">
                                        <span class="tag-option-text">å°61ç·š</span>
                                        <button class="tag-option-edit" onclick="editTagOption('transport', 'å°61ç·š', event)" title="ç·¨è¼¯">âœï¸</button>
                                        <button class="tag-option-delete" onclick="deleteTagOption('transport', 'å°61ç·š', event)" title="åˆªé™¤">Ã—</button>
                                    </span>
                                    <span class="tag-option" onclick="toggleTag('transport', 'åœ‹é“1è™Ÿ')">
                                        <span class="tag-option-text">åœ‹é“1è™Ÿ</span>
                                        <button class="tag-option-edit" onclick="editTagOption('transport', 'åœ‹é“1è™Ÿ', event)" title="ç·¨è¼¯">âœï¸</button>
                                        <button class="tag-option-delete" onclick="deleteTagOption('transport', 'åœ‹é“1è™Ÿ', event)" title="åˆªé™¤">Ã—</button>
                                    </span>
                                    <span class="tag-option" onclick="toggleTag('transport', 'åœ‹é“3è™Ÿ')">
                                        <span class="tag-option-text">åœ‹é“3è™Ÿ</span>
                                        <button class="tag-option-edit" onclick="editTagOption('transport', 'åœ‹é“3è™Ÿ', event)" title="ç·¨è¼¯">âœï¸</button>
                                        <button class="tag-option-delete" onclick="deleteTagOption('transport', 'åœ‹é“3è™Ÿ', event)" title="åˆªé™¤">Ã—</button>
                                    </span>
                                    <span class="tag-option" onclick="toggleTag('transport', 'æ¥Šæ¢…äº¤æµé“')">
                                        <span class="tag-option-text">æ¥Šæ¢…äº¤æµé“</span>
                                        <button class="tag-option-edit" onclick="editTagOption('transport', 'æ¥Šæ¢…äº¤æµé“', event)" title="ç·¨è¼¯">âœï¸</button>
                                        <button class="tag-option-delete" onclick="deleteTagOption('transport', 'æ¥Šæ¢…äº¤æµé“', event)" title="åˆªé™¤">Ã—</button>
                                    </span>
                                    <span class="tag-option" onclick="toggleTag('transport', 'æ¹–å£äº¤æµé“')">
                                        <span class="tag-option-text">æ¹–å£äº¤æµé“</span>
                                        <button class="tag-option-edit" onclick="editTagOption('transport', 'æ¹–å£äº¤æµé“', event)" title="ç·¨è¼¯">âœï¸</button>
                                        <button class="tag-option-delete" onclick="deleteTagOption('transport', 'æ¹–å£äº¤æµé“', event)" title="åˆªé™¤">Ã—</button>
                                    </span>
                                    <span class="tag-option" onclick="toggleTag('transport', 'åŸ”å¿ƒç«è»Šç«™')">
                                        <span class="tag-option-text">åŸ”å¿ƒç«è»Šç«™</span>
                                        <button class="tag-option-edit" onclick="editTagOption('transport', 'åŸ”å¿ƒç«è»Šç«™', event)" title="ç·¨è¼¯">âœï¸</button>
                                        <button class="tag-option-delete" onclick="deleteTagOption('transport', 'åŸ”å¿ƒç«è»Šç«™', event)" title="åˆªé™¤">Ã—</button>
                                    </span>
                                    <span class="tag-option" onclick="toggleTag('transport', 'æ¥Šæ¢…ç«è»Šç«™')">
                                        <span class="tag-option-text">æ¥Šæ¢…ç«è»Šç«™</span>
                                        <button class="tag-option-edit" onclick="editTagOption('transport', 'æ¥Šæ¢…ç«è»Šç«™', event)" title="ç·¨è¼¯">âœï¸</button>
                                        <button class="tag-option-delete" onclick="deleteTagOption('transport', 'æ¥Šæ¢…ç«è»Šç«™', event)" title="åˆªé™¤">Ã—</button>
                                    </span>
                                    <span class="tag-option" onclick="toggleTag('transport', 'å¯Œå²¡ç«è»Šç«™')">
                                        <span class="tag-option-text">å¯Œå²¡ç«è»Šç«™</span>
                                        <button class="tag-option-edit" onclick="editTagOption('transport', 'å¯Œå²¡ç«è»Šç«™', event)" title="ç·¨è¼¯">âœï¸</button>
                                        <button class="tag-option-delete" onclick="deleteTagOption('transport', 'å¯Œå²¡ç«è»Šç«™', event)" title="åˆªé™¤">Ã—</button>
                                    </span>
                                    <span class="tag-option" onclick="toggleTag('transport', 'æ–°å¯Œç«è»Šç«™')">
                                        <span class="tag-option-text">æ–°å¯Œç«è»Šç«™</span>
                                        <button class="tag-option-edit" onclick="editTagOption('transport', 'æ–°å¯Œç«è»Šç«™', event)" title="ç·¨è¼¯">âœï¸</button>
                                        <button class="tag-option-delete" onclick="deleteTagOption('transport', 'æ–°å¯Œç«è»Šç«™', event)" title="åˆªé™¤">Ã—</button>
                                    </span>
                                    <span class="tag-option" onclick="toggleTag('transport', 'é«˜éµæ¡ƒåœ’ç«™')">
                                        <span class="tag-option-text">é«˜éµæ¡ƒåœ’ç«™</span>
                                        <button class="tag-option-edit" onclick="editTagOption('transport', 'é«˜éµæ¡ƒåœ’ç«™', event)" title="ç·¨è¼¯">âœï¸</button>
                                        <button class="tag-option-delete" onclick="deleteTagOption('transport', 'é«˜éµæ¡ƒåœ’ç«™', event)" title="åˆªé™¤">Ã—</button>
                                    </span>
                                    <span class="tag-option" onclick="toggleTag('transport', 'æ©Ÿæ·A18ç«™')">
                                        <span class="tag-option-text">æ©Ÿæ·A18ç«™</span>
                                        <button class="tag-option-edit" onclick="editTagOption('transport', 'æ©Ÿæ·A18ç«™', event)" title="ç·¨è¼¯">âœï¸</button>
                                        <button class="tag-option-delete" onclick="deleteTagOption('transport', 'æ©Ÿæ·A18ç«™', event)" title="åˆªé™¤">Ã—</button>
                                    </span>
                                    <span class="tag-option" onclick="toggleTag('transport', 'æ©Ÿæ·A19ç«™')">
                                        <span class="tag-option-text">æ©Ÿæ·A19ç«™</span>
                                        <button class="tag-option-edit" onclick="editTagOption('transport', 'æ©Ÿæ·A19ç«™', event)" title="ç·¨è¼¯">âœï¸</button>
                                        <button class="tag-option-delete" onclick="deleteTagOption('transport', 'æ©Ÿæ·A19ç«™', event)" title="åˆªé™¤">Ã—</button>
                                    </span>
                                    <span class="tag-option" onclick="toggleTag('transport', 'å…¬è»Šç«™')">
                                        <span class="tag-option-text">å…¬è»Šç«™</span>
                                        <button class="tag-option-edit" onclick="editTagOption('transport', 'å…¬è»Šç«™', event)" title="ç·¨è¼¯">âœï¸</button>
                                        <button class="tag-option-delete" onclick="deleteTagOption('transport', 'å…¬è»Šç«™', event)" title="åˆªé™¤">Ã—</button>
                                    </span>
                                    <span class="tag-option" onclick="toggleTag('transport', 'å®¢é‹ç«™')">
                                        <span class="tag-option-text">å®¢é‹ç«™</span>
                                        <button class="tag-option-edit" onclick="editTagOption('transport', 'å®¢é‹ç«™', event)" title="ç·¨è¼¯">âœï¸</button>
                                        <button class="tag-option-delete" onclick="deleteTagOption('transport', 'å®¢é‹ç«™', event)" title="åˆªé™¤">Ã—</button>
                                    </span>
                                </div>
                            </div>
                        </div>
                        
                        <!-- å­¸å€ -->
                        <div class="form-group">
                            <label>å­¸å€</label>
                            <div class="tag-selector-container" data-type="schools">
                                <div class="tag-input-wrapper">
                                    <input type="text" class="tag-input" placeholder="è¼¸å…¥æˆ–é¸æ“‡å­¸æ ¡..." id="schools-input">
                                    <button type="button" class="tag-add-btn" onclick="addCustomTag('schools')">æ–°å¢</button>
                        </div>
                                <div class="selected-tags" id="schools-selected"></div>
                                <div class="tag-options" id="schools-options">
                                    <span class="tag-option" onclick="toggleTag('schools', 'é™½å…‰åœ‹å°')">
                                        <span class="tag-option-text">é™½å…‰åœ‹å°</span>
                                        <button class="tag-option-edit" onclick="editTagOption('schools', 'é™½å…‰åœ‹å°', event)" title="ç·¨è¼¯">âœï¸</button>
                                        <button class="tag-option-delete" onclick="deleteTagOption('schools', 'é™½å…‰åœ‹å°', event)" title="åˆªé™¤">Ã—</button>
                                    </span>
                                    <span class="tag-option" onclick="toggleTag('schools', 'ç‘å¡˜åœ‹å°')">
                                        <span class="tag-option-text">ç‘å¡˜åœ‹å°</span>
                                        <button class="tag-option-edit" onclick="editTagOption('schools', 'ç‘å¡˜åœ‹å°', event)" title="ç·¨è¼¯">âœï¸</button>
                                        <button class="tag-option-delete" onclick="deleteTagOption('schools', 'ç‘å¡˜åœ‹å°', event)" title="åˆªé™¤">Ã—</button>
                                    </span>
                                    <span class="tag-option" onclick="toggleTag('schools', 'ç‘åŸåœ‹å°')">
                                        <span class="tag-option-text">ç‘åŸåœ‹å°</span>
                                        <button class="tag-option-edit" onclick="editTagOption('schools', 'ç‘åŸåœ‹å°', event)" title="ç·¨è¼¯">âœï¸</button>
                                        <button class="tag-option-delete" onclick="deleteTagOption('schools', 'ç‘åŸåœ‹å°', event)" title="åˆªé™¤">Ã—</button>
                                    </span>
                                    <span class="tag-option" onclick="toggleTag('schools', 'æ¥Šæ¢…åœ‹å°')">
                                        <span class="tag-option-text">æ¥Šæ¢…åœ‹å°</span>
                                        <button class="tag-option-edit" onclick="editTagOption('schools', 'æ¥Šæ¢…åœ‹å°', event)" title="ç·¨è¼¯">âœï¸</button>
                                        <button class="tag-option-delete" onclick="deleteTagOption('schools', 'æ¥Šæ¢…åœ‹å°', event)" title="åˆªé™¤">Ã—</button>
                                    </span>
                                    <span class="tag-option" onclick="toggleTag('schools', 'å¯Œå²¡åœ‹å°')">
                                        <span class="tag-option-text">å¯Œå²¡åœ‹å°</span>
                                        <button class="tag-option-edit" onclick="editTagOption('schools', 'å¯Œå²¡åœ‹å°', event)" title="ç·¨è¼¯">âœï¸</button>
                                        <button class="tag-option-delete" onclick="deleteTagOption('schools', 'å¯Œå²¡åœ‹å°', event)" title="åˆªé™¤">Ã—</button>
                                    </span>
                                    <span class="tag-option" onclick="toggleTag('schools', 'ç‘åªåœ‹ä¸­')">
                                        <span class="tag-option-text">ç‘åªåœ‹ä¸­</span>
                                        <button class="tag-option-edit" onclick="editTagOption('schools', 'ç‘åªåœ‹ä¸­', event)" title="ç·¨è¼¯">âœï¸</button>
                                        <button class="tag-option-delete" onclick="deleteTagOption('schools', 'ç‘åªåœ‹ä¸­', event)" title="åˆªé™¤">Ã—</button>
                                    </span>
                                    <span class="tag-option" onclick="toggleTag('schools', 'æ¥Šæ¢…åœ‹ä¸­')">
                                        <span class="tag-option-text">æ¥Šæ¢…åœ‹ä¸­</span>
                                        <button class="tag-option-edit" onclick="editTagOption('schools', 'æ¥Šæ¢…åœ‹ä¸­', event)" title="ç·¨è¼¯">âœï¸</button>
                                        <button class="tag-option-delete" onclick="deleteTagOption('schools', 'æ¥Šæ¢…åœ‹ä¸­', event)" title="åˆªé™¤">Ã—</button>
                                    </span>
                                    <span class="tag-option" onclick="toggleTag('schools', 'å¯Œå²¡åœ‹ä¸­')">
                                        <span class="tag-option-text">å¯Œå²¡åœ‹ä¸­</span>
                                        <button class="tag-option-edit" onclick="editTagOption('schools', 'å¯Œå²¡åœ‹ä¸­', event)" title="ç·¨è¼¯">âœï¸</button>
                                        <button class="tag-option-delete" onclick="deleteTagOption('schools', 'å¯Œå²¡åœ‹ä¸­', event)" title="åˆªé™¤">Ã—</button>
                                    </span>
                                    <span class="tag-option" onclick="toggleTag('schools', 'æ¥Šæ¢…é«˜ä¸­')">
                                        <span class="tag-option-text">æ¥Šæ¢…é«˜ä¸­</span>
                                        <button class="tag-option-edit" onclick="editTagOption('schools', 'æ¥Šæ¢…é«˜ä¸­', event)" title="ç·¨è¼¯">âœï¸</button>
                                        <button class="tag-option-delete" onclick="deleteTagOption('schools', 'æ¥Šæ¢…é«˜ä¸­', event)" title="åˆªé™¤">Ã—</button>
                                    </span>
                                    <span class="tag-option" onclick="toggleTag('schools', 'å¤§è¯ä¸­å­¸')">
                                        <span class="tag-option-text">å¤§è¯ä¸­å­¸</span>
                                        <button class="tag-option-edit" onclick="editTagOption('schools', 'å¤§è¯ä¸­å­¸', event)" title="ç·¨è¼¯">âœï¸</button>
                                        <button class="tag-option-delete" onclick="deleteTagOption('schools', 'å¤§è¯ä¸­å­¸', event)" title="åˆªé™¤">Ã—</button>
                                    </span>
                                    <span class="tag-option" onclick="toggleTag('schools', 'æ²»å¹³é«˜ä¸­')">
                                        <span class="tag-option-text">æ²»å¹³é«˜ä¸­</span>
                                        <button class="tag-option-edit" onclick="editTagOption('schools', 'æ²»å¹³é«˜ä¸­', event)" title="ç·¨è¼¯">âœï¸</button>
                                        <button class="tag-option-delete" onclick="deleteTagOption('schools', 'æ²»å¹³é«˜ä¸­', event)" title="åˆªé™¤">Ã—</button>
                                    </span>
                                    <span class="tag-option" onclick="toggleTag('schools', 'ç§ç«‹å­¸æ ¡')">
                                        <span class="tag-option-text">ç§ç«‹å­¸æ ¡</span>
                                        <button class="tag-option-edit" onclick="editTagOption('schools', 'ç§ç«‹å­¸æ ¡', event)" title="ç·¨è¼¯">âœï¸</button>
                                        <button class="tag-option-delete" onclick="deleteTagOption('schools', 'ç§ç«‹å­¸æ ¡', event)" title="åˆªé™¤">Ã—</button>
                                    </span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label>å¸‚å ´</label>
                            <input type="text" id="market" placeholder="ä¾‹å¦‚: è¬å¤§å¸‚å ´">
                        </div>
                        <div class="form-group">
                            <label>å…¬åœ’</label>
                            <input type="text" id="park" placeholder="ä¾‹å¦‚: å››ç¶­å…¬åœ’">
                        </div>
                    </div>
                </div>
                
                <!-- ç‰¹è‰²èˆ‡æè¿° -->
                <div class="form-section">
                    <h3>âœ¨ ç‰¹è‰²èˆ‡æè¿°</h3>
                    <div class="form-grid">
                        <div class="form-group full-width">
                            <label>ç‰©ä»¶ç‰¹è‰² (æ¯è¡Œä¸€å€‹)</label>
                            <textarea id="features" placeholder="è¿‘å­¸å€&#10;äº¤é€šä¾¿åˆ©&#10;ç®¡ç†å®Œå–„"></textarea>
                        </div>
                        <div class="form-group full-width">
                            <label>ç‰©ä»¶æè¿°</label>
                            <textarea id="description" placeholder="è©³ç´°æè¿°ç‰©ä»¶ç‰¹è‰²..."></textarea>
                        </div>
                    </div>
                </div>
                
                <!-- å…¶ä»–è³‡è¨Š -->
                <div class="form-section">
                    <h3>ğŸ”— å…¶ä»–è³‡è¨Š</h3>
                    <div class="form-grid">
                        <div class="form-group full-width">
                            <label>Google è¡—æ™¯ç¶²å€</label>
                            <input type="text" id="google_maps" placeholder="https://www.google.com/maps/embed?pb=...ï¼ˆå¾ Google è¡—æ™¯é é¢è¤‡è£½åµŒå…¥ç¶²å€ï¼‰">
                            <small style="color: #666; font-size: 0.85rem; margin-top: 0.25rem; display: block;">
                                ğŸ’¡ æç¤ºï¼š<br>
                                1. è¼¸å…¥åœ°å€å¾Œï¼Œé»æ“Šã€ŒğŸ™ï¸ æ‰“é–‹ Google è¡—æ™¯ã€æŒ‰éˆ•<br>
                                2. åœ¨æ–°é–‹å•Ÿçš„ Google è¡—æ™¯é é¢ä¸­ï¼Œé»æ“Šã€Œåˆ†äº«ã€â†’ã€ŒåµŒå…¥åœ°åœ–ã€<br>
                                3. è¤‡è£½åµŒå…¥ç¶²å€ä¸¦è²¼åˆ°æ­¤æ¬„ä½
                            </small>
                        </div>
                        <div class="form-group">
                            <label>TikTok å½±ç‰‡ ID</label>
                            <input type="text" id="tiktok_video_id" placeholder="ä¾‹å¦‚: 7531311616948948230">
                        </div>
                        <div class="form-group">
                            <label>TikTok ä½¿ç”¨è€…åç¨±</label>
                            <input type="text" id="tiktok_username" placeholder="ä¾‹å¦‚: @aihouse168">
                        </div>
                        <div class="form-group">
                            <label>åƒè€ƒé€£çµ</label>
                            <input type="text" id="reference_link" placeholder="https://...">
                        </div>
                    </div>
                </div>
                
                <div class="btn-group">
                    <button type="button" class="btn btn-primary" onclick="saveProperty()" id="save-btn">
                        ğŸ’¾ å„²å­˜åˆ°è³‡æ–™åº«
                    </button>
                    <button type="button" class="btn btn-secondary" onclick="resetForm()">
                        ğŸ”„ é‡è¨­è¡¨å–®
                    </button>
                </div>
            </form>
        </div>
        
        <!-- ç‰©ä»¶åˆ—è¡¨ -->
        <div id="list-tab" class="tab-content">
            <div class="form-section">
                <h3>ğŸ“‹ ç¾æœ‰ç‰©ä»¶åˆ—è¡¨</h3>
                <button class="btn btn-success" onclick="loadProperties()" style="margin-bottom: 1rem; max-width: 200px;">
                    ğŸ”„ é‡æ–°è¼‰å…¥
                </button>
                <div id="property-list" class="property-list">
                    <p style="text-align: center; color: #666; padding: 2rem;">
                        é»æ“Šã€Œé‡æ–°è¼‰å…¥ã€æŒ‰éˆ•è¼‰å…¥ç‰©ä»¶è³‡æ–™
                    </p>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Supabase SDK -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.39.0/dist/umd/supabase.min.js"></script>
    <script>
        // å…¨åŸŸè®Šæ•¸
        let uploadedImages = []; // å·²ä¸Šå‚³çš„åœ–ç‰‡ URL å’Œ key é™£åˆ— [{url, key}]
        let editingPropertyId = null;
        let supabaseClient = null; // Supabase å®¢æˆ¶ç«¯å¯¦ä¾‹
        
        // åˆå§‹åŒ– Supabase
        function initSupabase() {
            const supabaseUrl = localStorage.getItem('supabase-url') || 'https://cnzqtuuegdqwkgvletaa.supabase.co';
            const supabaseAnonKey = localStorage.getItem('supabase-anon-key') || 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImNuenF0dXVlZ2Rxd2tndmxldGFhIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjgxMjUxMTksImV4cCI6MjA4MzcwMTExOX0.gsO3RKdMu2bUXW4b5aHseouIkjXtJyIqqP_0x3Y6trE';
            
            if (!supabaseUrl || !supabaseAnonKey) {
                console.warn('âš ï¸ Supabase è¨­å®šæœªå®Œæˆ');
                return null;
            }
            
            try {
                // åˆå§‹åŒ– Supabase å®¢æˆ¶ç«¯
                supabaseClient = supabase.createClient(supabaseUrl, supabaseAnonKey);
                
                console.log('âœ… Supabase åˆå§‹åŒ–æˆåŠŸ', {
                    url: supabaseUrl,
                    hasClient: !!supabaseClient
                });
                return supabaseClient;
            } catch (error) {
                console.error('âŒ Supabase åˆå§‹åŒ–å¤±æ•—:', error);
                return null;
            }
        }
        
        // è¼‰å…¥è¨­å®š
        function loadSupabaseConfig() {
            const urlInput = document.getElementById('supabase-url');
            const anonKeyInput = document.getElementById('supabase-anon-key');
            
            if (urlInput) {
                urlInput.value = localStorage.getItem('supabase-url') || 'https://cnzqtuuegdqwkgvletaa.supabase.co';
            }
            if (anonKeyInput) {
                anonKeyInput.value = localStorage.getItem('supabase-anon-key') || 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImNuenF0dXVlZ2Rxd2tndmxldGFhIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjgxMjUxMTksImV4cCI6MjA4MzcwMTExOX0.gsO3RKdMu2bUXW4b5aHseouIkjXtJyIqqP_0x3Y6trE';
            }
            
            // åˆå§‹åŒ– Supabase
            initSupabase();
        }
        
        // æª¢æŸ¥ URL åƒæ•¸ï¼Œå¦‚æœæ˜¯å¾ admin-dashboard.html è¼‰å…¥ï¼Œè‡ªå‹•åˆ‡æ›åˆ°æ–°å¢æ¨™ç±¤
        window.addEventListener('DOMContentLoaded', function() {
            const urlParams = new URLSearchParams(window.location.search);
            const tab = urlParams.get('tab');
            const id = urlParams.get('id');
            
            if (tab === 'add') {
                // éš±è—æ¨™ç±¤åˆ‡æ›æŒ‰éˆ•ï¼ˆå› ç‚ºåœ¨ iframe ä¸­ï¼‰
                const tabs = document.querySelector('.tabs');
                if (tabs) {
                    tabs.style.display = 'none';
                }
                // éš±è— headerï¼ˆå› ç‚ºåœ¨ iframe ä¸­ï¼‰
                const header = document.querySelector('.header');
                if (header) {
                    header.style.display = 'none';
                }
                
                // è‡ªå‹•åˆ‡æ›åˆ°æ–°å¢æ¨™ç±¤
                const addTab = document.querySelector('.tab[onclick*="add"]');
                if (addTab) {
                    switchTab('add', addTab);
                    
                    // å¦‚æœæœ‰ ID åƒæ•¸ï¼Œè¼‰å…¥ç‰©ä»¶è³‡æ–™é€²è¡Œç·¨è¼¯
                    if (id) {
                        setTimeout(() => {
                            editProperty(id);
                        }, 500);
                    }
                }
            }
        });
        
        // å„²å­˜è¨­å®š
        function saveSupabaseConfig() {
            const urlInput = document.getElementById('supabase-url');
            const anonKeyInput = document.getElementById('supabase-anon-key');
            
            if (!urlInput || !anonKeyInput) {
                showAlert('error', 'æ‰¾ä¸åˆ°è¨­å®šæ¬„ä½');
                return;
            }
            
            const supabaseUrl = urlInput.value.trim();
            const supabaseAnonKey = anonKeyInput.value.trim();
            
            if (!supabaseUrl || !supabaseAnonKey) {
                showAlert('error', 'è«‹å¡«å¯«å®Œæ•´çš„ Supabase è¨­å®šï¼ˆéœ€è¦ URL å’Œ Anon Keyï¼‰');
                return;
            }
            
            // å„²å­˜åˆ° localStorage
            localStorage.setItem('supabase-url', supabaseUrl);
            localStorage.setItem('supabase-anon-key', supabaseAnonKey);
            
            console.log('ğŸ’¾ è¨­å®šå·²å„²å­˜:', { url: supabaseUrl, anonKey: supabaseAnonKey.substring(0, 10) + '...' });
            
            // é‡æ–°åˆå§‹åŒ– Supabase
            const result = initSupabase();
            
            if (result) {
                showAlert('success', 'è¨­å®šå·²å„²å­˜ä¸¦åˆå§‹åŒ–æˆåŠŸï¼');
                // éš±è—è¨­å®šæ¨™ç±¤
                hideConfigTab();
                // è‡ªå‹•åˆ‡æ›åˆ°æ–°å¢ç‰©ä»¶æ¨™ç±¤
                setTimeout(() => {
                    const addTab = document.querySelectorAll('.tab')[1];
                    if (addTab) {
                        switchTab('add', addTab);
                    }
                }, 500);
                // æ¸¬è©¦é€£æ¥
                setTimeout(() => {
                    testSupabaseConnection();
                }, 800);
            } else {
                showAlert('error', 'è¨­å®šå·²å„²å­˜ï¼Œä½†åˆå§‹åŒ–å¤±æ•—ï¼Œè«‹æª¢æŸ¥è¨­å®šæ˜¯å¦æ­£ç¢º');
            }
        }
        
        // éš±è—è¨­å®šæ¨™ç±¤
        function hideConfigTab() {
            const configTabButton = document.getElementById('config-tab-button');
            if (configTabButton) {
                configTabButton.style.display = 'none';
                localStorage.setItem('hide-config-tab', 'true');
            }
        }
        
        // é¡¯ç¤ºè¨­å®šæ¨™ç±¤
        function showConfigTab() {
            const configTabButton = document.getElementById('config-tab-button');
            if (configTabButton) {
                configTabButton.style.display = 'flex';
                localStorage.setItem('hide-config-tab', 'false');
            }
        }
        
        // æª¢æŸ¥æ˜¯å¦éœ€è¦éš±è—è¨­å®šæ¨™ç±¤
        function checkConfigTabVisibility() {
            const hideConfig = localStorage.getItem('hide-config-tab') === 'true';
            const anonKey = localStorage.getItem('supabase-anon-key');
            
            // å¦‚æœ Supabase å·²è¨­å®šä¸”ä¹‹å‰é¸æ“‡éš±è—ï¼Œå‰‡éš±è—æ¨™ç±¤
            if (hideConfig && anonKey) {
                hideConfigTab();
            }
        }
        
        // åˆ‡æ›æ¨™ç±¤ï¼ˆå„ªåŒ–ç‰ˆæœ¬ï¼‰
        function switchTab(tabName, tabElement) {
            // é˜²æ­¢äº‹ä»¶å†’æ³¡
            if (tabElement && tabElement.stopPropagation) {
                tabElement.stopPropagation();
            }
            
            // ä½¿ç”¨ requestAnimationFrame å„ªåŒ– DOM æ“ä½œ
            requestAnimationFrame(() => {
                // æ‰¹é‡ DOM æ“ä½œ
                const contents = document.querySelectorAll('.tab-content');
                const tabs = document.querySelectorAll('.tab');
                
                // å…ˆç§»é™¤æ‰€æœ‰ active é¡åˆ¥
                contents.forEach(content => {
                content.classList.remove('active');
            });
                tabs.forEach(tab => {
                tab.classList.remove('active');
            });
            
                // å†æ·»åŠ  active é¡åˆ¥
                const targetContent = document.getElementById(tabName + '-tab');
            const targetTab = tabElement || document.querySelector(`.tab[onclick*="'${tabName}'"]`);
                
                if (targetContent) {
                    targetContent.classList.add('active');
                    // æ»¾å‹•åˆ°é ‚éƒ¨ï¼Œä½¿ç”¨å¹³æ»‘æ»¾å‹•
                    requestAnimationFrame(() => {
                        targetContent.scrollTop = 0;
                    });
                }
                
            if (targetTab) {
                targetTab.classList.add('active');
            }
            
                // å¦‚æœéœ€è¦è¼‰å…¥åˆ—è¡¨ï¼Œåœ¨ä¸‹ä¸€å¹€åŸ·è¡Œ
            if (tabName === 'list') {
                    requestAnimationFrame(() => {
                loadProperties();
                    });
            }
            
            // å¦‚æœåˆ‡æ›åˆ°æ–°å¢ç‰©ä»¶é é¢ä¸”ä¸åœ¨ç·¨è¼¯æ¨¡å¼ï¼Œé‡ç½®è¡¨å–®
            if (tabName === 'add' && !editingPropertyId) {
                requestAnimationFrame(() => {
                    resetForm();
                });
            }
            });
        }
        
        // åœ–ç‰‡ä¸Šå‚³è™•ç†ï¼ˆåœ¨ DOMContentLoaded ä¸­åˆå§‹åŒ–ï¼‰
        let isUploading = false; // é˜²æ­¢é‡è¤‡ä¸Šå‚³çš„æ¨™èªŒ
        let isFileDialogOpen = false; // é˜²æ­¢é‡è¤‡é–‹å•Ÿæª”æ¡ˆé¸æ“‡è¦–çª—
        
        document.addEventListener('DOMContentLoaded', function() {
            const uploadArea = document.getElementById('upload-area');
            const fileInput = document.getElementById('file-input');
            
            if (!uploadArea || !fileInput) return;
            
            // æ‹–æ›³ä¸Šå‚³
            uploadArea.addEventListener('dragover', (e) => {
                e.preventDefault();
                e.stopPropagation();
                uploadArea.classList.add('dragover');
            });
            
            uploadArea.addEventListener('dragleave', (e) => {
                e.preventDefault();
                e.stopPropagation();
                uploadArea.classList.remove('dragover');
            });
            
            uploadArea.addEventListener('drop', (e) => {
                e.preventDefault();
                e.stopPropagation();
                uploadArea.classList.remove('dragover');
                
                if (isUploading) {
                    console.log('â³ æ­£åœ¨ä¸Šå‚³ä¸­ï¼Œè«‹ç¨å€™...');
                    return;
                }
                
                const files = Array.from(e.dataTransfer.files).filter(file => file.type.startsWith('image/'));
                if (files.length > 0) {
                    handleFiles(files);
                }
            });
            
            // é»æ“Šä¸Šå‚³å€åŸŸ
            uploadArea.addEventListener('click', function(e) {
                // å¦‚æœé»æ“Šçš„æ˜¯æª”æ¡ˆé¸æ“‡å™¨ã€æŒ‰éˆ•æˆ–åœ–ç‰‡é è¦½å€åŸŸï¼Œä¸è™•ç†
                if (e.target === fileInput || 
                    e.target.tagName === 'BUTTON' || 
                    e.target.closest('button') ||
                    e.target.closest('.image-preview-item') ||
                    e.target.closest('.image-remove')) {
                    return;
                }
                
                // é˜²æ­¢é‡è¤‡è§¸ç™¼
                if (isUploading || isFileDialogOpen) {
                    console.log('â³ æ­£åœ¨è™•ç†ä¸­ï¼Œè«‹ç¨å€™...');
                    return;
                }
                
                e.stopPropagation();
                e.preventDefault();
                
                // æ¨™è¨˜æª”æ¡ˆå°è©±æ¡†ç‚ºé–‹å•Ÿç‹€æ…‹
                isFileDialogOpen = true;
                
                // ç›´æ¥è§¸ç™¼æª”æ¡ˆé¸æ“‡ï¼Œä¸ä½¿ç”¨ setTimeout
                fileInput.click();
            }, true); // ä½¿ç”¨æ•ç²éšæ®µï¼Œç¢ºä¿å„ªå…ˆè™•ç†
            
            // ç›£è½æª”æ¡ˆé¸æ“‡å™¨ç„¦é»è®ŠåŒ–ï¼ˆç•¶æª”æ¡ˆå°è©±æ¡†é—œé–‰æ™‚ï¼‰
            fileInput.addEventListener('focus', function() {
                // æª”æ¡ˆå°è©±æ¡†æ‰“é–‹
                isFileDialogOpen = true;
            });
            
            // æª”æ¡ˆé¸æ“‡å™¨çš„ change äº‹ä»¶
            fileInput.addEventListener('change', function(e) {
                e.stopPropagation();
                e.preventDefault();
                
                // æª”æ¡ˆå°è©±æ¡†å·²é—œé–‰
                isFileDialogOpen = false;
                
                // ç²å–æ‰€æœ‰é¸æ“‡çš„æª”æ¡ˆ
                const files = Array.from(e.target.files || []);
                
                // å¦‚æœæ²’æœ‰é¸æ“‡æª”æ¡ˆï¼ˆç”¨æˆ¶é»æ“Šå–æ¶ˆï¼‰ï¼Œç›´æ¥è¿”å›
                if (files.length === 0) {
                    console.log('ğŸ“‹ æœªé¸æ“‡æª”æ¡ˆ');
                    fileInput.value = '';
                    return;
                }
                
                console.log(`ğŸ“ é¸æ“‡äº† ${files.length} å€‹æª”æ¡ˆ:`, files.map(f => `${f.name} (${(f.size / 1024).toFixed(2)} KB)`));
                
                // ä¿å­˜æª”æ¡ˆåˆ—è¡¨å¾Œç«‹å³æ¸…ç©ºæª”æ¡ˆé¸æ“‡å™¨ï¼Œé˜²æ­¢é‡è¤‡è§¸ç™¼
                const selectedFiles = Array.from(files);
                fileInput.value = '';
                
                // è™•ç†æª”æ¡ˆï¼ˆä¸ä¸Šå‚³ï¼Œåªé è¦½ï¼‰
                handleFiles(selectedFiles);
            });
        
            // ç•¶è¦–çª—å¤±å»ç„¦é»æ™‚ï¼ˆæª”æ¡ˆå°è©±æ¡†é—œé–‰ï¼‰ï¼Œé‡ç½®æ¨™èªŒ
            window.addEventListener('focus', function() {
                setTimeout(() => {
                    isFileDialogOpen = false;
                }, 100);
            });
        });
        
        // è™•ç†æª”æ¡ˆï¼ˆåªé è¦½ï¼Œä¸ä¸Šå‚³ï¼‰
        function handleFiles(files) {
            if (!files || files.length === 0) {
                console.warn('âš ï¸ æ²’æœ‰é¸æ“‡æª”æ¡ˆ');
                return;
            }
            
            console.log(`ğŸ“ æ”¶åˆ° ${files.length} å€‹æª”æ¡ˆ`);
            
            // éæ¿¾å‡ºåœ–ç‰‡æª”æ¡ˆï¼ˆæª¢æŸ¥ MIME type å’Œå‰¯æª”åï¼‰
            const imageFiles = files.filter(file => {
                // æª¢æŸ¥æª”æ¡ˆé¡å‹
                const validTypes = ['image/jpeg', 'image/jpg', 'image/png', 'image/gif', 'image/webp'];
                const isValidType = validTypes.includes(file.type.toLowerCase());
                
                // æª¢æŸ¥æª”æ¡ˆåç¨±å‰¯æª”åï¼ˆæœ‰äº›ç€è¦½å™¨å¯èƒ½æ²’æœ‰æ­£ç¢ºçš„ MIME typeï¼‰
                const fileName = file.name.toLowerCase();
                const hasValidExtension = fileName.endsWith('.jpg') || 
                                         fileName.endsWith('.jpeg') || 
                                         fileName.endsWith('.png') || 
                                         fileName.endsWith('.gif') || 
                                         fileName.endsWith('.webp');
                
                const isValid = isValidType || hasValidExtension;
                
                if (!isValid) {
                    console.warn(`âš ï¸ è·³ééåœ–ç‰‡æª”æ¡ˆ: ${file.name} (type: ${file.type})`);
                }
                
                return isValid;
            });
            
            if (imageFiles.length === 0) {
                showAlert('error', 'è«‹é¸æ“‡åœ–ç‰‡æª”æ¡ˆï¼ˆJPGã€PNGã€GIFã€WEBPï¼‰');
                console.warn('âš ï¸ æ²’æœ‰æœ‰æ•ˆçš„åœ–ç‰‡æª”æ¡ˆ');
                return;
            }
            
            console.log(`ğŸ–¼ï¸ éæ¿¾å¾Œæœ‰ ${imageFiles.length} å€‹åœ–ç‰‡æª”æ¡ˆ`);
            
            // æª¢æŸ¥ç¸½æ•¸æ˜¯å¦è¶…é10å¼µ
            const currentCount = uploadedImages.length;
            const maxImages = 10;
            
            if (currentCount + imageFiles.length > maxImages) {
                const remaining = maxImages - currentCount;
                if (remaining <= 0) {
                    showAlert('error', `æœ€å¤šåªèƒ½ä¸Šå‚³ ${maxImages} å¼µåœ–ç‰‡ï¼Œç›®å‰å·²é”ä¸Šé™`);
                    console.warn(`âš ï¸ å·²é”ä¸Šé™ ${maxImages} å¼µ`);
                    return;
                } else {
                    showAlert('warning', `åªèƒ½å†ä¸Šå‚³ ${remaining} å¼µåœ–ç‰‡ï¼ˆæœ€å¤š ${maxImages} å¼µï¼‰ï¼Œå°‡åªæ·»åŠ å‰ ${remaining} å¼µ`);
                    console.warn(`âš ï¸ åªä¿ç•™å‰ ${remaining} å¼µåœ–ç‰‡`);
                    imageFiles.splice(remaining); // åªå–å‰é¢å¹¾å¼µ
                }
            }
            
            console.log(`ğŸ“¤ æº–å‚™é è¦½ ${imageFiles.length} å€‹åœ–ç‰‡æª”æ¡ˆï¼ˆç›®å‰å·²æœ‰ ${currentCount} å¼µï¼‰`);
            
            // åªæ·»åŠ é è¦½ï¼Œä¸ä¸Šå‚³
            let successCount = 0;
            let failCount = 0;
            
            for (const file of imageFiles) {
                try {
                    addImagePreview(file);
                    successCount++;
                } catch (error) {
                    console.error(`âŒ æ·»åŠ é è¦½å¤±æ•—: ${file.name}`, error);
                    failCount++;
                }
            }
            
            const newTotal = uploadedImages.length;
            console.log(`âœ… æˆåŠŸæ·»åŠ  ${successCount} å¼µåœ–ç‰‡åˆ°é è¦½å€ï¼ˆå…± ${newTotal}/${maxImages} å¼µï¼‰`);
            
            if (failCount > 0) {
                console.warn(`âš ï¸ ${failCount} å¼µåœ–ç‰‡æ·»åŠ å¤±æ•—`);
            }
            
            if (successCount > 0) {
                showAlert('success', `å·²æ·»åŠ  ${successCount} å¼µåœ–ç‰‡åˆ°é è¦½å€ï¼ˆå…± ${newTotal}/${maxImages} å¼µï¼‰`);
            }
        }
        
        // æ·»åŠ åœ–ç‰‡é è¦½ï¼ˆä¸ä¸Šå‚³ï¼Œåªé è¦½ï¼‰
        function addImagePreview(file) {
            // é©—è­‰æª”æ¡ˆé¡å‹
            const validTypes = ['image/jpeg', 'image/jpg', 'image/png', 'image/gif', 'image/webp'];
            if (!validTypes.includes(file.type)) {
                showAlert('error', `ä¸æ”¯æ´çš„æª”æ¡ˆæ ¼å¼: ${file.type}ï¼Œè«‹ä½¿ç”¨ JPGã€PNGã€GIF æˆ– WEBP`);
                return;
            }
            
            // æª¢æŸ¥æª”æ¡ˆå¤§å°ï¼ˆé™åˆ¶ 10MBï¼‰
            const maxSize = 10 * 1024 * 1024; // 10MB
            if (file.size > maxSize) {
                showAlert('error', `æª”æ¡ˆå¤ªå¤§: ${(file.size / 1024 / 1024).toFixed(2)}MBï¼Œè«‹ä¸Šå‚³å°æ–¼ 10MB çš„åœ–ç‰‡`);
                return;
            }
            
            // ç²å–åœ–ç‰‡é è¦½å®¹å™¨
            const imagePreviewGrid = document.getElementById('image-preview-grid');
            if (!imagePreviewGrid) {
                console.error('âŒ æ‰¾ä¸åˆ°åœ–ç‰‡é è¦½å®¹å™¨ #image-preview-grid');
                return false;
            }
            
            const imageId = Date.now() + '_' + Math.random().toString(36).substr(2, 9);
            
            // å‰µå»ºæœ¬åœ°é è¦½ URL
            let previewURL;
            try {
                previewURL = URL.createObjectURL(file);
            } catch (error) {
                console.error(`âŒ ç„¡æ³•å‰µå»ºé è¦½ URL: ${file.name}`, error);
                showAlert('error', `ç„¡æ³•é è¦½åœ–ç‰‡: ${file.name}`);
                return false;
            }
            
            // å„²å­˜æª”æ¡ˆè³‡è¨Šï¼ˆä¸ä¸Šå‚³ï¼‰
            uploadedImages.push({
                file: file, // ä¿å­˜åŸå§‹æª”æ¡ˆç‰©ä»¶
                previewURL: previewURL, // æœ¬åœ°é è¦½ URL
                originalName: file.name,
                fileSize: file.size,
                fileType: file.type,
                imageId: imageId,
                uploadedAt: Date.now()
            });
            
            // å‰µå»ºé è¦½é …ç›®
            try {
                const previewItem = createImagePreviewItemForLocal(imageId, previewURL, file.name);
                if (previewItem) {
                    imagePreviewGrid.appendChild(previewItem);
                    console.log(`âœ… å·²æ·»åŠ åœ–ç‰‡é è¦½: ${file.name} (${(file.size / 1024).toFixed(2)} KB)`);
                    return true;
                } else {
                    console.error(`âŒ ç„¡æ³•å‰µå»ºé è¦½é …ç›®: ${file.name}`);
                    return false;
                }
            } catch (error) {
                console.error(`âŒ å‰µå»ºé è¦½é …ç›®å¤±æ•—: ${file.name}`, error);
                // å¾ uploadedImages ä¸­ç§»é™¤
                uploadedImages.pop();
                URL.revokeObjectURL(previewURL);
                return false;
            }
        }
        
        // ä¸Šå‚³å–®å¼µåœ–ç‰‡ï¼ˆå…ˆä¸Šå‚³åˆ°è‡¨æ™‚ä½ç½®ï¼Œæäº¤æ™‚å†æ•´ç†ï¼‰
        async function uploadImage(file) {
            // æª¢æŸ¥ Supabase æ˜¯å¦å·²åˆå§‹åŒ–
            if (!supabaseClient) {
                isUploading = false; // é‡ç½®æ¨™èªŒ
                showAlert('error', 'è«‹å…ˆè¨­å®š Supabase é…ç½®ï¼Œæ­£åœ¨è·³è½‰åˆ°è¨­å®šé é¢...');
                // è‡ªå‹•è·³è½‰åˆ°è¨­å®šé é¢
                setTimeout(() => {
                    const configTab = document.querySelector('.tab[onclick*="config"]');
                    if (configTab) {
                        switchTab('config', configTab);
                    }
                }, 1000);
                return;
            }
            
            // é©—è­‰æª”æ¡ˆé¡å‹
            const validTypes = ['image/jpeg', 'image/jpg', 'image/png', 'image/gif', 'image/webp'];
            if (!validTypes.includes(file.type)) {
                showAlert('error', `ä¸æ”¯æ´çš„æª”æ¡ˆæ ¼å¼: ${file.type}ï¼Œè«‹ä½¿ç”¨ JPGã€PNGã€GIF æˆ– WEBP`);
                console.warn('âš ï¸ ä¸æ”¯æ´çš„æª”æ¡ˆé¡å‹:', file.type);
                return;
            }
            
            // æª¢æŸ¥æª”æ¡ˆå¤§å°ï¼ˆé™åˆ¶ 10MBï¼‰
            const maxSize = 10 * 1024 * 1024; // 10MB
            if (file.size > maxSize) {
                showAlert('error', `æª”æ¡ˆå¤ªå¤§: ${(file.size / 1024 / 1024).toFixed(2)}MBï¼Œè«‹ä¸Šå‚³å°æ–¼ 10MB çš„åœ–ç‰‡`);
                console.warn('âš ï¸ æª”æ¡ˆéå¤§:', file.size);
                return;
            }
            
            // ç²å–åœ–ç‰‡é è¦½å®¹å™¨
            const imagePreviewGrid = document.getElementById('image-preview-grid');
            if (!imagePreviewGrid) {
                console.error('æ‰¾ä¸åˆ°åœ–ç‰‡é è¦½å®¹å™¨');
                return;
            }
            
            const imageId = Date.now() + '_' + Math.random().toString(36).substr(2, 9);
            const previewItem = createImagePreviewItem(imageId, file);
            // ç«‹å³æ·»åŠ åˆ°é è¦½å€åŸŸï¼ˆå…ˆé¡¯ç¤ºæœ¬åœ°é è¦½ï¼‰
            imagePreviewGrid.appendChild(previewItem);
            
            try {
                // ç”Ÿæˆæª”æ¡ˆåç¨±å’Œè·¯å¾‘ï¼ˆå…ˆä¸Šå‚³åˆ°è‡¨æ™‚è³‡æ–™å¤¾ï¼‰
                const fileExt = file.name.split('.').pop().toLowerCase();
                const fileName = `${Date.now()}_${Math.random().toString(36).substr(2, 9)}.${fileExt}`;
                // ä½¿ç”¨è‡¨æ™‚è³‡æ–™å¤¾ï¼Œç­‰æäº¤æ™‚å†æ ¹æ“šç‰©ä»¶ç·¨è™Ÿæ•´ç†
                const tempFolder = `temp_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;
                const tempPath = `temp/${tempFolder}/${fileName}`;
                
                console.log('ğŸ“¤ é–‹å§‹ä¸Šå‚³åœ–ç‰‡åˆ°è‡¨æ™‚ä½ç½®:', {
                    fileName: file.name,
                    fileSize: file.size,
                    fileType: file.type,
                    tempPath: tempPath,
                    storage: !!storage,
                    db: !!db
                });
                
                // å†æ¬¡æª¢æŸ¥ Supabase æ˜¯å¦æ­£ç¢ºåˆå§‹åŒ–
                if (!supabaseClient) {
                    throw new Error('Supabase æœªåˆå§‹åŒ–ï¼Œè«‹æª¢æŸ¥ Supabase è¨­å®š');
                }
                
                // ä¸Šå‚³åˆ° Supabase Storage è‡¨æ™‚è³‡æ–™å¤¾
                const { data: uploadData, error: uploadError } = await supabaseClient
                    .storage
                    .from('junyang666')
                    .upload(tempPath, file, {
                        cacheControl: '3600',
                        upsert: false
                    });
                
                if (uploadError) {
                    console.error('âŒ ä¸Šå‚³éŒ¯èª¤:', uploadError);
                    console.error('éŒ¯èª¤è©³æƒ…:', {
                        message: uploadError.message,
                        statusCode: uploadError.statusCode
                    });
                    
                    previewItem.remove();
                    let errorMsg = `åœ–ç‰‡ä¸Šå‚³å¤±æ•—: ${file.name}`;
                    
                    // æä¾›æ›´è©³ç´°çš„éŒ¯èª¤è¨Šæ¯
                    if (uploadError.message && uploadError.message.includes('unauthorized')) {
                        errorMsg += ' - æ¬Šé™è¢«æ‹’çµ•ï¼Œè«‹æª¢æŸ¥ Storage è¦å‰‡';
                    } else if (uploadError.message && uploadError.message.includes('canceled')) {
                        errorMsg += ' - ä¸Šå‚³å·²å–æ¶ˆ';
                    } else {
                        errorMsg += ` - ${uploadError.message || 'æœªçŸ¥éŒ¯èª¤'}`;
                    }
                    
                    showAlert('error', errorMsg);
                    isUploading = false;
                    isFileDialogOpen = false;
                    return;
                }
                
                // ä¸Šå‚³å®Œæˆï¼Œå–å¾—å…¬é–‹ URL
                const { data: urlData } = supabaseClient
                    .storage
                    .from('junyang666')
                    .getPublicUrl(tempPath);
                
                const downloadURL = urlData.publicUrl;
                
                console.log('âœ… åœ–ç‰‡ä¸Šå‚³æˆåŠŸ:', {
                    fileName: file.name,
                    downloadURL: downloadURL,
                    tempPath: tempPath
                });
                
                // å„²å­˜ URL å’Œè‡¨æ™‚è·¯å¾‘ï¼ˆæäº¤æ™‚æœƒæ ¹æ“šç‰©ä»¶ç·¨è™Ÿé‡æ–°æ•´ç†ï¼‰
                uploadedImages.push({
                    url: downloadURL,
                    tempKey: tempPath, // è‡¨æ™‚è·¯å¾‘
                    tempFolder: tempFolder, // è‡¨æ™‚è³‡æ–™å¤¾
                    originalName: file.name,
                    fileSize: file.size,
                    uploadedAt: Date.now(),
                    file: file // ä¿ç•™æª”æ¡ˆç‰©ä»¶ï¼Œæ–¹ä¾¿å¾ŒçºŒè™•ç†
                });
                
                // æ›´æ–°é è¦½
                requestAnimationFrame(() => {
                    const img = previewItem.querySelector('img');
                    if (img) {
                        img.src = downloadURL;
                    }
                    const progress = previewItem.querySelector('.upload-progress');
                    if (progress) {
                        progress.style.display = 'none';
                    }
                });
                
                showAlert('success', `åœ–ç‰‡ä¸Šå‚³æˆåŠŸ: ${file.name}`);
                
                // é‡ç½®ä¸Šå‚³ç‹€æ…‹
                isUploading = false;
                isFileDialogOpen = false;
            } catch (error) {
                console.error('âŒ ä¸Šå‚³éŒ¯èª¤:', error);
                console.error('éŒ¯èª¤è©³æƒ…:', error);
                previewItem.remove();
                let errorMsg = `åœ–ç‰‡ä¸Šå‚³å¤±æ•—: ${file.name}`;
                if (error.message) {
                    errorMsg += ` - ${error.message}`;
                }
                showAlert('error', errorMsg);
            }
        }
        
        // å»ºç«‹åœ–ç‰‡é è¦½é …ç›®ï¼ˆæœ¬åœ°é è¦½ç‰ˆæœ¬ï¼Œä¸ä¸Šå‚³ï¼‰
        function createImagePreviewItemForLocal(imageId, previewURL, fileName) {
            const item = document.createElement('div');
            item.className = 'image-preview-item';
            item.dataset.imageId = imageId;
            item.style.position = 'relative';
            
            const img = document.createElement('img');
            img.setAttribute('loading', 'lazy');
            img.setAttribute('decoding', 'async');
            img.src = previewURL;
            img.alt = fileName;
            img.style.backgroundColor = '#f8f9fa';
            img.style.width = '100%';
            img.style.height = '100%';
            img.style.objectFit = 'cover';
            img.onload = function() {
                this.style.backgroundColor = 'transparent';
            };
            img.onerror = function() {
                console.error('åœ–ç‰‡è¼‰å…¥å¤±æ•—:', previewURL);
                this.src = 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCIgZmlsbD0iI2Y4ZjlmYSIvPjx0ZXh0IHg9IjUwJSIgeT0iNTAlIiBmb250LWZhbWlseT0iQXJpYWwiIGZvbnQtc2l6ZT0iMTQiIGZpbGw9IiM5OTkiIHRleHQtYW5jaG9yPSJtaWRkbGUiIGR5PSIuM2VtIj7lm77niYfliqDovb3lpLHotKU8L3RleHQ+PC9zdmc+';
            };
            
            const removeBtn = document.createElement('button');
            removeBtn.className = 'image-remove';
            removeBtn.innerHTML = 'Ã—';
            removeBtn.style.cssText = 'position: absolute; top: 5px; right: 5px; background: rgba(220, 53, 69, 0.9); color: white; border: none; border-radius: 50%; width: 24px; height: 24px; cursor: pointer; font-size: 18px; line-height: 1; display: flex; align-items: center; justify-content: center; z-index: 10;';
            removeBtn.onclick = (e) => {
                e.stopPropagation();
                removeImage(item, imageId);
            };
            
            // é¡¯ç¤ºå¾…ä¸Šå‚³æ¨™ç±¤
            const statusBadge = document.createElement('div');
            statusBadge.className = 'image-status-badge';
            statusBadge.textContent = 'å¾…ä¸Šå‚³';
            statusBadge.style.cssText = 'position: absolute; top: 2px; left: 2px; background: #ffc107; color: #000; padding: 1px 4px; border-radius: 2px; font-size: 9px; font-weight: bold; z-index: 10; line-height: 1.2;';
            
            item.appendChild(img);
            item.appendChild(removeBtn);
            item.appendChild(statusBadge);
            
            return item;
        }
        
        // å»ºç«‹åœ–ç‰‡é è¦½é …ç›®ï¼ˆä¸Šå‚³ç‰ˆæœ¬ï¼Œå¸¶é€²åº¦æ¢ï¼‰
        function createImagePreviewItem(imageId, file) {
            const item = document.createElement('div');
            item.className = 'image-preview-item';
            item.dataset.imageId = imageId;
            
            const img = document.createElement('img');
            // ä½¿ç”¨ç•°æ­¥è¼‰å…¥åœ–ç‰‡
            img.setAttribute('loading', 'lazy');
            img.setAttribute('decoding', 'async');
            // å…ˆå»ºç«‹å ä½ç¬¦ï¼Œé¿å…ä½ˆå±€è·³å‹•
            img.style.backgroundColor = '#f8f9fa';
            const objectUrl = URL.createObjectURL(file);
            img.src = objectUrl;
            // åœ–ç‰‡è¼‰å…¥å®Œæˆå¾Œå„ªåŒ–
            img.onload = function() {
                this.style.backgroundColor = 'transparent';
            };
            
            const removeBtn = document.createElement('button');
            removeBtn.className = 'image-remove';
            removeBtn.innerHTML = 'Ã—';
            removeBtn.onclick = () => {
                URL.revokeObjectURL(objectUrl); // æ¸…ç†è¨˜æ†¶é«”
                removeImage(item, imageId);
            };
            
            const progress = document.createElement('div');
            progress.className = 'upload-progress';
            const progressBar = document.createElement('div');
            progressBar.className = 'upload-progress-bar';
            progressBar.style.width = '0%';
            progress.appendChild(progressBar);
            
            item.appendChild(img);
            item.appendChild(removeBtn);
            item.appendChild(progress);
            
            return item;
        }
        
        // ç§»é™¤åœ–ç‰‡
        async function removeImage(item, imageId) {
            // å¾ uploadedImages ä¸­ç§»é™¤ï¼ˆæ ¹æ“š imageIdï¼‰
            const index = uploadedImages.findIndex(img => img.imageId === imageId);
            if (index !== -1) {
                const imgData = uploadedImages[index];
                
                // å¦‚æœåœ–ç‰‡å·²ç¶“ä¸Šå‚³åˆ° Storageï¼Œå˜—è©¦åˆªé™¤è‡¨æ™‚æª”æ¡ˆ
                if (imgData.tempKey && storage) {
                    try {
                        const tempRef = storage.ref(imgData.tempKey);
                        await tempRef.delete();
                        console.log('ğŸ—‘ï¸ å·²åˆªé™¤è‡¨æ™‚åœ–ç‰‡:', imgData.tempKey);
                    } catch (error) {
                        console.warn('âš ï¸ åˆªé™¤è‡¨æ™‚åœ–ç‰‡å¤±æ•—:', error);
                    }
                }
                
                // æ¸…ç†æœ¬åœ°é è¦½ URL
                if (imgData.previewURL) {
                    URL.revokeObjectURL(imgData.previewURL);
                }
                
                uploadedImages.splice(index, 1);
                console.log(`ğŸ—‘ï¸ å·²ç§»é™¤åœ–ç‰‡: ${imgData.originalName || 'æœªçŸ¥'}`);
            }
            item.remove();
        }
        
        // ä¸Šå‚³ä¸¦æ•´ç†åœ–ç‰‡ï¼šå°‡æœ¬åœ°é è¦½çš„åœ–ç‰‡ä¸Šå‚³åˆ°æ­£ç¢ºçš„ç‰©ä»¶è³‡æ–™å¤¾
        async function uploadAndOrganizeImages(propertyNumber) {
            console.log('ğŸ“ é–‹å§‹ä¸Šå‚³ä¸¦æ•´ç†åœ–ç‰‡ï¼Œç‰©ä»¶ç·¨è™Ÿ:', propertyNumber);
            console.log('ğŸ“Š ç›®å‰ uploadedImages:', uploadedImages);
            
            if (!uploadedImages || uploadedImages.length === 0) {
                console.log('âš ï¸ æ²’æœ‰åœ–ç‰‡éœ€è¦ä¸Šå‚³');
                return [];
            }
            
            if (!supabaseClient) {
                console.error('âŒ Supabase æœªåˆå§‹åŒ–');
                throw new Error('Supabase æœªåˆå§‹åŒ–ï¼Œè«‹æª¢æŸ¥ Supabase è¨­å®š');
            }
            
            // åˆ¤æ–·æ˜¯å¦ç‚ºåº—å¤–ç‰©ä»¶ï¼ˆç·¨è™Ÿä»¥ EX é–‹é ­ï¼‰
            const isExternal = propertyNumber.startsWith('EX');
            
            // å¾ç·¨è™Ÿæå–é¡å‹ä»£ç¢¼ï¼ˆåº—å…§ï¼šSU00001 -> SUï¼Œåº—å¤–ï¼šEXSU0001 -> SUï¼‰
            let typeCode = '';
            if (isExternal) {
                // åº—å¤–ï¼šEXSU0001 -> SU
                typeCode = propertyNumber.substring(2, 4); // EX å¾Œé¢çš„ 2 å€‹å­—æ¯
            } else {
                // åº—å…§ï¼šSU00001 -> SU
                typeCode = propertyNumber.substring(0, 2); // å‰ 2 å€‹å­—æ¯
            }
            
            // ç”Ÿæˆåœ–ç‰‡å„²å­˜è·¯å¾‘
            let basePath;
            if (isExternal) {
                // åº—å¤–ç‰©ä»¶ï¼šproperties/external/SU/EXSU0001/image_1.jpg
                basePath = `properties/external/${typeCode}/${propertyNumber}`;
            } else {
                // åº—å…§ç‰©ä»¶ï¼šproperties/SU/SU00001/image_1.jpg
                basePath = `properties/${typeCode}/${propertyNumber}`;
            }
            
            const organizedImages = [];
            const uploadedUrls = [];
            
            console.log(`ğŸ“ é–‹å§‹è™•ç† ${uploadedImages.length} å¼µåœ–ç‰‡åˆ°è³‡æ–™å¤¾: ${basePath}/`);
            
            for (let i = 0; i < uploadedImages.length; i++) {
                const img = uploadedImages[i];
                console.log(`\nğŸ–¼ï¸ è™•ç†åœ–ç‰‡ ${i + 1}/${uploadedImages.length}:`, {
                    hasFile: !!img.file,
                    hasUrl: !!img.url,
                    hasTempKey: !!img.tempKey,
                    fileName: img.file?.name || img.originalName || 'æœªçŸ¥'
                });
                
                try {
                    // å¦‚æœåœ–ç‰‡å·²ç¶“ä¸Šå‚³éï¼ˆæœ‰ URL ä¸”æ²’æœ‰ fileï¼‰ï¼Œç›´æ¥ä½¿ç”¨
                    if (img.url && !img.file && !img.tempKey) {
                        console.log(`âœ… åœ–ç‰‡å·²å­˜åœ¨ï¼Œç›´æ¥ä½¿ç”¨: ${img.url}`);
                        uploadedUrls.push(img.url);
                        organizedImages.push({
                            url: img.url,
                            key: img.key || img.url
                        });
                        continue;
                    }
                    
                    // å¦‚æœæœ‰æª”æ¡ˆç‰©ä»¶ï¼Œéœ€è¦ä¸Šå‚³ï¼ˆæœ€å¸¸è¦‹çš„æƒ…æ³ï¼‰
                    if (img.file) {
                        const file = img.file;
                        
                        // ç¢ºä¿æª”æ¡ˆæœ‰æ•ˆ
                        if (!file || !file.name) {
                            console.warn(`âš ï¸ åœ–ç‰‡ ${i + 1} æª”æ¡ˆç„¡æ•ˆï¼Œè·³é`);
                            continue;
                        }
                        
                        const fileExt = file.name.split('.').pop().toLowerCase();
                        // ä½¿ç”¨ç°¡å–®çš„åºè™Ÿå‘½åï¼šimage_1.jpg, image_2.jpg, ...
                        const fileName = `image_${i + 1}.${fileExt}`;
                        const newPath = `${basePath}/${fileName}`;
                        
                        console.log(`ğŸ“¤ [${i + 1}/${uploadedImages.length}] ä¸Šå‚³åœ–ç‰‡: ${file.name} (${(file.size / 1024).toFixed(2)}KB) â†’ ${newPath}`);
                        
                        // ä¸Šå‚³åˆ° Supabase Storage
                        const { data: uploadData, error: uploadError } = await supabaseClient
                            .storage
                            .from('junyang666')
                            .upload(newPath, file, {
                                cacheControl: '3600',
                                upsert: false
                            });
                        
                        if (uploadError) {
                            throw uploadError;
                        }
                        
                        // å–å¾—å…¬é–‹ URL
                        const { data: urlData } = supabaseClient
                            .storage
                            .from('junyang666')
                            .getPublicUrl(newPath);
                        
                        const downloadURL = urlData.publicUrl;
                        
                        console.log(`âœ… [${i + 1}/${uploadedImages.length}] åœ–ç‰‡ä¸Šå‚³å®Œæˆ: ${fileName}`);
                        
                        uploadedUrls.push(downloadURL);
                        organizedImages.push({
                            url: downloadURL,
                            key: newPath
                        });
                        
                        // æ¸…ç†æœ¬åœ°é è¦½ URL
                        if (img.previewURL) {
                            URL.revokeObjectURL(img.previewURL);
                        }
                    } else if (img.tempKey) {
                        // å¦‚æœæ˜¯å¾è‡¨æ™‚ä½ç½®ç§»å‹•ï¼ˆä½¿ç”¨ Supabase Storageï¼‰
                        try {
                            const fileExt = img.tempKey.split('.').pop() || 'jpg';
                            // ä½¿ç”¨ç°¡å–®çš„åºè™Ÿå‘½åï¼šimage_1.jpg, image_2.jpg, ...
                            const fileName = `image_${i + 1}.${fileExt}`;
                            const newPath = `${basePath}/${fileName}`;
                            
                            // å¾è‡¨æ™‚ä½ç½®ä¸‹è¼‰æª”æ¡ˆ
                            const { data: downloadData, error: downloadError } = await supabaseClient
                                .storage
                                .from('junyang666')
                                .download(img.tempKey);
                            
                            if (downloadError) throw downloadError;
                            
                            // ä¸Šå‚³åˆ°æ–°ä½ç½®
                            const { data: uploadData, error: uploadError } = await supabaseClient
                                .storage
                                .from('junyang666')
                                .upload(newPath, downloadData, {
                                    cacheControl: '3600',
                                    upsert: false
                                });
                            
                            if (uploadError) throw uploadError;
                            
                            // å–å¾—æ–°ä½ç½®çš„å…¬é–‹ URL
                            const { data: urlData } = supabaseClient
                                .storage
                                .from('junyang666')
                                .getPublicUrl(newPath);
                            
                            const newDownloadURL = urlData.publicUrl;
                            
                            // åˆªé™¤è‡¨æ™‚æª”æ¡ˆ
                            try {
                                await supabaseClient
                                    .storage
                                    .from('junyang666')
                                    .remove([img.tempKey]);
                            } catch (deleteError) {
                                console.warn('âš ï¸ åˆªé™¤è‡¨æ™‚æª”æ¡ˆå¤±æ•—ï¼ˆå¯å¿½ç•¥ï¼‰:', deleteError);
                            }
                            
                            uploadedUrls.push(newDownloadURL);
                            organizedImages.push({
                                url: newDownloadURL,
                                key: newPath
                            });
                            
                            console.log(`âœ… åœ–ç‰‡å·²ç§»å‹•: ${img.tempKey} â†’ ${newPath}`);
                        } catch (moveError) {
                            console.error(`âŒ ç§»å‹•åœ–ç‰‡å¤±æ•— (${img.tempKey}):`, moveError);
                            // å¦‚æœç§»å‹•å¤±æ•—ï¼Œå˜—è©¦ä½¿ç”¨åŸå§‹ URLï¼ˆå¦‚æœæœ‰çš„è©±ï¼‰
                            if (img.url) {
                                console.log(`ğŸ“ ä½¿ç”¨åŸå§‹ URL: ${img.url}`);
                                uploadedUrls.push(img.url);
                                organizedImages.push({
                                    url: img.url,
                                    key: img.key || img.tempKey
                                });
                            } else {
                                // å¦‚æœæ²’æœ‰åŸå§‹ URLï¼Œè¨˜éŒ„éŒ¯èª¤ä½†ç¹¼çºŒè™•ç†å…¶ä»–åœ–ç‰‡
                                console.warn(`âš ï¸ è·³éåœ–ç‰‡: ${img.tempKey}ï¼ˆç„¡æ³•ç§»å‹•ä¸”ç„¡åŸå§‹ URLï¼‰`);
                            }
                        }
                    } else {
                        // å¦‚æœéƒ½æ²’æœ‰ï¼ˆfileã€urlã€tempKeyï¼‰ï¼Œè¨˜éŒ„è­¦å‘Š
                        console.warn(`âš ï¸ åœ–ç‰‡ ${i + 1} ç„¡æœ‰æ•ˆè³‡æ–™ï¼ˆç„¡ fileã€url æˆ– tempKeyï¼‰ï¼Œè·³é`);
                    }
                } catch (error) {
                    console.error(`âŒ è™•ç†åœ–ç‰‡ ${i + 1} å¤±æ•—:`, error);
                    console.error('  éŒ¯èª¤è©³æƒ…:', {
                        message: error.message,
                        code: error.code,
                        fileName: img.file?.name || img.originalName || 'æœªçŸ¥'
                    });
                    
                    // å¦‚æœè™•ç†å¤±æ•—ï¼Œå˜—è©¦ä½¿ç”¨åŸå§‹ URLï¼ˆå¦‚æœæœ‰çš„è©±ï¼‰
                    if (img.url) {
                        console.log(`  ğŸ“ å˜—è©¦ä½¿ç”¨åŸå§‹ URL: ${img.url}`);
                        uploadedUrls.push(img.url);
                        organizedImages.push({
                            url: img.url,
                            key: img.tempKey || img.key || img.url
                        });
                    } else {
                        console.warn(`  âš ï¸ åœ–ç‰‡ ${i + 1} è™•ç†å¤±æ•—ä¸”ç„¡å‚™ç”¨ URLï¼Œå°‡è·³éæ­¤åœ–ç‰‡`);
                    }
                }
            }
            
            console.log(`\nğŸ“Š åœ–ç‰‡è™•ç†å®Œæˆ:`);
            console.log(`  âœ… æˆåŠŸ: ${uploadedUrls.length}/${uploadedImages.length}`);
            console.log(`  ğŸ“‹ æœ€çµ‚ URL åˆ—è¡¨:`, uploadedUrls);
            
            if (uploadedUrls.length === 0 && uploadedImages.length > 0) {
                console.warn('âš ï¸ è­¦å‘Šï¼šæ‰€æœ‰åœ–ç‰‡è™•ç†å¤±æ•—ï¼Œä½†ä»æœƒç¹¼çºŒå„²å­˜ç‰©ä»¶è³‡æ–™');
            }
            
            return uploadedUrls;
        }
        
        // æ•´ç†åœ–ç‰‡ï¼šå°‡è‡¨æ™‚ä½ç½®çš„åœ–ç‰‡ç§»å‹•åˆ°æ­£ç¢ºçš„ç‰©ä»¶è³‡æ–™å¤¾ï¼ˆä¿ç•™ä½œç‚ºå‚™ç”¨ï¼‰
        async function organizeImages(propertyNumber) {
            if (!uploadedImages || uploadedImages.length === 0) {
                return [];
            }
            
            const organizedImages = [];
            
            console.log('ğŸ“ é–‹å§‹æ•´ç†åœ–ç‰‡åˆ°è³‡æ–™å¤¾:', `properties/${propertyNumber}/`);
            
            for (let i = 0; i < uploadedImages.length; i++) {
                const img = uploadedImages[i];
                try {
                    if (img.tempKey) {
                        // åœ–ç‰‡åœ¨è‡¨æ™‚ä½ç½®ï¼Œéœ€è¦ç§»å‹•åˆ°æ­£ç¢ºä½ç½®ï¼ˆä½¿ç”¨ Supabase Storageï¼‰
                        try {
                            const fileName = img.tempKey.split('/').pop();
                            const newPath = `properties/${propertyNumber}/${fileName}`;
                            
                            // å¾è‡¨æ™‚ä½ç½®ä¸‹è¼‰æª”æ¡ˆ
                            const { data: downloadData, error: downloadError } = await supabaseClient
                                .storage
                                .from('junyang666')
                                .download(img.tempKey);
                            
                            if (downloadError) throw downloadError;
                            
                            // ä¸Šå‚³åˆ°æ–°ä½ç½®
                            const { data: uploadData, error: uploadError } = await supabaseClient
                                .storage
                                .from('junyang666')
                                .upload(newPath, downloadData, {
                                    cacheControl: '3600',
                                    upsert: false
                                });
                            
                            if (uploadError) throw uploadError;
                            
                            // å–å¾—æ–°ä½ç½®çš„å…¬é–‹ URL
                            const { data: urlData } = supabaseClient
                                .storage
                                .from('junyang666')
                                .getPublicUrl(newPath);
                            
                            const newDownloadURL = urlData.publicUrl;
                            
                            // åˆªé™¤è‡¨æ™‚æª”æ¡ˆ
                            try {
                                await supabaseClient
                                    .storage
                                    .from('junyang666')
                                    .remove([img.tempKey]);
                            } catch (deleteError) {
                                console.warn('âš ï¸ åˆªé™¤è‡¨æ™‚æª”æ¡ˆå¤±æ•—ï¼ˆå¯å¿½ç•¥ï¼‰:', deleteError);
                            }
                            
                            console.log(`âœ… åœ–ç‰‡å·²ç§»å‹•: ${img.tempKey} â†’ ${newPath}`);
                            
                            organizedImages.push({
                                url: newDownloadURL,
                                key: newPath
                            });
                        } catch (moveError) {
                            console.error(`âŒ ç§»å‹•åœ–ç‰‡å¤±æ•— (${img.tempKey}):`, moveError);
                            // å¦‚æœç§»å‹•å¤±æ•—ï¼Œå˜—è©¦ä½¿ç”¨åŸå§‹ URLï¼ˆå¦‚æœæœ‰çš„è©±ï¼‰
                            if (img.url) {
                                organizedImages.push({
                                    url: img.url,
                                    key: img.key || img.tempKey
                                });
                            }
                        }
                    } else if (img.url) {
                        // å¦‚æœå·²ç¶“æ˜¯æ­£ç¢ºä½ç½®çš„åœ–ç‰‡ï¼Œç›´æ¥ä½¿ç”¨
                        organizedImages.push({
                            url: img.url,
                            key: img.key || img.url
                        });
                    }
                } catch (error) {
                    console.error(`âŒ æ•´ç†åœ–ç‰‡å¤±æ•— (${img.originalName || 'æœªçŸ¥'}):`, error);
                    // å¦‚æœç§»å‹•å¤±æ•—ï¼Œå˜—è©¦ä½¿ç”¨åŸå§‹ URL
                    if (img.url) {
                        organizedImages.push({
                            url: img.url,
                            key: img.tempKey || img.key || img.url
                        });
                    }
                }
            }
            
            // æ¸…ç†æ‰€æœ‰è‡¨æ™‚è³‡æ–™å¤¾
            try {
                const tempFolders = [...new Set(uploadedImages.map(img => img.tempFolder).filter(f => f))];
                for (const folder of tempFolders) {
                    try {
                        // åˆ—å‡ºè‡¨æ™‚è³‡æ–™å¤¾ä¸­çš„æ‰€æœ‰æª”æ¡ˆ
                        const { data: files, error: listError } = await supabaseClient
                            .storage
                            .from('junyang666')
                            .list(`temp/${folder}`);
                        
                        if (listError) throw listError;
                        
                        // åˆªé™¤æ‰€æœ‰æª”æ¡ˆ
                        if (files && files.length > 0) {
                            const filePaths = files.map(file => `temp/${folder}/${file.name}`);
                            const { error: removeError } = await supabaseClient
                                .storage
                                .from('junyang666')
                                .remove(filePaths);
                            
                            if (removeError) throw removeError;
                            console.log(`ğŸ—‘ï¸ å·²æ¸…ç†è‡¨æ™‚è³‡æ–™å¤¾: temp/${folder}`);
                        }
                    } catch (error) {
                        console.warn(`âš ï¸ æ¸…ç†è‡¨æ™‚è³‡æ–™å¤¾å¤±æ•—: temp/${folder}`, error);
                    }
                }
            } catch (error) {
                console.warn('âš ï¸ æ¸…ç†è‡¨æ™‚è³‡æ–™å¤¾æ™‚ç™¼ç”ŸéŒ¯èª¤:', error);
            }
            
            return organizedImages.map(img => img.url);
        }
        
        // å„²å­˜ç‰©ä»¶
        async function saveProperty() {
            // æª¢æŸ¥ Supabase æ˜¯å¦å·²åˆå§‹åŒ–
            if (!supabaseClient) {
                showAlert('error', 'è«‹å…ˆè¨­å®š Supabase é…ç½®ï¼Œæ­£åœ¨è·³è½‰åˆ°è¨­å®šé é¢...');
                // è‡ªå‹•è·³è½‰åˆ°è¨­å®šé é¢
                setTimeout(() => {
                    const configTab = document.querySelector('.tab[onclick*="config"]');
                    if (configTab) {
                        switchTab('config', configTab);
                    }
                }, 1000);
                return;
            }
            
            // æ¸¬è©¦ Supabase é€£æ¥
            try {
                const { error } = await supabaseClient
                    .from('properties')
                    .select('id')
                    .limit(1);
                
                if (error) throw error;
            } catch (error) {
                console.error('âŒ Supabase é€£æ¥æ¸¬è©¦å¤±æ•—:', error);
                showAlert('error', `Supabase é€£æ¥å¤±æ•—ï¼š${error.message}ã€‚è«‹æª¢æŸ¥ Supabase è¨­å®šã€‚`);
                return;
            }
            
            const saveBtn = document.getElementById('save-btn');
            saveBtn.disabled = true;
            saveBtn.textContent = 'â³ å„²å­˜ä¸­...';
            
            try {
                // è‡ªå‹•ç”Ÿæˆç‰©ä»¶ç·¨è™Ÿï¼ˆæ–°å¢æ™‚å¿…é ˆç”Ÿæˆï¼‰
                let propertyNumber = document.getElementById('number').value.trim();
                if (!propertyNumber || !editingPropertyId) {
                    // å¦‚æœæ²’æœ‰ç·¨è™Ÿæˆ–æ˜¯åœ¨æ–°å¢æ¨¡å¼ï¼Œå¼·åˆ¶ç”Ÿæˆæ–°ç·¨è™Ÿ
                    const type = document.getElementById('type').value.trim();
                    if (!type) {
                        throw new Error('è«‹å…ˆé¸æ“‡æˆ¿å‹ä»¥è‡ªå‹•ç”Ÿæˆç‰©ä»¶ç·¨è™Ÿ');
                    }
                    await generatePropertyNumber();
                    propertyNumber = document.getElementById('number').value.trim();
                    if (!propertyNumber) {
                        throw new Error('ç„¡æ³•ç”Ÿæˆç‰©ä»¶ç·¨è™Ÿï¼Œè«‹ç¨å¾Œå†è©¦');
                    }
                }
                
                // æª¢æŸ¥ç·¨è™Ÿæ˜¯å¦é‡è¤‡ï¼ˆç·¨è¼¯æ™‚æ’é™¤è‡ªå·±ï¼‰
                const existingNumbers = await getAllPropertyNumbers();
                if (editingPropertyId) {
                    try {
                        const { data: currentData, error } = await supabaseClient
                            .from('properties')
                            .select('number')
                            .eq('id', editingPropertyId)
                            .single();
                        
                        if (!error && currentData && currentData.number) {
                            const index = existingNumbers.indexOf(currentData.number);
                            if (index > -1) {
                                existingNumbers.splice(index, 1);
                            }
                        }
                    } catch (error) {
                        console.warn('âš ï¸ ç„¡æ³•ç²å–ç•¶å‰ç‰©ä»¶ç·¨è™Ÿ:', error);
                    }
                }
                
                if (existingNumbers.includes(propertyNumber)) {
                    throw new Error(`ç‰©ä»¶ç·¨è™Ÿ "${propertyNumber}" å·²å­˜åœ¨ï¼Œè«‹ä½¿ç”¨å…¶ä»–ç·¨è™Ÿ`);
                }
                
                // ç²å–ç¸£å¸‚å’Œå€åŸŸ
                const city = document.getElementById('city').value.trim();
                const district = document.getElementById('district').value.trim();
                let address = document.getElementById('address').value.trim();
                const hideAddressNumber = document.getElementById('hide_address_number').checked;
                
                // çµ„åˆå®Œæ•´åœ°å€
                let fullAddress = '';
                if (city && district) {
                    fullAddress = city + district;
                    if (address) {
                        fullAddress += address;
                    }
                } else if (address) {
                    fullAddress = address;
                }
                
                // è™•ç†åœ°å€ï¼ˆéš±è—é–€ç‰Œè™Ÿç¢¼ï¼‰
                if (hideAddressNumber && address) {
                    // éš±è—é–€ç‰Œè™Ÿç¢¼ï¼šç§»é™¤ã€Œè™Ÿã€ã€ã€Œæ¨“ã€ç­‰å¾Œé¢çš„éƒ¨åˆ†
                    // ä¾‹å¦‚ï¼š
                    // ã€Œæ¢…ç…è·¯äºŒæ®µ232å··10è™Ÿ10æ¨“ã€->ã€Œæ¢…ç…è·¯äºŒæ®µ232å··ã€
                    // ã€ŒXXè·¯123è™Ÿã€->ã€ŒXXè·¯ã€
                    // ã€ŒXXè·¯123è™Ÿ10æ¨“ã€->ã€ŒXXè·¯ã€
                    // ã€ŒXXè·¯123è™Ÿ10Fã€->ã€ŒXXè·¯ã€
                    
                    // åŒ¹é…ã€Œè™Ÿã€å¾Œé¢å¯èƒ½è·Ÿè‘—çš„æ•¸å­—ã€å­—æ¯ã€Fã€æ¨“ç­‰ï¼Œç›´åˆ°çµå°¾
                    // ä½†è¦ä¿ç•™ã€Œå··ã€ã€ã€Œå¼„ã€ç­‰
                    address = address.replace(/è™Ÿ[\d\w\-\s]*[æ¨“å±¤F]*.*$/i, '');
                    
                    // ä¹Ÿè™•ç†ç›´æ¥ä»¥æ•¸å­—+ã€Œæ¨“ã€çµå°¾çš„æƒ…æ³ï¼ˆå¦‚ã€ŒXXè·¯123æ¨“ã€ï¼‰
                    address = address.replace(/[\d]+[æ¨“å±¤F]+.*$/i, '');
                    
                    // æ¸…ç†å¤šé¤˜ç©ºæ ¼å’Œçµå°¾ç¬¦è™Ÿ
                    address = address.replace(/[\s\-]+$/, '').trim();
                    
                    // é‡æ–°çµ„åˆå®Œæ•´åœ°å€
                    if (city && district) {
                        fullAddress = city + district + address;
                    } else {
                        fullAddress = address;
                    }
                }
                
                // æ”¶é›†è¡¨å–®è³‡æ–™
                const propertyData = {
                    number: propertyNumber,
                    title: document.getElementById('title').value.trim(),
                    type: document.getElementById('type').value.trim(),
                    city: city,
                    district: district,
                    address: fullAddress,
                    address_detail: address, // å„²å­˜è©³ç´°åœ°å€ï¼ˆä¸å«ç¸£å¸‚å€åŸŸï¼‰
                    hide_address_number: hideAddressNumber,
                    price: document.getElementById('price').value.trim(),
                    layout: document.getElementById('layout').value.trim(),
                    total_area: document.getElementById('total_area').value.trim(),
                    is_published: document.getElementById('is_published').value === 'true',
                    is_external: document.getElementById('is_external').value === 'true',
                    status: document.getElementById('status').value.trim() || null,
                    status_text: document.getElementById('statusText').value.trim() || null,
                    community: document.getElementById('community').value.trim(),
                    main_area: document.getElementById('main_area').value.trim(),
                    auxiliary_area: document.getElementById('auxiliary_area').value.trim(),
                    common_area: document.getElementById('common_area').value.trim(),
                    land_area: document.getElementById('land_area').value.trim(),
                    parking_area: document.getElementById('parking_area').value.trim(),
                    age: document.getElementById('age').value.trim(),
                    floor: document.getElementById('floor').value.trim(),
                    building_type: document.getElementById('building_type').value.trim(),
                    orientation: document.getElementById('orientation').value.trim(),
                    management_fee: document.getElementById('management_fee').value.trim(),
                    parking_type: document.getElementById('parking_type').value.trim(),
                    parking_space: document.getElementById('parking_space').value.trim(),
                    current_status: document.getElementById('current_status').value.trim(),
                    description: document.getElementById('description').value.trim(),
                    google_maps: document.getElementById('google_maps').value.trim(),
                    tiktok_video_id: document.getElementById('tiktok_video_id').value.trim(),
                    tiktok_username: document.getElementById('tiktok_username').value.trim(),
                    reference_link: document.getElementById('reference_link').value.trim()
                };
                
                // è™•ç†æ¨™ç±¤é¸æ“‡æ¬„ä½
                if (selectedTags.facilities.length > 0) {
                    propertyData.facilities = [...selectedTags.facilities];
                }
                
                if (selectedTags.transport.length > 0) {
                    propertyData.transport = [...selectedTags.transport];
                }
                
                if (selectedTags.schools.length > 0) {
                    propertyData.schools = [...selectedTags.schools];
                }
                
                const market = document.getElementById('market').value.trim();
                if (market) propertyData.market = market;
                
                const park = document.getElementById('park').value.trim();
                if (park) propertyData.park = park;
                
                // è™•ç† transportation ç‰©ä»¶
                if (propertyData.facilities || propertyData.transport || propertyData.schools || propertyData.market || propertyData.park) {
                    propertyData.transportation = {
                        facilities: propertyData.facilities || [],
                        transport: propertyData.transport || [],
                        schools: propertyData.schools || [],
                        market: propertyData.market || '',
                        park: propertyData.park || ''
                    };
                    delete propertyData.facilities;
                    delete propertyData.transport;
                    delete propertyData.schools;
                    delete propertyData.market;
                    delete propertyData.park;
                }
                
                // è™•ç† features
                const featuresText = document.getElementById('features').value.trim();
                if (featuresText) {
                    propertyData.features = featuresText.split('\n').map(line => line.trim()).filter(line => line);
                }
                
                // æ•´ç†åœ–ç‰‡ï¼šå°‡æœ¬åœ°é è¦½çš„åœ–ç‰‡ä¸Šå‚³åˆ°æ­£ç¢ºçš„ç‰©ä»¶è³‡æ–™å¤¾
                saveBtn.textContent = 'â³ ä¸Šå‚³åœ–ç‰‡ä¸­...';
                console.log('ğŸ“¤ é–‹å§‹ä¸Šå‚³åœ–ç‰‡ï¼Œç‰©ä»¶ç·¨è™Ÿ:', propertyNumber);
                console.log('ğŸ“Š å¾…ä¸Šå‚³åœ–ç‰‡æ•¸é‡:', uploadedImages.length);
                
                let organizedImageUrls = [];
                try {
                    organizedImageUrls = await uploadAndOrganizeImages(propertyNumber);
                    console.log('âœ… åœ–ç‰‡ä¸Šå‚³å®Œæˆï¼ŒæˆåŠŸä¸Šå‚³:', organizedImageUrls.length, 'å¼µ');
                    propertyData.images = organizedImageUrls;
                } catch (imageError) {
                    console.error('âŒ åœ–ç‰‡ä¸Šå‚³éç¨‹ä¸­ç™¼ç”ŸéŒ¯èª¤:', imageError);
                    // å³ä½¿åœ–ç‰‡ä¸Šå‚³å¤±æ•—ï¼Œä¹Ÿç¹¼çºŒå„²å­˜å…¶ä»–è³‡æ–™ï¼ˆä½†è¨˜éŒ„è­¦å‘Šï¼‰
                    propertyData.images = [];
                    showAlert('warning', `åœ–ç‰‡ä¸Šå‚³å¤±æ•—ï¼Œä½†å°‡ç¹¼çºŒå„²å­˜ç‰©ä»¶è³‡æ–™ã€‚éŒ¯èª¤: ${imageError.message}`);
                }
                
                // æ·»åŠ æ™‚é–“æˆ³
                propertyData.updated_at = new Date().toISOString();
                
                // æ¸…ç†ç©ºå­—ä¸²æ¬„ä½
                Object.keys(propertyData).forEach(key => {
                    if (propertyData[key] === '' || propertyData[key] === null) {
                        delete propertyData[key];
                    }
                });
                
                console.log('ğŸ’¾ æº–å‚™å„²å­˜ç‰©ä»¶è³‡æ–™:', {
                    number: propertyData.number,
                    title: propertyData.title,
                    type: propertyData.type,
                    is_published: propertyData.is_published,
                    imagesCount: propertyData.images?.length || 0,
                    images: propertyData.images
                });
                
                // ç¢ºä¿ images æ˜¯é™£åˆ—æ ¼å¼ï¼ˆSupabase JSONB éœ€è¦ï¼‰
                if (propertyData.images && !Array.isArray(propertyData.images)) {
                    console.warn('âš ï¸ images ä¸æ˜¯é™£åˆ—æ ¼å¼ï¼Œè½‰æ›ç‚ºé™£åˆ—');
                    propertyData.images = Array.isArray(propertyData.images) ? propertyData.images : [propertyData.images];
                }
                
                let result;
                
                saveBtn.textContent = 'â³ å„²å­˜è³‡æ–™ä¸­...';
                
                // å¦‚æœæœ‰ç·¨è¼¯ IDï¼ŒåŸ·è¡Œæ›´æ–°
                if (editingPropertyId) {
                    console.log('ğŸ”„ æ›´æ–°ç‰©ä»¶ï¼ŒID:', editingPropertyId);
                    const { data, error } = await supabaseClient
                        .from('properties')
                        .update(propertyData)
                        .eq('id', editingPropertyId)
                        .select()
                        .single();
                    
                    if (error) throw error;
                    
                    result = data;
                    console.log('âœ… ç‰©ä»¶æ›´æ–°æˆåŠŸ:', result.id);
                    showAlert('success', 'ç‰©ä»¶å·²æ›´æ–°ï¼');
                } else {
                    // æ–°å¢ç‰©ä»¶
                    console.log('â• æ–°å¢ç‰©ä»¶åˆ°è³‡æ–™åº«...');
                    propertyData.created_at = new Date().toISOString();
                    
                    const { data: insertData, error } = await supabaseClient
                        .from('properties')
                        .insert([propertyData])
                        .select();
                    
                    if (error) throw error;
                    
                    // å–å¾—æ–°å¢çš„è³‡æ–™ï¼ˆä¸ä½¿ç”¨ .single()ï¼Œå› ç‚ºå¯èƒ½æœƒæœ‰å•é¡Œï¼‰
                    result = insertData && insertData.length > 0 ? insertData[0] : null;
                    if (!result) {
                        throw new Error('æ–°å¢æˆåŠŸä½†ç„¡æ³•å–å¾—è³‡æ–™');
                    }
                    console.log('âœ… ç‰©ä»¶æ–°å¢æˆåŠŸ:', {
                        id: result.id,
                        number: propertyNumber
                    });
                    showAlert('success', `ç‰©ä»¶å·²æ–°å¢ï¼ç·¨è™Ÿ: ${propertyNumber}ï¼ŒID: ${result.id}`);
                }
                
                // æ›´æ–° uploadedImages ç‚ºæ•´ç†å¾Œçš„è·¯å¾‘
                uploadedImages = organizedImageUrls.map(url => ({ url, key: url }));
                
                // é‡è¨­è¡¨å–®
                if (!editingPropertyId) {
                    resetForm();
                } else {
                    editingPropertyId = null;
                }
                
                // æ›´æ–°åˆ—è¡¨
                if (document.getElementById('list-tab').classList.contains('active')) {
                    loadProperties();
                }
            } catch (error) {
                console.error('âŒ å„²å­˜ç‰©ä»¶å¤±æ•—:', error);
                console.error('éŒ¯èª¤è©³æƒ…:', {
                    message: error.message,
                    code: error.code,
                    stack: error.stack,
                    name: error.name
                });
                
                let errorMessage = 'å„²å­˜å¤±æ•—ï¼š';
                if (error.message) {
                    errorMessage += error.message;
                } else if (error.code) {
                    errorMessage += `éŒ¯èª¤ä»£ç¢¼: ${error.code}`;
                } else {
                    errorMessage += 'æœªçŸ¥éŒ¯èª¤ï¼Œè«‹æŸ¥çœ‹æ§åˆ¶å°';
                }
                
                // å¦‚æœæ˜¯ç¶²è·¯éŒ¯èª¤æˆ– CORS éŒ¯èª¤ï¼Œæä¾›æ›´è©³ç´°çš„èªªæ˜
                if (error.message && error.message.includes('CORS')) {
                    errorMessage += 'ã€‚é€™å¯èƒ½æ˜¯ Supabase Storage è¦å‰‡è¨­å®šå•é¡Œï¼Œè«‹æª¢æŸ¥ Storage Policiesã€‚';
                }
                
                showAlert('error', errorMessage);
            } finally {
                saveBtn.disabled = false;
                saveBtn.textContent = 'ğŸ’¾ å„²å­˜åˆ°è³‡æ–™åº«';
                console.log('ğŸ”„ å„²å­˜æµç¨‹å®Œæˆï¼ŒæŒ‰éˆ•å·²æ¢å¾©');
            }
        }
        
        // æ¸¬è©¦åŠŸèƒ½ï¼šæ¸¬è©¦æ–°å¢ç‰©ä»¶æµç¨‹ï¼ˆç”¨æ–¼èª¿è©¦ï¼‰
        async function testSaveProperty() {
            console.log('ğŸ§ª é–‹å§‹æ¸¬è©¦æ–°å¢ç‰©ä»¶æµç¨‹...');
            
            // æª¢æŸ¥å¿…è¦æ¬„ä½
            const requiredFields = {
                title: document.getElementById('title'),
                type: document.getElementById('type'),
                address: document.getElementById('address'),
                price: document.getElementById('price'),
                layout: document.getElementById('layout'),
                total_area: document.getElementById('total_area')
            };
            
            const missingFields = [];
            for (const [key, element] of Object.entries(requiredFields)) {
                if (!element || !element.value.trim()) {
                    missingFields.push(key);
                }
            }
            
            if (missingFields.length > 0) {
                console.error('âŒ ç¼ºå°‘å¿…è¦æ¬„ä½:', missingFields);
                showAlert('error', `è«‹å¡«å¯«å¿…è¦æ¬„ä½: ${missingFields.join(', ')}`);
                return;
            }
            
            // æª¢æŸ¥ Supabase
            if (!supabaseClient) {
                console.error('âŒ Supabase æœªåˆå§‹åŒ–');
                showAlert('error', 'Supabase æœªåˆå§‹åŒ–');
                return;
            }
            
            // æª¢æŸ¥åœ–ç‰‡
            console.log('ğŸ“Š æª¢æŸ¥åœ–ç‰‡:', {
                uploadedImagesCount: uploadedImages.length,
                hasImages: uploadedImages.length > 0
            });
            
            // ç”Ÿæˆæ¸¬è©¦ç·¨è™Ÿ
            const testNumber = `TEST-${Date.now()}`;
            document.getElementById('number').value = testNumber;
            
            console.log('âœ… æ‰€æœ‰æª¢æŸ¥é€šéï¼Œé–‹å§‹å„²å­˜...');
            
            // åŸ·è¡Œå„²å­˜
            await saveProperty();
        }
        
        // å°‡æ¸¬è©¦å‡½æ•¸æš´éœ²åˆ°å…¨åŸŸ
        window.testSaveProperty = testSaveProperty;
        
        // è¼‰å…¥ç‰©ä»¶åˆ—è¡¨
        async function loadProperties() {
            // æª¢æŸ¥ Supabase æ˜¯å¦å·²åˆå§‹åŒ–
            if (!supabaseClient) {
                const listContainer = document.getElementById('property-list');
                listContainer.innerHTML = 
                    '<p style="text-align: center; color: #dc3545; padding: 2rem;">è«‹å…ˆè¨­å®š Supabase é…ç½®<br><button class="btn btn-primary" id="go-to-config-btn" style="margin-top: 1rem;">å‰å¾€è¨­å®š</button></p>';
                // ç‚ºæŒ‰éˆ•æ·»åŠ äº‹ä»¶ç›£è½å™¨
                const configBtn = document.getElementById('go-to-config-btn');
                if (configBtn) {
                    configBtn.addEventListener('click', function() {
                        const configTab = document.querySelector('.tab[onclick*="config"]');
                        if (configTab) {
                            switchTab('config', configTab);
                        }
                    });
                }
                return;
            }
            
            try {
                const { data: properties, error } = await supabaseClient
                    .from('properties')
                    .select('*')
                    .order('created_at', { ascending: false });
                
                if (error) throw error;
                
                const listContainer = document.getElementById('property-list');
                
                if (!properties || properties.length === 0) {
                    listContainer.innerHTML = '<p style="text-align: center; color: #666; padding: 2rem;">ç›®å‰æ²’æœ‰ç‰©ä»¶è³‡æ–™</p>';
                    return;
                }
                
                listContainer.innerHTML = properties.map((prop, index) => {
                    // è™•ç† imagesï¼ˆå¯èƒ½æ˜¯é™£åˆ—æˆ– JSONBï¼‰
                    let images = [];
                    if (prop.images) {
                        if (typeof prop.images === 'string') {
                            try {
                                images = JSON.parse(prop.images);
                            } catch (e) {
                                images = [];
                            }
                        } else if (Array.isArray(prop.images)) {
                            images = prop.images;
                        }
                    }
                    
                    const publishedStatus = prop.is_published ? 'âœ… ä¸Šæ¶' : 'âŒ ä¸‹æ¶';
                    const publishedColor = prop.is_published ? '#28a745' : '#dc3545';
                    
                    // ç‰©ä»¶ä¾†æºæ¨™ç±¤
                    const isExternal = prop.is_external === true || prop.is_external === 'true';
                    const sourceLabel = isExternal 
                        ? '<span style="background: #ff9800; color: white; padding: 2px 8px; border-radius: 12px; font-size: 0.75rem; margin-right: 0.5rem;">ğŸ¢ éæœ¬åº—</span>' 
                        : '<span style="background: #28a745; color: white; padding: 2px 8px; border-radius: 12px; font-size: 0.75rem; margin-right: 0.5rem;">ğŸ  æœ¬åº—</span>';
                    
                    return `
                    <div class="property-item">
                        <div class="property-info">
                            <h4>${sourceLabel}${prop.title || 'æœªå‘½åç‰©ä»¶'}</h4>
                            <p>ç·¨è™Ÿ: ${prop.number || 'N/A'} | æˆ¿å‹: ${prop.type || 'N/A'} | åƒ¹æ ¼: ${prop.price || 'N/A'}</p>
                            <p style="color: ${publishedColor}; font-weight: bold; margin-top: 0.25rem;">${publishedStatus}</p>
                            ${images && images.length > 0 ? `
                                <div style="display: flex; gap: 0.5rem; margin-top: 0.5rem;">
                                    ${images.slice(0, 3).map(img => {
                                        const imgUrl = typeof img === 'string' ? img : (img.url || img);
                                        return `<img src="${imgUrl}" style="width: 60px; height: 45px; object-fit: cover; border-radius: 4px; border: 1px solid #e9ecef;">`;
                                    }).join('')}
                                    ${images.length > 3 ? `<span style="color: #666; font-size: 0.85rem;">+${images.length - 3} å¼µ</span>` : ''}
                                </div>
                            ` : ''}
                        </div>
                        <div class="property-actions">
                            <button class="btn-small btn-primary" onclick="editProperty('${prop.id}')">âœï¸ ç·¨è¼¯</button>
                            <button class="btn-small ${prop.is_published ? 'btn-warning' : 'btn-success'}" onclick="togglePublishStatus('${prop.id}', ${!prop.is_published})">
                                ${prop.is_published ? 'â¬‡ï¸ ä¸‹æ¶' : 'â¬†ï¸ ä¸Šæ¶'}
                            </button>
                            <button class="btn-small btn-danger" onclick="deleteProperty('${prop.id}')">ğŸ—‘ï¸ åˆªé™¤</button>
                        </div>
                    </div>
                `;
                }).join('');
            } catch (error) {
                console.error('è¼‰å…¥éŒ¯èª¤:', error);
                document.getElementById('property-list').innerHTML = 
                    `<p style="text-align: center; color: #dc3545; padding: 2rem;">è¼‰å…¥å¤±æ•—ï¼š${error.message || 'è«‹ç¢ºèª Supabase è¨­å®šæ˜¯å¦æ­£ç¢º'}</p>`;
            }
        }
        
        // åˆ‡æ›ä¸Šæ¶/ä¸‹æ¶ç‹€æ…‹ï¼ˆå„ªåŒ–ç‰ˆï¼šæ¸›å°‘å»¶é²ï¼‰
        async function togglePublishStatus(id, newStatus) {
            if (!supabaseClient) {
                showAlert('error', 'è«‹å…ˆè¨­å®š Supabase é…ç½®');
                return;
            }
            
            try {
                // å…ˆæ›´æ–° UIï¼ˆæ¨‚è§€æ›´æ–°ï¼‰
                const listContainer = document.getElementById('property-list');
                const propertyItems = listContainer.querySelectorAll('.property-item');
                propertyItems.forEach(item => {
                    const editBtn = item.querySelector(`button[onclick*="'${id}'"]`);
                    if (editBtn) {
                        const parentItem = editBtn.closest('.property-item');
                        if (parentItem) {
                            // ç«‹å³æ›´æ–°æŒ‰éˆ•ç‹€æ…‹
                            const toggleBtn = parentItem.querySelector(`button[onclick*="togglePublishStatus('${id}'"]`);
                            if (toggleBtn) {
                                toggleBtn.textContent = newStatus ? 'â¬‡ï¸ ä¸‹æ¶' : 'â¬†ï¸ ä¸Šæ¶';
                                toggleBtn.className = `btn-small ${newStatus ? 'btn-warning' : 'btn-success'}`;
                            }
                            // æ›´æ–°ç‹€æ…‹é¡¯ç¤º
                            const statusP = parentItem.querySelector('p[style*="color"]');
                            if (statusP) {
                                statusP.textContent = newStatus ? 'âœ… ä¸Šæ¶' : 'âŒ ä¸‹æ¶';
                                statusP.style.color = newStatus ? '#28a745' : '#dc3545';
                            }
                        }
                    }
                });
                
                // ç•°æ­¥æ›´æ–°è³‡æ–™åº«
                const { error } = await supabaseClient
                    .from('properties')
                    .update({ is_published: newStatus })
                    .eq('id', id);
                
                if (error) {
                    // å¦‚æœå¤±æ•—ï¼Œé‡æ–°è¼‰å…¥æ¢å¾©åŸç‹€æ…‹
                    loadProperties();
                    throw error;
                }
                
                showAlert('success', newStatus ? 'ç‰©ä»¶å·²ä¸Šæ¶ï¼' : 'ç‰©ä»¶å·²ä¸‹æ¶ï¼');
                // ä¸éœ€è¦é‡æ–°è¼‰å…¥æ•´å€‹åˆ—è¡¨ï¼Œå› ç‚ºå·²ç¶“æ¨‚è§€æ›´æ–°äº†
            } catch (error) {
                console.error('åˆ‡æ›ç‹€æ…‹éŒ¯èª¤:', error);
                showAlert('error', `æ“ä½œå¤±æ•—ï¼š${error.message}`);
                // ç™¼ç”ŸéŒ¯èª¤æ™‚é‡æ–°è¼‰å…¥ä»¥ç¢ºä¿è³‡æ–™ä¸€è‡´
                loadProperties();
            }
        }
        
        // ç·¨è¼¯ç‰©ä»¶
        async function editProperty(id) {
            // æª¢æŸ¥ Supabase æ˜¯å¦å·²åˆå§‹åŒ–
            if (!supabaseClient) {
                showAlert('error', 'è«‹å…ˆè¨­å®š Supabase é…ç½®ï¼Œæ­£åœ¨è·³è½‰åˆ°è¨­å®šé é¢...');
                setTimeout(() => {
                    const configTab = document.querySelector('.tab[onclick*="config"]');
                    if (configTab) {
                        switchTab('config', configTab);
                    }
                }, 1000);
                return;
            }
            
            try {
                const { data: prop, error } = await supabaseClient
                    .from('properties')
                    .select('*')
                    .eq('id', id)
                    .single();
                
                if (error) throw error;
                
                if (!prop) {
                    throw new Error('ç‰©ä»¶ä¸å­˜åœ¨');
                }
                editingPropertyId = id;
                
                // å¡«å…¥è¡¨å–®
                Object.keys(prop).forEach(key => {
                    // è·³éä¸éœ€è¦å¡«å…¥è¡¨å–®çš„æ¬„ä½
                    if (['id', 'created_at', 'updated_at'].includes(key)) {
                        return;
                    }
                    
                    const element = document.getElementById(key);
                    if (element) {
                        if (key === 'is_published') {
                            // è™•ç†ä¸Šæ¶ç‹€æ…‹
                            element.value = prop.is_published ? 'true' : 'false';
                        } else if (key === 'is_external') {
                            // è™•ç†ç‰©ä»¶ä¾†æº
                            element.value = prop.is_external ? 'true' : 'false';
                        } else if (key === 'statusText') {
                            // è™•ç† status_text æ¬„ä½
                            const statusTextElement = document.getElementById('statusText');
                            if (statusTextElement) {
                                statusTextElement.value = prop.status_text || '';
                            }
                        } else if (key === 'city') {
                            // è™•ç†ç¸£å¸‚
                            element.value = prop.city || '';
                            if (prop.city) {
                                updateDistricts();
                                // ç­‰å¾…å€åŸŸé¸é …æ›´æ–°å¾Œå†è¨­å®šå€åŸŸ
                                setTimeout(() => {
                                    const districtElement = document.getElementById('district');
                                    if (districtElement && prop.district) {
                                        districtElement.value = prop.district;
                                    }
                                }, 100);
                            }
                        } else if (key === 'district') {
                            // å€åŸŸæœƒåœ¨ city è¨­å®šå¾Œè‡ªå‹•è™•ç†
                            // é€™è£¡ä¸éœ€è¦å–®ç¨è™•ç†
                        } else if (key === 'address') {
                            // è™•ç†åœ°å€ï¼šå¦‚æœæœ‰ city å’Œ districtï¼Œåªé¡¯ç¤ºè©³ç´°åœ°å€éƒ¨åˆ†
                            if (prop.city && prop.district && prop.address) {
                                // ç§»é™¤ç¸£å¸‚å’Œå€åŸŸéƒ¨åˆ†
                                let detailAddress = prop.address;
                                detailAddress = detailAddress.replace(prop.city, '');
                                detailAddress = detailAddress.replace(prop.district, '');
                                element.value = detailAddress.trim();
                            } else {
                                element.value = prop.address || '';
                            }
                        } else if (key === 'address_detail') {
                            // å¦‚æœæœ‰è©³ç´°åœ°å€ï¼Œä½¿ç”¨å®ƒ
                            if (prop.address_detail) {
                                const addressElement = document.getElementById('address');
                                if (addressElement) {
                                    addressElement.value = prop.address_detail;
                                }
                            }
                        } else if (Array.isArray(prop[key])) {
                            element.value = prop[key].join('\n');
                        } else if (typeof prop[key] === 'object' && prop[key] !== null) {
                            // è™•ç† JSONB æ¬„ä½
                            if (key === 'transportation') {
                                const trans = prop[key];
                                if (trans.facilities) {
                                    loadTagsToSelector('facilities', Array.isArray(trans.facilities) ? trans.facilities : []);
                                }
                                if (trans.transport) {
                                    loadTagsToSelector('transport', Array.isArray(trans.transport) ? trans.transport : []);
                                }
                                if (trans.schools) {
                                    loadTagsToSelector('schools', Array.isArray(trans.schools) ? trans.schools : []);
                                }
                                if (trans.market) {
                                    document.getElementById('market').value = trans.market;
                                }
                                if (trans.park) {
                                    document.getElementById('park').value = trans.park;
                                }
                            }
                        } else {
                            element.value = prop[key] || '';
                        }
                    }
                });
                
                // è¼‰å…¥éš±è—é–€ç‰Œè™Ÿç¢¼é¸é …
                const hideAddressCheckbox = document.getElementById('hide_address_number');
                if (hideAddressCheckbox) {
                    hideAddressCheckbox.checked = prop.hide_address_number || false;
                }
                
                
                // è¼‰å…¥åœ–ç‰‡
                uploadedImages = [];
                let images = [];
                if (prop.images) {
                    if (typeof prop.images === 'string') {
                        try {
                            images = JSON.parse(prop.images);
                        } catch (e) {
                            images = [];
                        }
                    } else if (Array.isArray(prop.images)) {
                        images = prop.images;
                    }
                }
                
                if (images && images.length > 0) {
                    uploadedImages = images.map(img => {
                        const imgUrl = typeof img === 'string' ? img : (img.url || img);
                        return { url: imgUrl, key: typeof img === 'object' ? img.key : null };
                    });
                    
                    const imagePreviewGrid = document.getElementById('image-preview-grid');
                    if (imagePreviewGrid) {
                        imagePreviewGrid.innerHTML = '';
                        uploadedImages.forEach((imgData, index) => {
                        const item = document.createElement('div');
                        item.className = 'image-preview-item';
                        const img = document.createElement('img');
                            img.src = imgData.url || imgData;
                        const removeBtn = document.createElement('button');
                        removeBtn.className = 'image-remove';
                        removeBtn.innerHTML = 'Ã—';
                        removeBtn.onclick = () => removeImage(item, index);
                            item.appendChild(img);
                            item.appendChild(removeBtn);
                            imagePreviewGrid.appendChild(item);
                        });
                    }
                }
                
                // åˆ‡æ›åˆ°æ–°å¢æ¨™ç±¤
                const addTab = document.querySelectorAll('.tab')[1];
                if (addTab) {
                    switchTab('add', addTab);
                }
                
                // æ»¾å‹•åˆ°é ‚éƒ¨
                window.scrollTo({ top: 0, behavior: 'smooth' });
            } catch (error) {
                console.error('ç·¨è¼¯éŒ¯èª¤:', error);
                showAlert('error', `è¼‰å…¥ç‰©ä»¶è³‡æ–™å¤±æ•—ï¼š${error.message}`);
            }
        }
        
        // é¡¯ç¤ºç¢ºèªå½ˆè·³è¦–çª—
        function showConfirmModal(options) {
            return new Promise((resolve) => {
                const {
                    title = 'ç¢ºèªæ“ä½œ',
                    message = 'ç¢ºå®šè¦åŸ·è¡Œæ­¤æ“ä½œå—ï¼Ÿ',
                    icon = 'warning',
                    confirmText = 'ç¢ºå®š',
                    cancelText = 'å–æ¶ˆ',
                    confirmClass = 'modal-btn-danger'
                } = options;
                
                const overlay = document.createElement('div');
                overlay.className = 'modal-overlay';
                
                const iconEmoji = icon === 'danger' ? 'âš ï¸' : 'â“';
                const iconClass = icon === 'danger' ? 'danger' : 'warning';
                
                overlay.innerHTML = `
                    <div class="modal-dialog">
                        <div class="modal-header">
                            <div class="modal-icon ${iconClass}">${iconEmoji}</div>
                            <h3 class="modal-title">${title}</h3>
                            <button class="modal-close" onclick="this.closest('.modal-overlay').remove()">&times;</button>
                        </div>
                        <div class="modal-body">
                            ${message}
                        </div>
                        <div class="modal-footer">
                            <button class="modal-btn modal-btn-cancel" onclick="this.closest('.modal-overlay').remove(); arguments[0].stopPropagation();">${cancelText}</button>
                            <button class="modal-btn ${confirmClass}" onclick="this.closest('.modal-overlay').remove(); arguments[0].stopPropagation();">${confirmText}</button>
                        </div>
                    </div>
                `;
                
                document.body.appendChild(overlay);
                
                // è™•ç†ç¢ºèªæŒ‰éˆ•
                const confirmBtn = overlay.querySelector(`.${confirmClass}`);
                confirmBtn.addEventListener('click', () => {
                    overlay.remove();
                    resolve(true);
                });
                
                // è™•ç†å–æ¶ˆæŒ‰éˆ•
                const cancelBtn = overlay.querySelector('.modal-btn-cancel');
                cancelBtn.addEventListener('click', () => {
                    overlay.remove();
                    resolve(false);
                });
                
                // è™•ç† ESC éµ
                const handleEsc = (e) => {
                    if (e.key === 'Escape') {
                        overlay.remove();
                        document.removeEventListener('keydown', handleEsc);
                        resolve(false);
                    }
                };
                document.addEventListener('keydown', handleEsc);
                
                // é»æ“ŠèƒŒæ™¯é—œé–‰
                overlay.addEventListener('click', (e) => {
                    if (e.target === overlay) {
                        overlay.remove();
                        document.removeEventListener('keydown', handleEsc);
                        resolve(false);
                    }
                });
            });
        }
        
        // åˆªé™¤ç‰©ä»¶
        async function deleteProperty(id) {
            // æª¢æŸ¥ Supabase æ˜¯å¦å·²åˆå§‹åŒ–
            if (!supabaseClient) {
                showAlert('error', 'è«‹å…ˆè¨­å®š Supabase é…ç½®ï¼Œæ­£åœ¨è·³è½‰åˆ°è¨­å®šé é¢...');
                setTimeout(() => {
                    const configTab = document.querySelector('.tab[onclick*="config"]');
                    if (configTab) {
                        switchTab('config', configTab);
                    }
                }, 1000);
                return;
            }
            
            // å…ˆå–å¾—ç‰©ä»¶è³‡è¨Šä»¥é¡¯ç¤ºåœ¨ç¢ºèªè¦–çª—ä¸­
            let propertyInfo = '';
            try {
                const { data: prop } = await supabaseClient
                    .from('properties')
                    .select('title, number')
                    .eq('id', id)
                    .single();
                
                if (prop) {
                    propertyInfo = `<strong>${prop.title || prop.number || 'æ­¤ç‰©ä»¶'}</strong>`;
                }
            } catch (e) {
                // å¿½ç•¥éŒ¯èª¤ï¼Œç¹¼çºŒé¡¯ç¤ºç¢ºèªè¦–çª—
            }
            
            const confirmed = await showConfirmModal({
                title: 'åˆªé™¤ç‰©ä»¶',
                message: `ç¢ºå®šè¦åˆªé™¤ ${propertyInfo || 'æ­¤ç‰©ä»¶'} å—ï¼Ÿ<br><br>æ­¤æ“ä½œç„¡æ³•å¾©åŸï¼Œè«‹è¬¹æ…æ“ä½œã€‚`,
                icon: 'danger',
                confirmText: 'ğŸ—‘ï¸ åˆªé™¤',
                cancelText: 'å–æ¶ˆ'
            });
            
            if (!confirmed) {
                return;
            }
            
            try {
                // å…ˆå–å¾—ç‰©ä»¶è³‡æ–™ï¼ˆç”¨æ–¼åˆªé™¤ç›¸é—œåœ–ç‰‡ï¼‰
                const { data: prop } = await supabaseClient
                    .from('properties')
                    .select('number')
                    .eq('id', id)
                    .single();
                
                // åˆªé™¤è³‡æ–™åº«è¨˜éŒ„
                const { error } = await supabaseClient
                    .from('properties')
                    .delete()
                    .eq('id', id);
                
                if (error) throw error;
                
                // å¯é¸ï¼šåˆªé™¤ç›¸é—œåœ–ç‰‡ï¼ˆå¦‚æœéœ€è¦ï¼‰
                // æ³¨æ„ï¼šé€™è£¡åªæ˜¯ç¤ºç¯„ï¼Œå¯¦éš›ä½¿ç”¨æ™‚å¯ä»¥æ ¹æ“šéœ€è¦æ±ºå®šæ˜¯å¦åˆªé™¤åœ–ç‰‡
                
                showAlert('success', 'ç‰©ä»¶å·²åˆªé™¤ï¼');
                loadProperties();
            } catch (error) {
                console.error('åˆªé™¤éŒ¯èª¤:', error);
                showAlert('error', `åˆªé™¤å¤±æ•—ï¼š${error.message}`);
            }
        }
        
        // é‡è¨­è¡¨å–®
        // æ¨™ç±¤é¸æ“‡ç³»çµ±
        const selectedTags = {
            facilities: [],
            transport: [],
            schools: []
        };
        
        // åˆ‡æ›æ¨™ç±¤é¸æ“‡ç‹€æ…‹
        function toggleTag(type, tagName) {
            // å¦‚æœé»æ“Šçš„æ˜¯ç·¨è¼¯æˆ–åˆªé™¤æŒ‰éˆ•ï¼Œä¸åŸ·è¡Œåˆ‡æ›
            if (event && (event.target.classList.contains('tag-option-edit') || event.target.classList.contains('tag-option-delete'))) {
                return;
            }
            
            const index = selectedTags[type].indexOf(tagName);
            const optionElement = event.target.closest('.tag-option') || event.target;
            
            if (index > -1) {
                // å–æ¶ˆé¸æ“‡
                selectedTags[type].splice(index, 1);
                optionElement.classList.remove('selected');
            } else {
                // é¸æ“‡
                selectedTags[type].push(tagName);
                optionElement.classList.add('selected');
            }
            
            updateSelectedTagsDisplay(type);
        }
        
        // æ·»åŠ è‡ªè¨‚æ¨™ç±¤
        function addCustomTag(type) {
            const input = document.getElementById(`${type}-input`);
            const tagName = input.value.trim();
            
            if (!tagName) {
                showAlert('warning', 'è«‹è¼¸å…¥æ¨™ç±¤åç¨±');
                return;
            }
            
            if (selectedTags[type].includes(tagName)) {
                showAlert('warning', 'æ­¤æ¨™ç±¤å·²ç¶“è¢«é¸ä¸­äº†');
                return;
            }
            
            // æ·»åŠ åˆ°é¸ä¸­åˆ—è¡¨
            selectedTags[type].push(tagName);
            input.value = '';
            updateSelectedTagsDisplay(type);
            
            // å¦‚æœæ¨™ç±¤ä¸åœ¨é¸é …åˆ—è¡¨ä¸­ï¼Œæ·»åŠ åˆ°é¸é …åˆ—è¡¨ï¼ˆæ–¹ä¾¿ä»¥å¾Œä½¿ç”¨ï¼‰
            const optionsContainer = document.getElementById(`${type}-options`);
            if (optionsContainer) {
                const existingOption = Array.from(optionsContainer.children).find(
                    el => {
                        const text = el.querySelector('.tag-option-text') || el;
                        return text.textContent.trim() === tagName;
                    }
                );
                
                if (!existingOption) {
                    // å‰µå»ºæ–°çš„é¸é …å…ƒç´ 
                    const newOption = document.createElement('span');
                    newOption.className = 'tag-option selected';
                    newOption.setAttribute('onclick', `toggleTag('${type}', '${tagName}')`);
                    newOption.innerHTML = `
                        <span class="tag-option-text">${tagName}</span>
                        <button class="tag-option-edit" onclick="editTagOption('${type}', '${tagName}', event)" title="ç·¨è¼¯">âœï¸</button>
                        <button class="tag-option-delete" onclick="deleteTagOption('${type}', '${tagName}', event)" title="åˆªé™¤">Ã—</button>
                    `;
                    optionsContainer.appendChild(newOption);
                } else {
                    // å¦‚æœå·²å­˜åœ¨ï¼Œæ¨™è¨˜ç‚ºé¸ä¸­
                    existingOption.classList.add('selected');
                }
            }
        }
        
        // æ›´æ–°å·²é¸æ“‡æ¨™ç±¤çš„é¡¯ç¤º
        function updateSelectedTagsDisplay(type) {
            const container = document.getElementById(`${type}-selected`);
            if (!container) return;
            
            container.innerHTML = '';
            
            selectedTags[type].forEach(tagName => {
                const tag = document.createElement('span');
                tag.className = 'selected-tag';
                tag.dataset.tagName = tagName;
                tag.innerHTML = `
                    <span class="tag-text">${tagName}</span>
                    <button type="button" class="tag-edit" onclick="editSelectedTag('${type}', '${tagName}', event)" aria-label="ç·¨è¼¯æ¨™ç±¤" title="é›™æ“Šæˆ–é»æ“Šç·¨è¼¯">âœï¸</button>
                    <button type="button" class="tag-remove" onclick="removeTag('${type}', '${tagName}')" aria-label="ç§»é™¤æ¨™ç±¤" title="åˆªé™¤æ¨™ç±¤">Ã—</button>
                `;
                
                // æ·»åŠ é›™æ“Šç·¨è¼¯åŠŸèƒ½
                tag.addEventListener('dblclick', () => {
                    editSelectedTag(type, tagName);
                });
                
                container.appendChild(tag);
                
                // åŒæ­¥æ›´æ–°é¸é …ä¸­çš„é¸ä¸­ç‹€æ…‹
                const optionsContainer = document.getElementById(`${type}-options`);
                if (optionsContainer) {
                    const option = Array.from(optionsContainer.children).find(
                        el => {
                            const text = el.querySelector('.tag-option-text') || el;
                            return text.textContent.trim() === tagName;
                        }
                    );
                    if (option) {
                        option.classList.add('selected');
                    }
                }
            });
        }
        
        // ç·¨è¼¯å·²é¸æ“‡çš„æ¨™ç±¤
        function editSelectedTag(type, oldTagName, event) {
            if (event) {
                event.stopPropagation();
            }
            
            const container = document.getElementById(`${type}-selected`);
            if (!container) return;
            
            const tagElement = container.querySelector(`[data-tag-name="${oldTagName}"]`);
            if (!tagElement) return;
            
            // å¦‚æœæ­£åœ¨ç·¨è¼¯ï¼Œå…ˆä¿å­˜
            if (tagElement.classList.contains('editing')) {
                return;
            }
            
            tagElement.classList.add('editing');
            const tagText = tagElement.querySelector('.tag-text');
            const currentText = tagText.textContent;
            
            // å‰µå»ºç·¨è¼¯è¼¸å…¥æ¡†
            const input = document.createElement('input');
            input.type = 'text';
            input.className = 'tag-edit-input';
            input.value = currentText;
            input.style.width = Math.max(currentText.length * 10, 80) + 'px';
            
            // æ›¿æ›æ–‡å­—ç‚ºè¼¸å…¥æ¡†
            tagText.style.display = 'none';
            tagElement.insertBefore(input, tagText);
            
            // èšç„¦ä¸¦é¸ä¸­æ–‡å­—
            input.focus();
            input.select();
            
            // ä¿å­˜ç·¨è¼¯
            const saveEdit = () => {
                const newTagName = input.value.trim();
                if (newTagName && newTagName !== oldTagName) {
                    // æ›´æ–°æ¨™ç±¤åç¨±
                    const index = selectedTags[type].indexOf(oldTagName);
                    if (index > -1) {
                        selectedTags[type][index] = newTagName;
                        
                        // æ›´æ–°é¸é …åˆ—è¡¨ä¸­çš„æ¨™ç±¤ï¼ˆå¦‚æœå­˜åœ¨ï¼‰
                        updateTagOption(type, oldTagName, newTagName);
                        
                        // é‡æ–°é¡¯ç¤ºæ¨™ç±¤
                        updateSelectedTagsDisplay(type);
                    }
                } else if (newTagName === '') {
                    // å¦‚æœç‚ºç©ºï¼Œåˆªé™¤æ¨™ç±¤
                    removeTag(type, oldTagName);
                } else {
                    // å–æ¶ˆç·¨è¼¯
                    tagElement.classList.remove('editing');
                    input.remove();
                    tagText.style.display = '';
                }
            };
            
            // æŒ‰ Enter ä¿å­˜
            input.addEventListener('keydown', (e) => {
                if (e.key === 'Enter') {
                    e.preventDefault();
                    saveEdit();
                } else if (e.key === 'Escape') {
                    e.preventDefault();
                    tagElement.classList.remove('editing');
                    input.remove();
                    tagText.style.display = '';
                }
            });
            
            // å¤±å»ç„¦é»æ™‚ä¿å­˜
            input.addEventListener('blur', () => {
                setTimeout(() => {
                    if (tagElement.classList.contains('editing')) {
                        saveEdit();
                    }
                }, 200);
            });
        }
        
        // æ›´æ–°é¸é …åˆ—è¡¨ä¸­çš„æ¨™ç±¤åç¨±
        function updateTagOption(type, oldName, newName) {
            const optionsContainer = document.getElementById(`${type}-options`);
            if (!optionsContainer) return;
            
            const option = Array.from(optionsContainer.children).find(
                el => {
                    const text = el.querySelector('.tag-option-text') || el;
                    return text.textContent.trim() === oldName;
                }
            );
            
            if (option) {
                const textElement = option.querySelector('.tag-option-text') || option;
                textElement.textContent = newName;
                
                // æ›´æ–° onclick äº‹ä»¶
                option.setAttribute('onclick', `toggleTag('${type}', '${newName}')`);
                
                // å¦‚æœæ¨™ç±¤è¢«é¸ä¸­ï¼Œæ›´æ–°é¸ä¸­ç‹€æ…‹
                if (option.classList.contains('selected')) {
                    const index = selectedTags[type].indexOf(newName);
                    if (index === -1) {
                        option.classList.remove('selected');
                    }
                }
            }
        }
        
        // ç§»é™¤æ¨™ç±¤
        function removeTag(type, tagName) {
            const index = selectedTags[type].indexOf(tagName);
            if (index > -1) {
                selectedTags[type].splice(index, 1);
                updateSelectedTagsDisplay(type);
                
                // å–æ¶ˆé¸é …ä¸­çš„é¸ä¸­ç‹€æ…‹
                const optionsContainer = document.getElementById(`${type}-options`);
                if (optionsContainer) {
                    const option = Array.from(optionsContainer.children).find(
                        el => {
                            const text = el.querySelector('.tag-option-text') || el;
                            return text.textContent.trim() === tagName;
                        }
                    );
                    if (option) {
                        option.classList.remove('selected');
                    }
                }
            }
        }
        
        // ç·¨è¼¯æ¨™ç±¤é¸é …ï¼ˆåœ¨é¸é …åˆ—è¡¨ä¸­ï¼‰
        function editTagOption(type, oldName, event) {
            if (event) {
                event.stopPropagation();
            }
            
            const optionsContainer = document.getElementById(`${type}-options`);
            if (!optionsContainer) return;
            
            const option = Array.from(optionsContainer.children).find(
                el => {
                    const text = el.querySelector('.tag-option-text') || el;
                    return text.textContent.trim() === oldName;
                }
            );
            
            if (!option) return;
            
            // å¦‚æœæ­£åœ¨ç·¨è¼¯ï¼Œå…ˆä¿å­˜
            if (option.classList.contains('editing')) {
                return;
            }
            
            option.classList.add('editing');
            const textElement = option.querySelector('.tag-option-text') || option;
            const currentText = textElement.textContent.trim();
            
            // å‰µå»ºç·¨è¼¯è¼¸å…¥æ¡†
            const input = document.createElement('input');
            input.type = 'text';
            input.className = 'tag-edit-input';
            input.value = currentText;
            input.style.width = Math.max(currentText.length * 10, 80) + 'px';
            
            // æ›¿æ›æ–‡å­—ç‚ºè¼¸å…¥æ¡†
            const originalDisplay = textElement.style.display;
            textElement.style.display = 'none';
            option.insertBefore(input, textElement);
            
            // èšç„¦ä¸¦é¸ä¸­æ–‡å­—
            input.focus();
            input.select();
            
            // ä¿å­˜ç·¨è¼¯
            const saveEdit = () => {
                const newName = input.value.trim();
                if (newName && newName !== oldName) {
                    // æ›´æ–°é¸é …æ–‡å­—
                    textElement.textContent = newName;
                    textElement.style.display = originalDisplay;
                    
                    // æ›´æ–° onclick äº‹ä»¶
                    option.setAttribute('onclick', `toggleTag('${type}', '${newName}')`);
                    
                    // å¦‚æœæ¨™ç±¤è¢«é¸ä¸­ï¼Œæ›´æ–°é¸ä¸­çš„æ¨™ç±¤åç¨±
                    if (selectedTags[type].includes(oldName)) {
                        const index = selectedTags[type].indexOf(oldName);
                        selectedTags[type][index] = newName;
                        updateSelectedTagsDisplay(type);
                    }
                } else if (newName === '') {
                    // å¦‚æœç‚ºç©ºï¼Œåˆªé™¤é¸é …
                    deleteTagOption(type, oldName);
                    return;
                } else {
                    // å–æ¶ˆç·¨è¼¯
                    textElement.style.display = originalDisplay;
                }
                
                option.classList.remove('editing');
                input.remove();
            };
            
            // æŒ‰ Enter ä¿å­˜
            input.addEventListener('keydown', (e) => {
                if (e.key === 'Enter') {
                    e.preventDefault();
                    saveEdit();
                } else if (e.key === 'Escape') {
                    e.preventDefault();
                    option.classList.remove('editing');
                    textElement.style.display = originalDisplay;
                    input.remove();
                }
            });
            
            // å¤±å»ç„¦é»æ™‚ä¿å­˜
            input.addEventListener('blur', () => {
                setTimeout(() => {
                    if (option.classList.contains('editing')) {
                        saveEdit();
                    }
                }, 200);
            });
        }
        
        // åˆªé™¤æ¨™ç±¤é¸é …ï¼ˆå¾é¸é …åˆ—è¡¨ä¸­ï¼‰
        function deleteTagOption(type, tagName, event) {
            if (event) {
                event.stopPropagation();
            }
            
            // ç¢ºèªåˆªé™¤
            if (!confirm(`ç¢ºå®šè¦åˆªé™¤æ¨™ç±¤é¸é …ã€Œ${tagName}ã€å—ï¼Ÿ\n\nå¦‚æœæ­¤æ¨™ç±¤å·²è¢«é¸ä¸­ï¼Œä¹Ÿæœƒä¸€ä½µç§»é™¤ã€‚`)) {
                return;
            }
            
            const optionsContainer = document.getElementById(`${type}-options`);
            if (!optionsContainer) return;
            
            const option = Array.from(optionsContainer.children).find(
                el => {
                    const text = el.querySelector('.tag-option-text') || el;
                    return text.textContent.trim() === tagName;
                }
            );
            
            if (option) {
                // å¦‚æœæ¨™ç±¤è¢«é¸ä¸­ï¼Œå…ˆç§»é™¤
                if (selectedTags[type].includes(tagName)) {
                    removeTag(type, tagName);
                }
                
                // åˆªé™¤é¸é …å…ƒç´ 
                option.remove();
            }
        }
        
        // è¼‰å…¥æ¨™ç±¤åˆ°é¸æ“‡å™¨
        function loadTagsToSelector(type, tags) {
            if (!Array.isArray(tags)) return;
            
            selectedTags[type] = [...tags];
            updateSelectedTagsDisplay(type);
        }
        
        // æ¸…é™¤æ‰€æœ‰æ¨™ç±¤
        function clearAllTags(type) {
            selectedTags[type] = [];
            updateSelectedTagsDisplay(type);
            
            // æ¸…é™¤é¸é …ä¸­çš„é¸ä¸­ç‹€æ…‹
            const optionsContainer = document.getElementById(`${type}-options`);
            if (optionsContainer) {
                optionsContainer.querySelectorAll('.tag-option.selected').forEach(opt => {
                    opt.classList.remove('selected');
                });
            }
        }
        
        // ç²å–æ‰€æœ‰ç¾æœ‰çš„ç‰©ä»¶ç·¨è™Ÿï¼ˆç”¨æ–¼æª¢æŸ¥é‡è¤‡ï¼‰
        async function getAllPropertyNumbers() {
            if (!supabaseClient) {
                return [];
            }
            
            try {
                const { data, error } = await supabaseClient
                    .from('properties')
                    .select('id, number');
                
                if (error) throw error;
                
                return (data || [])
                    .filter(item => item.number)
                    .map(item => item.number);
            } catch (error) {
                console.error('âŒ ç²å–ç‰©ä»¶ç·¨è™Ÿå¤±æ•—:', error);
                return [];
            }
        }
        
        // æ ¹æ“šé¡åˆ¥ç²å–ç·¨è™Ÿå‰ç¶´ï¼ˆæ–°æ ¼å¼ï¼š2å­—æ¯ï¼‰
        function getTypePrefix(type) {
            const typeMap = {
                'å¥—æˆ¿': 'SU',
                '2æˆ¿': 'TW',
                '3æˆ¿': 'TH',
                '4æˆ¿': 'FO',
                'è¯å»ˆ': 'HS',
                'å…¬å¯“': 'AP',
                'é€å¤©': 'TT',
                'åº—é¢': 'ST',
                'åˆ¥å¢…': 'VH'
            };
            return typeMap[type] || 'XX';
        }
        
        // æ¡ƒåœ’å¸‚å€åŸŸåˆ—è¡¨
        const taoyuanDistricts = [
            'æ¡ƒåœ’å€', 'ä¸­å£¢å€', 'å¤§æºªå€', 'æ¥Šæ¢…å€', 'è˜†ç«¹å€', 'å¤§åœ’å€', 
            'é¾œå±±å€', 'å…«å¾·å€', 'é¾æ½­å€', 'å¹³é®å€', 'æ–°å±‹å€', 'è§€éŸ³å€',
            'å¾©èˆˆå€'
        ];
        
        // å„ç¸£å¸‚å€åŸŸå°æ‡‰è¡¨
        const cityDistricts = {
            'æ¡ƒåœ’å¸‚': taoyuanDistricts,
            'å°åŒ—å¸‚': ['ä¸­æ­£å€', 'å¤§åŒå€', 'ä¸­å±±å€', 'æ¾å±±å€', 'å¤§å®‰å€', 'è¬è¯å€', 'ä¿¡ç¾©å€', 'å£«æ—å€', 'åŒ—æŠ•å€', 'å…§æ¹–å€', 'å—æ¸¯å€', 'æ–‡å±±å€'],
            'æ–°åŒ—å¸‚': ['æ¿æ©‹å€', 'ä¸‰é‡å€', 'ä¸­å’Œå€', 'æ°¸å’Œå€', 'æ–°èŠå€', 'æ–°åº—å€', 'æ¨¹æ—å€', 'é¶¯æ­Œå€', 'ä¸‰å³½å€', 'æ·¡æ°´å€', 'æ±æ­¢å€', 'ç‘èŠ³å€', 'åœŸåŸå€', 'è˜†æ´²å€', 'äº”è‚¡å€', 'æ³°å±±å€', 'æ—å£å€', 'æ·±å‘å€', 'çŸ³ç¢‡å€', 'åªæ—å€', 'ä¸‰èŠå€', 'çŸ³é–€å€', 'å…«é‡Œå€', 'å¹³æºªå€', 'é›™æºªå€', 'è²¢å¯®å€', 'é‡‘å±±å€', 'è¬é‡Œå€', 'çƒä¾†å€'],
            'å°ä¸­å¸‚': ['ä¸­å€', 'æ±å€', 'å—å€', 'è¥¿å€', 'åŒ—å€', 'è¥¿å±¯å€', 'å—å±¯å€', 'åŒ—å±¯å€', 'è±åŸå€', 'æ±å‹¢å€', 'å¤§ç”²å€', 'æ¸…æ°´å€', 'æ²™é¹¿å€', 'æ¢§æ£²å€', 'åé‡Œå€', 'ç¥å²¡å€', 'æ½­å­å€', 'å¤§é›…å€', 'æ–°ç¤¾å€', 'çŸ³å²¡å€', 'å¤–åŸ”å€', 'å¤§å®‰å€', 'çƒæ—¥å€', 'å¤§è‚šå€', 'é¾äº•å€', 'éœ§å³°å€', 'å¤ªå¹³å€', 'å¤§é‡Œå€', 'å’Œå¹³å€'],
            'å°å—å¸‚': ['ä¸­è¥¿å€', 'æ±å€', 'å—å€', 'åŒ—å€', 'å®‰å¹³å€', 'å®‰å—å€', 'æ°¸åº·å€', 'æ­¸ä»å€', 'æ–°åŒ–å€', 'å·¦é®å€', 'ç‰äº•å€', 'æ¥ è¥¿å€', 'å—åŒ–å€', 'ä»å¾·å€', 'é—œå»Ÿå€', 'é¾å´å€', 'å®˜ç”°å€', 'éº»è±†å€', 'ä½³é‡Œå€', 'è¥¿æ¸¯å€', 'ä¸ƒè‚¡å€', 'å°‡è»å€', 'å­¸ç”²å€', 'åŒ—é–€å€', 'æ–°ç‡Ÿå€', 'å¾Œå£å€', 'ç™½æ²³å€', 'æ±å±±å€', 'å…­ç”²å€', 'ä¸‹ç‡Ÿå€', 'æŸ³ç‡Ÿå€', 'é¹½æ°´å€', 'å–„åŒ–å€', 'å¤§å…§å€', 'å±±ä¸Šå€', 'æ–°å¸‚å€', 'å®‰å®šå€'],
            'é«˜é›„å¸‚': ['æ–°èˆˆå€', 'å‰é‡‘å€', 'è‹“é›…å€', 'é¹½åŸ•å€', 'é¼“å±±å€', 'æ——æ´¥å€', 'å‰é®å€', 'ä¸‰æ°‘å€', 'å·¦ç‡Ÿå€', 'æ¥ æ¢“å€', 'å°æ¸¯å€', 'é³³å±±å€', 'æ—åœ’å€', 'å¤§å¯®å€', 'å¤§æ¨¹å€', 'å¤§ç¤¾å€', 'ä»æ­¦å€', 'é³¥æ¾å€', 'å²¡å±±å€', 'æ©‹é ­å€', 'ç‡•å·¢å€', 'ç”°å¯®å€', 'é˜¿è“®å€', 'è·¯ç«¹å€', 'æ¹–å…§å€', 'èŒ„è£å€', 'æ°¸å®‰å€', 'å½Œé™€å€', 'æ¢“å®˜å€', 'æ——å±±å€', 'ç¾æ¿ƒå€', 'å…­é¾œå€', 'ç”²ä»™å€', 'æ‰æ—å€', 'å…§é–€å€', 'èŒ‚æ—å€', 'æ¡ƒæºå€', 'é‚£ç‘ªå¤å€']
        };
        
        // æ›´æ–°å€åŸŸé¸é …
        function updateDistricts() {
            const citySelect = document.getElementById('city');
            const districtSelect = document.getElementById('district');
            const selectedCity = citySelect.value;
            
            // æ¸…ç©ºå€åŸŸé¸é …
            districtSelect.innerHTML = '<option value="">è«‹é¸æ“‡å€åŸŸ</option>';
            
            if (selectedCity && cityDistricts[selectedCity]) {
                cityDistricts[selectedCity].forEach(district => {
                    const option = document.createElement('option');
                    option.value = district;
                    option.textContent = district;
                    districtSelect.appendChild(option);
                });
            }
        }
        
        // ç”Ÿæˆä¸‹ä¸€å€‹åºè™Ÿï¼ˆåº—å…§ç‰©ä»¶ï¼š7ä½æ•¸æ ¼å¼ SU00001ï¼‰
        function getNextInternalSequenceNumber(existingNumbers, prefix) {
            // æ‰¾å‡ºæ‰€æœ‰å±¬æ–¼è©²é¡åˆ¥çš„åº—å…§ç‰©ä»¶ç·¨è™Ÿï¼ˆæ ¼å¼ï¼šSU00001, TW00001ï¼‰
            // åŒæ™‚éæ¿¾æ‰èˆŠæ ¼å¼çš„ç·¨è™Ÿï¼ˆå¦‚ï¼š2-1, 3-6ç­‰ï¼‰å’Œå…¶ä»–ä¸ç¬¦åˆæ¨™æº–æ ¼å¼çš„ç·¨è™Ÿ
            const typeNumbers = existingNumbers
                .filter(num => {
                    // åªè™•ç†ç¬¦åˆæ–°æ ¼å¼çš„ç·¨è™Ÿï¼š{2å­—æ¯å‰ç¶´}{5ä½æ•¸å­—}
                    // æ’é™¤ä»¥ EX é–‹é ­çš„ï¼ˆåº—å¤–ç‰©ä»¶ï¼‰
                    // æ’é™¤åŒ…å«é€£å­—è™Ÿçš„èˆŠæ ¼å¼ï¼ˆå¦‚ï¼š2-1, 3-6ï¼‰
                    // æ’é™¤å…¶ä»–ä¸ç¬¦åˆæ¨™æº–æ ¼å¼çš„ç·¨è™Ÿ
                    if (!num || typeof num !== 'string') return false;
                    if (num.startsWith('EX')) return false;
                    if (num.includes('-')) return false; // æ’é™¤èˆŠæ ¼å¼
                    // æª¢æŸ¥æ˜¯å¦ç¬¦åˆæ¨™æº–æ ¼å¼ï¼š2å­—æ¯ + 5ä½æ•¸å­—
                    const standardFormat = new RegExp(`^${prefix}\\d{5}$`);
                    return standardFormat.test(num);
                })
                .map(num => {
                    // æå–åºè™Ÿéƒ¨åˆ†ï¼ˆä¾‹å¦‚ï¼šSU00001 -> 1ï¼‰
                    const match = num.match(new RegExp(`^${prefix}(\\d+)$`));
                    return match ? parseInt(match[1], 10) : 0;
                })
                .filter(num => !isNaN(num) && num > 0)
                .sort((a, b) => b - a); // é™åºæ’åˆ—
            
            // å¦‚æœæ²’æœ‰è©²é¡åˆ¥çš„ç·¨è™Ÿï¼Œå¾ 1 é–‹å§‹
            if (typeNumbers.length === 0) {
                return 1;
            }
            
            // è¿”å›æœ€å¤§åºè™Ÿ + 1
            return typeNumbers[0] + 1;
        }
        
        // ç”Ÿæˆä¸‹ä¸€å€‹åºè™Ÿï¼ˆåº—å¤–ç‰©ä»¶ï¼š8ä½æ•¸æ ¼å¼ EXSU0001ï¼‰
        function getNextExternalSequenceNumber(existingNumbers, prefix) {
            // æ‰¾å‡ºæ‰€æœ‰å±¬æ–¼è©²é¡åˆ¥çš„åº—å¤–ç‰©ä»¶ç·¨è™Ÿï¼ˆæ ¼å¼ï¼šEXSU0001, EXTW0001ï¼‰
            const externalPrefix = `EX${prefix}`;
            const typeNumbers = existingNumbers
                .filter(num => {
                    // åªè™•ç†ç¬¦åˆæ¨™æº–æ ¼å¼çš„ç·¨è™Ÿï¼šEX{2å­—æ¯å‰ç¶´}{4ä½æ•¸å­—}
                    // æ’é™¤åŒ…å«é€£å­—è™Ÿçš„èˆŠæ ¼å¼
                    if (!num || typeof num !== 'string') return false;
                    if (!num.startsWith(externalPrefix)) return false;
                    if (num.includes('-')) return false; // æ’é™¤èˆŠæ ¼å¼
                    // æª¢æŸ¥æ˜¯å¦ç¬¦åˆæ¨™æº–æ ¼å¼ï¼šEX + 2å­—æ¯ + 4ä½æ•¸å­—
                    const standardFormat = new RegExp(`^EX${prefix}\\d{4}$`);
                    return standardFormat.test(num);
                })
                .map(num => {
                    // æå–åºè™Ÿéƒ¨åˆ†ï¼ˆä¾‹å¦‚ï¼šEXSU0001 -> 1ï¼‰
                    const match = num.match(new RegExp(`^EX${prefix}(\\d+)$`));
                    return match ? parseInt(match[1], 10) : 0;
                })
                .filter(num => !isNaN(num) && num > 0)
                .sort((a, b) => b - a); // é™åºæ’åˆ—
            
            // å¦‚æœæ²’æœ‰è©²é¡åˆ¥çš„ç·¨è™Ÿï¼Œå¾ 1 é–‹å§‹
            if (typeNumbers.length === 0) {
                return 1;
            }
            
            // è¿”å›æœ€å¤§åºè™Ÿ + 1
            return typeNumbers[0] + 1;
        }
        
        // æ ¼å¼åŒ–åºè™Ÿï¼ˆåº—å…§ï¼š5ä½æ•¸ï¼Œåº—å¤–ï¼š4ä½æ•¸ï¼‰
        function formatSequenceNumber(seq, digits) {
            return String(seq).padStart(digits, '0');
        }
        
        // ç”Ÿæˆç‰©ä»¶ç·¨è™Ÿï¼ˆæ”¯æ´åº—å…§/åº—å¤–ç‰©ä»¶ï¼‰
        async function generatePropertyNumber() {
            const typeSelect = document.getElementById('type');
            const numberInput = document.getElementById('number');
            const isExternalSelect = document.getElementById('is_external');
            
            if (!typeSelect || !numberInput) {
                showAlert('error', 'æ‰¾ä¸åˆ°æˆ¿å‹æˆ–ç·¨è™Ÿæ¬„ä½');
                return;
            }
            
            const type = typeSelect.value.trim();
            if (!type) {
                showAlert('warning', 'è«‹å…ˆé¸æ“‡æˆ¿å‹');
                return;
            }
            
            const isExternal = isExternalSelect ? isExternalSelect.value === 'true' : false;
            
            try {
                // ç²å–æ‰€æœ‰ç¾æœ‰ç·¨è™Ÿ
                const existingNumbers = await getAllPropertyNumbers();
                
                // å¦‚æœæ­£åœ¨ç·¨è¼¯ï¼Œæ’é™¤ç•¶å‰ç‰©ä»¶çš„ç·¨è™Ÿ
                if (editingPropertyId) {
                    try {
                        const { data: currentData, error } = await supabaseClient
                            .from('properties')
                            .select('number')
                            .eq('id', editingPropertyId)
                            .single();
                        
                        if (!error && currentData && currentData.number) {
                            const index = existingNumbers.indexOf(currentData.number);
                            if (index > -1) {
                                existingNumbers.splice(index, 1);
                            }
                        }
                    } catch (error) {
                        console.warn('âš ï¸ ç„¡æ³•ç²å–ç•¶å‰ç‰©ä»¶ç·¨è™Ÿ:', error);
                    }
                }
                
                // ç”Ÿæˆæ–°ç·¨è™Ÿ
                const prefix = getTypePrefix(type);
                let newNumber;
                
                if (isExternal) {
                    // åº—å¤–ç‰©ä»¶ï¼šEXSU0001ï¼ˆ8ä½æ•¸ï¼‰
                    const nextSeq = getNextExternalSequenceNumber(existingNumbers, prefix);
                    const formattedSeq = formatSequenceNumber(nextSeq, 4);
                    newNumber = `EX${prefix}${formattedSeq}`;
                } else {
                    // åº—å…§ç‰©ä»¶ï¼šSU00001ï¼ˆ7ä½æ•¸ï¼‰
                    const nextSeq = getNextInternalSequenceNumber(existingNumbers, prefix);
                    const formattedSeq = formatSequenceNumber(nextSeq, 5);
                    newNumber = `${prefix}${formattedSeq}`;
                }
                
                // æª¢æŸ¥æ˜¯å¦ä»ç„¶é‡è¤‡ï¼ˆä»¥é˜²è¬ä¸€ï¼‰
                if (existingNumbers.includes(newNumber)) {
                    // å¦‚æœé‡è¤‡ï¼Œå˜—è©¦ä¸‹ä¸€å€‹åºè™Ÿ
                    let seq = isExternal 
                        ? getNextExternalSequenceNumber(existingNumbers, prefix) + 1
                        : getNextInternalSequenceNumber(existingNumbers, prefix) + 1;
                    let candidate;
                    const maxSeq = isExternal ? 9999 : 99999;
                    
                    while (seq < maxSeq) {
                        if (isExternal) {
                            candidate = `EX${prefix}${formatSequenceNumber(seq, 4)}`;
                        } else {
                            candidate = `${prefix}${formatSequenceNumber(seq, 5)}`;
                        }
                        
                        if (!existingNumbers.includes(candidate)) {
                            newNumber = candidate;
                            break;
                        }
                        seq++;
                    }
                }
                
                numberInput.value = newNumber;
                showAlert('success', `å·²ç”Ÿæˆç‰©ä»¶ç·¨è™Ÿ: ${newNumber}`);
            } catch (error) {
                console.error('âŒ ç”Ÿæˆç·¨è™Ÿå¤±æ•—:', error);
                showAlert('error', 'ç”Ÿæˆç·¨è™Ÿå¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦');
            }
        }
        
        // ç•¶ç‰©ä»¶ä¾†æºæ”¹è®Šæ™‚çš„è™•ç†
        function onExternalSourceChange() {
            const isExternalSelect = document.getElementById('is_external');
            const typeSelect = document.getElementById('type');
            const numberInput = document.getElementById('number');
            
            if (!isExternalSelect || !typeSelect || !numberInput) {
                return;
            }
            
            const isExternal = isExternalSelect.value === 'true';
            const type = typeSelect.value.trim();
            
            // å¦‚æœå·²é¸æ“‡æˆ¿å‹ä¸”ä¸åœ¨ç·¨è¼¯æ¨¡å¼ï¼Œé‡æ–°ç”Ÿæˆç·¨è™Ÿ
            if (type && !editingPropertyId) {
                numberInput.value = '';
                generatePropertyNumber();
            } else if (type && editingPropertyId) {
                // ç·¨è¼¯æ¨¡å¼ï¼šæª¢æŸ¥ç¾æœ‰ç·¨è™Ÿæ˜¯å¦ç¬¦åˆç•¶å‰ä¾†æºé¡å‹
                const currentNumber = numberInput.value.trim();
                if (currentNumber) {
                    const isCurrentExternal = currentNumber.startsWith('EX');
                    if (isCurrentExternal !== isExternal) {
                        // ä¾†æºé¡å‹æ”¹è®Šï¼Œé‡æ–°ç”Ÿæˆç·¨è™Ÿ
                        numberInput.value = '';
                        generatePropertyNumber();
                    }
                }
            }
        }
        
        // ç•¶æˆ¿å‹æ”¹è®Šæ™‚çš„è™•ç†
        function onTypeChange() {
            const typeSelect = document.getElementById('type');
            const numberInput = document.getElementById('number');
            const isExternalSelect = document.getElementById('is_external');
            
            if (!typeSelect || !numberInput) {
                return;
            }
            
            const type = typeSelect.value.trim();
            const isExternal = isExternalSelect ? isExternalSelect.value === 'true' : false;
            
            // å¦‚æœä¸åœ¨ç·¨è¼¯æ¨¡å¼ï¼Œä¸”å·²é¸æ“‡æˆ¿å‹ï¼Œè‡ªå‹•ç”Ÿæˆç·¨è™Ÿ
            if (type && !editingPropertyId) {
                // æ¸…é™¤ç¾æœ‰ç·¨è™Ÿï¼Œå¼·åˆ¶é‡æ–°ç”Ÿæˆ
                numberInput.value = '';
                generatePropertyNumber();
            } else if (type && editingPropertyId) {
                // ç·¨è¼¯æ¨¡å¼ï¼šæª¢æŸ¥ç¾æœ‰ç·¨è™Ÿæ˜¯å¦ç¬¦åˆç•¶å‰æˆ¿å‹å’Œä¾†æºé¡å‹
                const currentNumber = numberInput.value.trim();
                if (currentNumber) {
                    const prefix = getTypePrefix(type);
                    const isCurrentExternal = currentNumber.startsWith('EX');
                    const currentPrefix = isCurrentExternal 
                        ? currentNumber.substring(2, 4)  // EXSU0001 -> SU
                        : currentNumber.substring(0, 2);  // SU00001 -> SU
                    
                    // å¦‚æœæˆ¿å‹æ”¹è®Šæˆ–ä¾†æºé¡å‹æ”¹è®Šï¼Œé‡æ–°ç”Ÿæˆç·¨è™Ÿ
                    if (currentPrefix !== prefix || isCurrentExternal !== isExternal) {
                        numberInput.value = '';
                        generatePropertyNumber();
                    }
                }
            }
        }
        
        // Google è¡—æ™¯ç›¸é—œå‡½æ•¸
        // æ‰“é–‹ Google è¡—æ™¯ï¼ˆæ–¹æ³•ä¸€ï¼šæœ€ç°¡å–®çš„æ–¹å¼ï¼‰
        function openGoogleStreetView() {
            const addressInput = document.getElementById('address');
            if (!addressInput) {
                showAlert('error', 'æ‰¾ä¸åˆ°åœ°å€è¼¸å…¥æ¡†');
                return;
            }
            
            const address = addressInput.value.trim();
            if (!address) {
                showAlert('warning', 'è«‹å…ˆè¼¸å…¥åœ°å€');
                addressInput.focus();
                return;
            }
            
            // ç·¨ç¢¼åœ°å€
            const encodedAddress = encodeURIComponent(address);
            // æ‰“é–‹ Google è¡—æ™¯é é¢ï¼ˆä½¿ç”¨è¡—æ™¯æ¨¡å¼ï¼‰
            // å…ˆæœå°‹åœ°å€ï¼Œç„¶å¾Œåœ¨ Google Maps ä¸­å¯ä»¥ç›´æ¥åˆ‡æ›åˆ°è¡—æ™¯æ¨¡å¼
            const streetViewUrl = `https://www.google.com/maps/search/?api=1&query=${encodedAddress}`;
            window.open(streetViewUrl, '_blank');
            
            // é¡¯ç¤ºè©³ç´°çš„æ“ä½œèªªæ˜
            const alertContainer = document.getElementById('alert-container');
            if (alertContainer) {
                const alert = document.createElement('div');
                alert.className = 'alert alert-info show';
                alert.innerHTML = `
                    <strong>âœ… å·²åœ¨æ–°è¦–çª—æ‰“é–‹ Google Maps</strong><br>
                    è«‹æŒ‰ç…§ä»¥ä¸‹æ­¥é©Ÿæ“ä½œï¼š<br>
                    1. åœ¨é–‹å•Ÿçš„åœ°åœ–é é¢ä¸­ï¼Œæ‹–å‹•å³ä¸‹è§’çš„ã€Œå°é»ƒäººã€åˆ°åœ°åœ–ä¸Šçš„ä½ç½®<br>
                    2. é€²å…¥è¡—æ™¯å¾Œï¼Œé»æ“Šå·¦ä¸Šè§’çš„ã€Œé¸å–®ã€â†’ã€Œåˆ†äº«æˆ–åµŒå…¥åœ°åœ–ã€â†’ã€ŒåµŒå…¥åœ°åœ–ã€<br>
                    3. è¤‡è£½åµŒå…¥ç¶²å€ä¸¦è²¼åˆ°ã€ŒGoogle è¡—æ™¯ç¶²å€ã€æ¬„ä½
                `;
                alertContainer.innerHTML = '';
                alertContainer.appendChild(alert);
                
                setTimeout(() => {
                    alert.classList.remove('show');
                    setTimeout(() => alert.remove(), 5000);
                }, 8000);
            }
        }
        
        function resetForm() {
            document.getElementById('property-form').reset();
            uploadedImages = [];
            const imagePreviewGrid = document.getElementById('image-preview-grid');
            if (imagePreviewGrid) {
                imagePreviewGrid.innerHTML = '';
            }
            editingPropertyId = null;
            
            // æ¸…é™¤ç‰©ä»¶ç·¨è™Ÿ
            const numberInput = document.getElementById('number');
            if (numberInput) {
                numberInput.value = '';
            }
            
            // æ¸…é™¤æ‰€æœ‰æ¨™ç±¤
            clearAllTags('facilities');
            clearAllTags('transport');
            clearAllTags('schools');
            
            // æ¸…é™¤éš±è—é–€ç‰Œè™Ÿç¢¼çš„å‹¾é¸
            const hideAddressCheckbox = document.getElementById('hide_address_number');
            if (hideAddressCheckbox) {
                hideAddressCheckbox.checked = false;
            }
            
        }
        
        // é¡¯ç¤ºæç¤ºè¨Šæ¯
        function showAlert(type, message) {
            const alertContainer = document.getElementById('alert-container');
            const alert = document.createElement('div');
            alert.className = `alert alert-${type} show`;
            alert.textContent = message;
            alertContainer.innerHTML = '';
            alertContainer.appendChild(alert);
            
            setTimeout(() => {
                alert.classList.remove('show');
                setTimeout(() => alert.remove(), 300);
            }, 3000);
        }
        
        // é é¢è¼‰å…¥æ™‚
        document.addEventListener('DOMContentLoaded', function() {
            // å…ˆå¾ localStorage è‡ªå‹•è¼‰å…¥è¨­å®šä¸¦åˆå§‹åŒ– Supabaseï¼ˆä¸éœ€è¦æ‰“é–‹è¨­å®šé é¢ï¼‰
            const savedAnonKey = localStorage.getItem('supabase-anon-key');
            if (savedAnonKey) {
                console.log('ğŸ“¥ è‡ªå‹•è¼‰å…¥å·²ä¿å­˜çš„ Supabase è¨­å®š');
                // ç›´æ¥åˆå§‹åŒ– Supabaseï¼ˆä¸éœ€è¦å¡«å¯«è¡¨å–®ï¼‰
                initSupabase();
                
                // å¦‚æœæœ‰è¨­å®šæ¨™ç±¤ï¼Œä¹Ÿè¦å¡«å…¥å€¼ï¼ˆå³ä½¿éš±è—äº†ï¼‰
                loadSupabaseConfig();
                
                // æª¢æŸ¥æ˜¯å¦éœ€è¦éš±è—è¨­å®šæ¨™ç±¤
                setTimeout(() => {
                    checkConfigTabVisibility();
                }, 100);
                
                // æª¢æŸ¥ URL åƒæ•¸ï¼Œå¦‚æœæœ‰ id å‰‡è¼‰å…¥è©²ç‰©ä»¶
                const urlParams = new URLSearchParams(window.location.search);
                const propertyId = urlParams.get('id');
                if (propertyId) {
                    // ç­‰å¾… Supabase åˆå§‹åŒ–å®Œæˆå¾Œå†è¼‰å…¥
                    setTimeout(() => {
                        if (supabaseClient) {
                            editProperty(propertyId);
                        }
                    }, 500);
                }
            } else {
                // å¦‚æœæ²’æœ‰ä¿å­˜çš„è¨­å®šï¼Œè¼‰å…¥è¡¨å–®é è¨­å€¼
                loadSupabaseConfig();
                
                // å³ä½¿ Supabase æœªåˆå§‹åŒ–ï¼Œä¹Ÿå…ˆä¿å­˜ IDï¼Œç­‰åˆå§‹åŒ–å®Œæˆå¾Œå†è¼‰å…¥
                const urlParams = new URLSearchParams(window.location.search);
                const propertyId = urlParams.get('id');
                if (propertyId) {
                    // ç›£è½ Supabase åˆå§‹åŒ–å®Œæˆ
                    const checkInterval = setInterval(() => {
                        if (supabaseClient) {
                            clearInterval(checkInterval);
                            editProperty(propertyId);
                        }
                    }, 500);
                    
                    // 10 ç§’å¾Œåœæ­¢æª¢æŸ¥
                    setTimeout(() => {
                        clearInterval(checkInterval);
                    }, 10000);
                }
            }
            
            // åˆå§‹åŒ–ç¸£å¸‚å€åŸŸé¸æ“‡ï¼ˆé è¨­ç‚ºæ¡ƒåœ’å¸‚ï¼‰
            const citySelect = document.getElementById('city');
            if (citySelect) {
                citySelect.value = 'æ¡ƒåœ’å¸‚';
                updateDistricts();
            }
            
            // æª¢æŸ¥æ˜¯å¦å·²è¨­å®š Supabase
            setTimeout(() => {
                if (!supabaseClient && !savedAnonKey) {
                    // æª¢æŸ¥ç•¶å‰æ˜¯å¦åœ¨æ–°å¢ç‰©ä»¶é é¢
                    const addTab = document.getElementById('add-tab');
                    if (addTab && addTab.classList.contains('active')) {
                        // åªé¡¯ç¤ºæç¤ºï¼Œä¸å¼·åˆ¶è·³è½‰ï¼ˆè®“ç”¨æˆ¶å¯ä»¥é¸æ“‡ï¼‰
                        console.warn('âš ï¸ Supabase æœªè¨­å®šï¼Œè«‹å‰å¾€ã€Œâš™ï¸ API è¨­å®šã€æ¨™ç±¤é€²è¡Œè¨­å®š');
                    }
                    // å¦‚æœ Supabase æœªè¨­å®šï¼Œé¡¯ç¤ºè¨­å®šæ¨™ç±¤
                    showConfigTab();
                } else if (supabaseClient) {
                    // å¦‚æœ Supabase å·²æˆåŠŸåˆå§‹åŒ–ï¼Œéš±è—è¨­å®šæ¨™ç±¤
                    checkConfigTabVisibility();
                }
                    testSupabaseConnection();
            }, 500);
            
            // æ”¯æ´ Enter éµæ–°å¢æ¨™ç±¤
            ['facilities', 'transport', 'schools'].forEach(type => {
                const input = document.getElementById(`${type}-input`);
                if (input) {
                    input.addEventListener('keypress', function(e) {
                        if (e.key === 'Enter') {
                            e.preventDefault();
                            addCustomTag(type);
                        }
                    });
                }
            });
            
        });
        
        // å°‡å‡½æ•¸æš´éœ²åˆ°å…¨åŸŸï¼Œæ–¹ä¾¿åœ¨æ§åˆ¶å°èª¿ç”¨
        window.showConfigTab = showConfigTab;
        window.hideConfigTab = hideConfigTab;
        
        // æ¸¬è©¦ Supabase é€£æ¥ï¼ˆå¸¶ UI é¡¯ç¤ºï¼‰
        async function testSupabaseConnection() {
            const statusDiv = document.getElementById('supabase-status');
            const statusContent = document.getElementById('supabase-status-content');
            
            if (!statusDiv || !statusContent) {
                // å¦‚æœæ²’æœ‰ç‹€æ…‹é¡¯ç¤ºå€åŸŸï¼Œç›´æ¥æ¸¬è©¦
                await testSupabaseConnectionInternal();
                return;
            }
            
            statusDiv.style.display = 'block';
            statusContent.innerHTML = '<p>ğŸ”„ æ­£åœ¨æ¸¬è©¦é€£æ¥...</p>';
            
            const results = await testSupabaseConnectionInternal();
            
            // é¡¯ç¤ºçµæœ
            let html = '<div style="display: grid; gap: 0.5rem;">';
            
            if (results.sdkLoaded) {
                html += '<p style="color: green;">âœ… Supabase SDK å·²è¼‰å…¥</p>';
            } else {
                html += '<p style="color: red;">âŒ Supabase SDK æœªè¼‰å…¥</p>';
            }
            
            if (results.supabaseInitialized) {
                html += '<p style="color: green;">âœ… Supabase å·²åˆå§‹åŒ–</p>';
            } else {
                html += '<p style="color: red;">âŒ Supabase åˆå§‹åŒ–å¤±æ•—</p>';
                if (results.initError) {
                    html += `<p style="color: orange; font-size: 0.9rem;">âš ï¸ ${results.initError}</p>`;
                }
            }
            
            if (results.databaseTest) {
                html += `<p style="color: green;">âœ… è³‡æ–™åº«é€£æ¥æˆåŠŸ</p>`;
            } else if (results.databaseError) {
                html += `<p style="color: red;">âŒ è³‡æ–™åº«é€£æ¥å¤±æ•—</p>`;
                html += `<p style="color: orange; font-size: 0.9rem; margin: 0.5rem 0;">âš ï¸ ${results.databaseError}</p>`;
            }
            
            if (results.storageTest) {
                html += '<p style="color: green;">âœ… Storage é€£æ¥æˆåŠŸ</p>';
            } else if (results.storageError) {
                html += '<p style="color: orange;">âš ï¸ Storage é€£æ¥å¤±æ•—</p>';
                html += `<p style="color: orange; font-size: 0.9rem; margin: 0.5rem 0;">âš ï¸ ${results.storageError}</p>`;
            }
            
            html += '</div>';
            statusContent.innerHTML = html;
        }
        
        // å…§éƒ¨æ¸¬è©¦å‡½æ•¸
        async function testSupabaseConnectionInternal() {
            const results = {
                sdkLoaded: false,
                supabaseInitialized: false,
                initError: null,
                databaseTest: false,
                databaseError: null,
                storageTest: false,
                storageError: null
            };
            
            // æª¢æŸ¥ SDK æ˜¯å¦è¼‰å…¥
            if (typeof supabase === 'undefined') {
                console.error('âŒ Supabase SDK æœªè¼‰å…¥');
                results.initError = 'Supabase SDK æœªè¼‰å…¥ï¼Œè«‹æª¢æŸ¥ç¶²è·¯é€£æ¥';
                return results;
            }
            results.sdkLoaded = true;
            console.log('âœ… Supabase SDK å·²è¼‰å…¥');
            
            // æª¢æŸ¥æ˜¯å¦åˆå§‹åŒ–
            if (!supabaseClient) {
                console.warn('âš ï¸ Supabase æœªåˆå§‹åŒ–');
                console.log('ğŸ’¡ æç¤ºï¼šè«‹å‰å¾€ã€Œâš™ï¸ API è¨­å®šã€æ¨™ç±¤å¡«å¯« Supabase è¨­å®š');
                results.initError = 'Supabase æœªåˆå§‹åŒ–ï¼Œè«‹å…ˆå„²å­˜è¨­å®š';
                return results;
            }
            results.supabaseInitialized = true;
            
            // æ¸¬è©¦è³‡æ–™åº«é€£æ¥
            try {
                const { data, error } = await supabaseClient
                    .from('properties')
                    .select('id')
                    .limit(1);
                
                if (error) throw error;
                
                console.log('âœ… Supabase è³‡æ–™åº«é€£æ¥æ­£å¸¸');
                results.databaseTest = true;
            } catch (error) {
                console.error('âŒ Supabase è³‡æ–™åº«é€£æ¥å¤±æ•—:', error);
                results.databaseError = error.message || 'é€£æ¥å¤±æ•—';
            }
            
            // æ¸¬è©¦ Storage é€£æ¥
            try {
                const { data, error } = await supabaseClient
                    .storage
                    .from('junyang666')
                    .list('', { limit: 1 });
                
                if (error) throw error;
                
                console.log('âœ… Supabase Storage é€£æ¥æ­£å¸¸');
                results.storageTest = true;
            } catch (error) {
                console.error('âŒ Supabase Storage é€£æ¥å¤±æ•—:', error);
                results.storageError = error.message || 'é€£æ¥å¤±æ•—';
            }
            
            return results;
        }
    </script>
</body>
</html>

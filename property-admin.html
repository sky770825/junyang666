<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç‰©ä»¶ç®¡ç†å¾Œå° | ä½å•†ä¸å‹•ç”¢</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Microsoft JhengHei', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 2rem;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 2rem;
            text-align: center;
        }
        
        .header h1 {
            font-size: 2rem;
            margin-bottom: 0.5rem;
        }
        
        .tabs {
            display: flex;
            background: #f8f9fa;
            border-bottom: 2px solid #e9ecef;
        }
        
        .tab {
            flex: 1;
            padding: 1rem;
            text-align: center;
            cursor: pointer;
            background: #f8f9fa;
            border: none;
            font-size: 1rem;
            font-weight: 600;
            color: #666;
            transition: all 0.3s ease;
        }
        
        .tab.active {
            background: white;
            color: #667eea;
            border-bottom: 3px solid #667eea;
        }
        
        .tab:hover {
            background: #e9ecef;
        }
        
        .tab-content {
            display: none;
            padding: 2rem;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .form-section {
            margin-bottom: 2rem;
            padding: 1.5rem;
            background: #f8f9fa;
            border-radius: 12px;
        }
        
        .form-section h3 {
            color: #667eea;
            margin-bottom: 1rem;
            font-size: 1.3rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1rem;
        }
        
        .form-group {
            display: flex;
            flex-direction: column;
        }
        
        .form-group label {
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: #333;
            font-size: 0.9rem;
        }
        
        .form-group input,
        .form-group select,
        .form-group textarea {
            padding: 0.7rem;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s ease;
        }
        
        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #667eea;
        }
        
        .form-group.full-width {
            grid-column: 1 / -1;
        }
        
        .form-group textarea {
            min-height: 100px;
            resize: vertical;
        }
        
        .array-input {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 0.5rem;
        }
        
        .array-input input {
            flex: 1;
        }
        
        .array-input button {
            padding: 0.5rem 1rem;
            background: #dc3545;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
        }
        
        .add-btn {
            padding: 0.5rem 1rem;
            background: #28a745;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            margin-top: 0.5rem;
        }
        
        .image-preview {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            gap: 1rem;
            margin-top: 1rem;
        }
        
        .image-item {
            position: relative;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            overflow: hidden;
            aspect-ratio: 4/3;
        }
        
        .image-item img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .image-item .remove {
            position: absolute;
            top: 5px;
            right: 5px;
            background: #dc3545;
            color: white;
            border: none;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            cursor: pointer;
            font-weight: bold;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .btn-group {
            display: flex;
            gap: 1rem;
            margin-top: 2rem;
            padding-top: 2rem;
            border-top: 2px solid #e9ecef;
        }
        
        .btn {
            flex: 1;
            padding: 1rem;
            border: none;
            border-radius: 10px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }
        
        .btn-secondary {
            background: #6c757d;
            color: white;
        }
        
        .btn-success {
            background: #28a745;
            color: white;
        }
        
        .btn-danger {
            background: #dc3545;
            color: white;
        }
        
        .preview-section {
            background: #f8f9fa;
            padding: 1.5rem;
            border-radius: 12px;
            margin-top: 2rem;
        }
        
        .preview-section h3 {
            color: #667eea;
            margin-bottom: 1rem;
        }
        
        .json-output {
            background: #2d3748;
            color: #68d391;
            padding: 1rem;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 0.85rem;
            overflow-x: auto;
            white-space: pre-wrap;
            word-wrap: break-word;
            max-height: 400px;
            overflow-y: auto;
        }
        
        .property-list {
            display: grid;
            gap: 1rem;
        }
        
        .property-item {
            background: white;
            border: 2px solid #e9ecef;
            border-radius: 12px;
            padding: 1.5rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .property-item:hover {
            border-color: #667eea;
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.2);
        }
        
        .property-info h4 {
            color: #333;
            margin-bottom: 0.5rem;
        }
        
        .property-info p {
            color: #666;
            font-size: 0.9rem;
        }
        
        .property-actions {
            display: flex;
            gap: 0.5rem;
        }
        
        .btn-small {
            padding: 0.5rem 1rem;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            font-size: 0.9rem;
        }
        
        .alert {
            padding: 1rem;
            border-radius: 8px;
            margin-bottom: 1rem;
            display: none;
        }
        
        .alert-success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .alert-error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        .alert.show {
            display: block;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ  ç‰©ä»¶ç®¡ç†å¾Œå°</h1>
            <p>æ–°å¢ã€ç·¨è¼¯ã€ç®¡ç†æˆ¿å±‹ç‰©ä»¶è³‡æ–™</p>
        </div>
        
        <div class="tabs">
            <button class="tab active" onclick="switchTab('add')">â• æ–°å¢ç‰©ä»¶</button>
            <button class="tab" onclick="switchTab('list')">ğŸ“‹ ç‰©ä»¶åˆ—è¡¨</button>
            <button class="tab" onclick="switchTab('export')">ğŸ’¾ åŒ¯å‡ºè³‡æ–™</button>
        </div>
        
        <!-- æ–°å¢ç‰©ä»¶ -->
        <div id="add-tab" class="tab-content active">
            <div id="alert-container"></div>
            
            <form id="property-form">
                <!-- åŸºæœ¬è³‡è¨Š -->
                <div class="form-section">
                    <h3>ğŸ“ åŸºæœ¬è³‡è¨Š</h3>
                    <div class="form-grid">
                        <div class="form-group">
                            <label>ç‰©ä»¶ç·¨è™Ÿ (è‡ªå‹•ç”Ÿæˆ)</label>
                            <input type="text" id="number" placeholder="ä¾‹å¦‚: 2-1" required>
                        </div>
                        <div class="form-group">
                            <label>ç‰©ä»¶æ¨™é¡Œ *</label>
                            <input type="text" id="title" placeholder="ä¾‹å¦‚: ä½è‡ªå‚™ | è¿‘é¾ç§‘ | 2æˆ¿+è»Šä½" required>
                        </div>
                        <div class="form-group">
                            <label>æˆ¿å‹ *</label>
                            <select id="type" required>
                                <option value="">è«‹é¸æ“‡</option>
                                <option value="å¥—æˆ¿">å¥—æˆ¿</option>
                                <option value="2æˆ¿">2æˆ¿</option>
                                <option value="3æˆ¿">3æˆ¿</option>
                                <option value="4æˆ¿">4æˆ¿</option>
                                <option value="è¯å»ˆ">è¯å»ˆ</option>
                                <option value="å…¬å¯“">å…¬å¯“</option>
                                <option value="é€å¤©">é€å¤©</option>
                                <option value="åº—é¢">åº—é¢</option>
                                <option value="åˆ¥å¢…">åˆ¥å¢…</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>åœ°å€ *</label>
                            <input type="text" id="address" placeholder="ä¾‹å¦‚: æ¥Šæ¢…å€æ¢…ç…è·¯äºŒæ®µ232å··***è™Ÿ10æ¨“" required>
                        </div>
                        <div class="form-group">
                            <label>ç¤¾å€åç¨±</label>
                            <input type="text" id="community" placeholder="ä¾‹å¦‚: ä¸–ç´€åŸ">
                        </div>
                        <div class="form-group">
                            <label>å”®åƒ¹ *</label>
                            <input type="text" id="price" placeholder="ä¾‹å¦‚: 896è¬" required>
                        </div>
                        <div class="form-group">
                            <label>ç‰©ä»¶ç‹€æ…‹</label>
                            <select id="status">
                                <option value="">ä¸€èˆ¬ç‰©ä»¶</option>
                                <option value="new">æ–°ä¸Šæ¶</option>
                                <option value="sold">å·²å”®å‡º</option>
                                <option value="urgent">æ€¥å”®</option>
                                <option value="selling">ç†±éŠ·ä¸­</option>
                                <option value="below-appraisal">ä½æ–¼é‘‘åƒ¹</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>ç‹€æ…‹æ–‡å­—</label>
                            <input type="text" id="statusText" placeholder="ä¾‹å¦‚: æ–°ä¸Šæ¶">
                        </div>
                    </div>
                </div>
                
                <!-- ç‰©ä»¶è©³æƒ… -->
                <div class="form-section">
                    <h3>ğŸ“ ç‰©ä»¶è©³æƒ…</h3>
                    <div class="form-grid">
                        <div class="form-group">
                            <label>æ ¼å±€ *</label>
                            <input type="text" id="layout" placeholder="ä¾‹å¦‚: 2æˆ¿2å»³1è¡›" required>
                        </div>
                        <div class="form-group">
                            <label>ç¸½åªæ•¸ *</label>
                            <input type="text" id="total_area" placeholder="ä¾‹å¦‚: 40.08åª" required>
                        </div>
                        <div class="form-group">
                            <label>ä¸»å»ºç‰©åªæ•¸</label>
                            <input type="text" id="main_area" placeholder="ä¾‹å¦‚: 18.17åª">
                        </div>
                        <div class="form-group">
                            <label>é™„å±¬å»ºç‰©åªæ•¸</label>
                            <input type="text" id="auxiliary_area" placeholder="ä¾‹å¦‚: 1.63åª">
                        </div>
                        <div class="form-group">
                            <label>å…¬è¨­åªæ•¸</label>
                            <input type="text" id="common_area" placeholder="ä¾‹å¦‚: 9.07åª">
                        </div>
                        <div class="form-group">
                            <label>åœŸåœ°åªæ•¸</label>
                            <input type="text" id="land_area" placeholder="ä¾‹å¦‚: 5.22åª">
                        </div>
                        <div class="form-group">
                            <label>è»Šä½åªæ•¸</label>
                            <input type="text" id="parking_area" placeholder="ä¾‹å¦‚: 8.5åª">
                        </div>
                        <div class="form-group">
                            <label>å±‹é½¡</label>
                            <input type="text" id="age" placeholder="ä¾‹å¦‚: 11å¹´">
                        </div>
                        <div class="form-group">
                            <label>æ¨“å±¤</label>
                            <input type="text" id="floor" placeholder="ä¾‹å¦‚: 10/14æ¨“">
                        </div>
                        <div class="form-group">
                            <label>å»ºç¯‰é¡å‹</label>
                            <select id="building_type">
                                <option value="">è«‹é¸æ“‡</option>
                                <option value="é›»æ¢¯å¤§æ¨“">é›»æ¢¯å¤§æ¨“</option>
                                <option value="è¯å»ˆ">è¯å»ˆ</option>
                                <option value="é€å¤©åˆ¥å¢…">é€å¤©åˆ¥å¢…</option>
                                <option value="å¤§æ¨“">å¤§æ¨“</option>
                                <option value="å¤§å»ˆ">å¤§å»ˆ</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>åº§å‘</label>
                            <input type="text" id="orientation" placeholder="ä¾‹å¦‚: åº§åŒ—æœå—">
                        </div>
                        <div class="form-group">
                            <label>ç®¡ç†è²»</label>
                            <input type="text" id="management_fee" placeholder="ä¾‹å¦‚: 2,077å…ƒ/æœˆ">
                        </div>
                        <div class="form-group">
                            <label>è»Šä½é¡å‹</label>
                            <input type="text" id="parking_type" placeholder="ä¾‹å¦‚: å¹³é¢è»Šä½">
                        </div>
                        <div class="form-group">
                            <label>è»Šä½ç·¨è™Ÿ</label>
                            <input type="text" id="parking_space" placeholder="ä¾‹å¦‚: B3-14">
                        </div>
                        <div class="form-group">
                            <label>ç¾æ³</label>
                            <input type="text" id="current_status" placeholder="ä¾‹å¦‚: ç©ºå±‹">
                        </div>
                    </div>
                </div>
                
                <!-- äº¤é€šèˆ‡è¨­æ–½ -->
                <div class="form-section">
                    <h3>ğŸš— äº¤é€šèˆ‡è¨­æ–½</h3>
                    <div class="form-grid">
                        <div class="form-group">
                            <label>ç”Ÿæ´»è¨­æ–½ (æ¯è¡Œä¸€å€‹)</label>
                            <textarea id="facilities" placeholder="æ¢…ç…è·¯å•†åœˆ&#10;å…¨è¯ç¦åˆ©ä¸­å¿ƒ&#10;7-ELEVEN"></textarea>
                        </div>
                        <div class="form-group">
                            <label>äº¤é€šè¨­æ–½ (æ¯è¡Œä¸€å€‹)</label>
                            <textarea id="transport" placeholder="å°1ç·š&#10;æ¥Šæ¢…äº¤æµé“&#10;åŸ”å¿ƒç«è»Šç«™"></textarea>
                        </div>
                        <div class="form-group">
                            <label>å­¸å€ (æ¯è¡Œä¸€å€‹)</label>
                            <textarea id="schools" placeholder="é™½å…‰åœ‹å°&#10;ç‘å¡˜åœ‹å°&#10;ç‘åªåœ‹ä¸­"></textarea>
                        </div>
                        <div class="form-group">
                            <label>å¸‚å ´</label>
                            <input type="text" id="market" placeholder="ä¾‹å¦‚: è¬å¤§å¸‚å ´">
                        </div>
                        <div class="form-group">
                            <label>å…¬åœ’</label>
                            <input type="text" id="park" placeholder="ä¾‹å¦‚: å››ç¶­å…¬åœ’">
                        </div>
                    </div>
                </div>
                
                <!-- ç‰¹è‰²èˆ‡æè¿° -->
                <div class="form-section">
                    <h3>âœ¨ ç‰¹è‰²èˆ‡æè¿°</h3>
                    <div class="form-grid">
                        <div class="form-group full-width">
                            <label>ç‰©ä»¶ç‰¹è‰² (æ¯è¡Œä¸€å€‹)</label>
                            <textarea id="features" placeholder="è¿‘å­¸å€&#10;äº¤é€šä¾¿åˆ©&#10;ç®¡ç†å®Œå–„"></textarea>
                        </div>
                        <div class="form-group full-width">
                            <label>ç‰©ä»¶æè¿°</label>
                            <textarea id="description" placeholder="è©³ç´°æè¿°ç‰©ä»¶ç‰¹è‰²..."></textarea>
                        </div>
                    </div>
                </div>
                
                <!-- åœ–ç‰‡ -->
                <div class="form-section">
                    <h3>ğŸ“· ç‰©ä»¶åœ–ç‰‡</h3>
                    <div class="form-group full-width">
                        <label>åœ–ç‰‡è·¯å¾‘ (æ¯è¡Œä¸€å€‹ï¼Œç›¸å°è·¯å¾‘)</label>
                        <textarea id="images" placeholder="images/2-1/å®¢å»³.jpg&#10;images/2-1/ä¸»è‡¥æˆ¿.jpg&#10;images/2-1/æ ¼å±€åœ–.png" rows="5"></textarea>
                        <p style="font-size: 0.85rem; color: #666; margin-top: 0.5rem;">
                            ğŸ’¡ æç¤ºï¼šè¼¸å…¥åœ–ç‰‡è·¯å¾‘ï¼Œæ¯è¡Œä¸€å€‹ã€‚ä¾‹å¦‚ï¼šimages/2-1/å®¢å»³.jpg
                        </p>
                    </div>
                    <div id="image-preview" class="image-preview"></div>
                </div>
                
                <!-- å…¶ä»–è³‡è¨Š -->
                <div class="form-section">
                    <h3>ğŸ”— å…¶ä»–è³‡è¨Š</h3>
                    <div class="form-grid">
                        <div class="form-group full-width">
                            <label>Google Maps åµŒå…¥ç¶²å€</label>
                            <input type="text" id="google_maps" placeholder="https://www.google.com/maps/embed?pb=...">
                        </div>
                        <div class="form-group">
                            <label>TikTok å½±ç‰‡ ID</label>
                            <input type="text" id="tiktok_video_id" placeholder="ä¾‹å¦‚: 7531311616948948230">
                        </div>
                        <div class="form-group">
                            <label>TikTok ä½¿ç”¨è€…åç¨±</label>
                            <input type="text" id="tiktok_username" placeholder="ä¾‹å¦‚: @aihouse168">
                        </div>
                        <div class="form-group">
                            <label>åƒè€ƒé€£çµ</label>
                            <input type="text" id="reference_link" placeholder="https://...">
                        </div>
                    </div>
                </div>
                
                <div class="btn-group">
                    <button type="button" class="btn btn-primary" onclick="generateJSON()">ğŸ” é è¦½ JSON</button>
                    <button type="button" class="btn btn-success" onclick="saveProperty()">ğŸ’¾ å„²å­˜åˆ° property-data.js</button>
                    <button type="button" class="btn btn-secondary" onclick="resetForm()">ğŸ”„ é‡è¨­è¡¨å–®</button>
                </div>
                
                <div class="preview-section" id="preview-section" style="display: none;">
                    <h3>ğŸ“‹ ç”Ÿæˆçš„ JSON é è¦½</h3>
                    <div class="json-output" id="json-output"></div>
                    <div class="btn-group" style="margin-top: 1rem;">
                        <button type="button" class="btn btn-primary" onclick="copyJSON()">ğŸ“‹ è¤‡è£½ JSON</button>
                    </div>
                </div>
            </form>
        </div>
        
        <!-- ç‰©ä»¶åˆ—è¡¨ -->
        <div id="list-tab" class="tab-content">
            <div class="form-section">
                <h3>ğŸ“‹ ç¾æœ‰ç‰©ä»¶åˆ—è¡¨</h3>
                <div id="property-list" class="property-list">
                    <p style="text-align: center; color: #666; padding: 2rem;">
                        è¼‰å…¥ä¸­... (éœ€è¦è¼‰å…¥ property-data.js)
                    </p>
                </div>
            </div>
        </div>
        
        <!-- åŒ¯å‡ºè³‡æ–™ -->
        <div id="export-tab" class="tab-content">
            <div class="form-section">
                <h3>ğŸ’¾ åŒ¯å‡ºç‰©ä»¶è³‡æ–™</h3>
                <p style="margin-bottom: 1rem; color: #666;">
                    é»æ“Šä¸‹æ–¹æŒ‰éˆ•ä¾†è¤‡è£½å®Œæ•´çš„ property-data.js æª”æ¡ˆå…§å®¹
                </p>
                <div class="btn-group">
                    <button type="button" class="btn btn-primary" onclick="exportAllData()">ğŸ“‹ è¤‡è£½å®Œæ•´è³‡æ–™</button>
                </div>
                <div class="preview-section" id="export-preview" style="display: none; margin-top: 2rem;">
                    <h3>ğŸ“‹ å®Œæ•´è³‡æ–™</h3>
                    <div class="json-output" id="export-output"></div>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        // è¼‰å…¥ç¾æœ‰è³‡æ–™
        let propertiesData = { properties: [] };
        
        // è¼‰å…¥ property-data.js (å¦‚æœå­˜åœ¨)
        function loadExistingData() {
            // å˜—è©¦è¼‰å…¥ property-data.js
            const script = document.createElement('script');
            script.src = 'property-data.js';
            script.onload = function() {
                if (typeof embeddedPropertiesData !== 'undefined') {
                    propertiesData = embeddedPropertiesData;
                    updatePropertyList();
                }
            };
            script.onerror = function() {
                console.log('ç„¡æ³•è¼‰å…¥ property-data.jsï¼Œå°‡ä½¿ç”¨ç©ºè³‡æ–™');
            };
            document.head.appendChild(script);
        }
        
        // åˆ‡æ›æ¨™ç±¤
        function switchTab(tabName) {
            // éš±è—æ‰€æœ‰æ¨™ç±¤å…§å®¹
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            
            // ç§»é™¤æ‰€æœ‰æ¨™ç±¤çš„ active ç‹€æ…‹
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // é¡¯ç¤ºé¸ä¸­çš„æ¨™ç±¤å…§å®¹
            document.getElementById(tabName + '-tab').classList.add('active');
            
            // æ·»åŠ æ¨™ç±¤çš„ active ç‹€æ…‹
            event.target.classList.add('active');
            
            // å¦‚æœæ˜¯åˆ—è¡¨æ¨™ç±¤ï¼Œæ›´æ–°åˆ—è¡¨
            if (tabName === 'list') {
                updatePropertyList();
            }
        }
        
        // ç”Ÿæˆç‰©ä»¶ ID
        function generatePropertyId() {
            const maxId = propertiesData.properties.reduce((max, prop) => {
                const match = prop.id.match(/prop_(\d+)/);
                if (match) {
                    const num = parseInt(match[1]);
                    return num > max ? num : max;
                }
                return max;
            }, 0);
            return `prop_${String(maxId + 1).padStart(3, '0')}`;
        }
        
        // ç”Ÿæˆ JSON
        function generateJSON() {
            const formData = collectFormData();
            const jsonStr = formatPropertyJSON(formData);
            
            document.getElementById('json-output').textContent = jsonStr;
            document.getElementById('preview-section').style.display = 'block';
            
            // æ»¾å‹•åˆ°é è¦½å€åŸŸ
            document.getElementById('preview-section').scrollIntoView({ behavior: 'smooth' });
        }
        
        // æ”¶é›†è¡¨å–®è³‡æ–™
        function collectFormData() {
            const data = {
                id: generatePropertyId(),
                number: document.getElementById('number').value.trim(),
                title: document.getElementById('title').value.trim(),
                type: document.getElementById('type').value.trim(),
                address: document.getElementById('address').value.trim(),
                price: document.getElementById('price').value.trim(),
                layout: document.getElementById('layout').value.trim(),
                total_area: document.getElementById('total_area').value.trim(),
                status: document.getElementById('status').value.trim(),
                statusText: document.getElementById('statusText').value.trim()
            };
            
            // å¯é¸æ¬„ä½
            const optionalFields = [
                'community', 'main_area', 'auxiliary_area', 'common_area', 
                'land_area', 'parking_area', 'age', 'floor', 'building_type',
                'orientation', 'management_fee', 'parking_type', 'parking_space',
                'current_status', 'description', 'google_maps', 'tiktok_video_id',
                'tiktok_username', 'reference_link'
            ];
            
            optionalFields.forEach(field => {
                const value = document.getElementById(field).value.trim();
                if (value) {
                    data[field] = value;
                }
            });
            
            // è™•ç†é™£åˆ—æ¬„ä½
            const imagesText = document.getElementById('images').value.trim();
            if (imagesText) {
                data.images = imagesText.split('\n').map(line => line.trim()).filter(line => line);
            }
            
            const featuresText = document.getElementById('features').value.trim();
            if (featuresText) {
                data.features = featuresText.split('\n').map(line => line.trim()).filter(line => line);
            }
            
            // è™•ç†äº¤é€šèˆ‡è¨­æ–½
            const transportation = {};
            const facilitiesText = document.getElementById('facilities').value.trim();
            if (facilitiesText) {
                transportation.facilities = facilitiesText.split('\n').map(line => line.trim()).filter(line => line);
            }
            
            const transportText = document.getElementById('transport').value.trim();
            if (transportText) {
                transportation.transport = transportText.split('\n').map(line => line.trim()).filter(line => line);
            }
            
            const schoolsText = document.getElementById('schools').value.trim();
            if (schoolsText) {
                transportation.schools = schoolsText.split('\n').map(line => line.trim()).filter(line => line);
            }
            
            const market = document.getElementById('market').value.trim();
            if (market) transportation.market = market;
            
            const park = document.getElementById('park').value.trim();
            if (park) transportation.park = park;
            
            if (Object.keys(transportation).length > 0) {
                data.transportation = transportation;
            }
            
            return data;
        }
        
        // æ ¼å¼åŒ– JSON
        function formatPropertyJSON(data) {
            let json = '{\n';
            json += `    id: "${data.id}",\n`;
            
            const fields = [
                'title', 'number', 'type', 'address', 'price', 'total_area',
                'main_area', 'status', 'statusText', 'layout', 'age', 'floor',
                'building_type', 'parking_space', 'parking_type', 'current_status',
                'management_fee', 'orientation', 'auxiliary_area', 'common_area',
                'land_area', 'parking_area', 'community', 'description'
            ];
            
            fields.forEach(field => {
                if (data[field]) {
                    json += `    ${field}: "${data[field]}",\n`;
                }
            });
            
            if (data.images && data.images.length > 0) {
                json += `    images: [\n`;
                data.images.forEach((img, index) => {
                    json += `        "${img}"${index < data.images.length - 1 ? ',' : ''}\n`;
                });
                json += `    ],\n`;
            }
            
            if (data.transportation) {
                json += `    transportation: {\n`;
                if (data.transportation.facilities) {
                    json += `        facilities: [\n`;
                    data.transportation.facilities.forEach((item, index) => {
                        json += `            "${item}"${index < data.transportation.facilities.length - 1 ? ',' : ''}\n`;
                    });
                    json += `        ],\n`;
                }
                if (data.transportation.transport) {
                    json += `        transport: [\n`;
                    data.transportation.transport.forEach((item, index) => {
                        json += `            "${item}"${index < data.transportation.transport.length - 1 ? ',' : ''}\n`;
                    });
                    json += `        ],\n`;
                }
                if (data.transportation.schools) {
                    json += `        schools: [\n`;
                    data.transportation.schools.forEach((item, index) => {
                        json += `            "${item}"${index < data.transportation.schools.length - 1 ? ',' : ''}\n`;
                    });
                    json += `        ],\n`;
                }
                if (data.transportation.market) {
                    json += `        market: "${data.transportation.market}",\n`;
                }
                if (data.transportation.park) {
                    json += `        park: "${data.transportation.park}",\n`;
                }
                json += `    },\n`;
            }
            
            if (data.features && data.features.length > 0) {
                json += `    features: [\n`;
                data.features.forEach((feature, index) => {
                    json += `        "${feature}"${index < data.features.length - 1 ? ',' : ''}\n`;
                });
                json += `    ],\n`;
            }
            
            const otherFields = ['google_maps', 'tiktok_video_id', 'tiktok_username', 'reference_link'];
            otherFields.forEach(field => {
                if (data[field]) {
                    json += `    ${field}: "${data[field]}",\n`;
                }
            });
            
            json = json.slice(0, -2) + '\n}'; // ç§»é™¤æœ€å¾Œçš„é€—è™Ÿå’Œæ›è¡Œ
            return json;
        }
        
        // è¤‡è£½ JSON
        function copyJSON() {
            const jsonText = document.getElementById('json-output').textContent;
            navigator.clipboard.writeText(jsonText).then(() => {
                showAlert('success', 'JSON å·²è¤‡è£½åˆ°å‰ªè²¼ç°¿ï¼');
            });
        }
        
        // å„²å­˜ç‰©ä»¶
        function saveProperty() {
            const formData = collectFormData();
            
            // é©—è­‰å¿…å¡«æ¬„ä½
            if (!formData.title || !formData.type || !formData.address || !formData.price || !formData.layout || !formData.total_area) {
                showAlert('error', 'è«‹å¡«å¯«æ‰€æœ‰å¿…å¡«æ¬„ä½ï¼');
                return;
            }
            
            // æ·»åŠ åˆ°è³‡æ–™é™£åˆ—
            propertiesData.properties.push(formData);
            
            showAlert('success', `ç‰©ä»¶å·²æ–°å¢ï¼ID: ${formData.id}`);
            
            // è‡ªå‹•ç”Ÿæˆ JSON
            generateJSON();
            
            // æ›´æ–°åˆ—è¡¨
            updatePropertyList();
        }
        
        // é‡è¨­è¡¨å–®
        function resetForm() {
            document.getElementById('property-form').reset();
            document.getElementById('preview-section').style.display = 'none';
            document.getElementById('image-preview').innerHTML = '';
        }
        
        // æ›´æ–°ç‰©ä»¶åˆ—è¡¨
        function updatePropertyList() {
            const listContainer = document.getElementById('property-list');
            
            if (!propertiesData.properties || propertiesData.properties.length === 0) {
                listContainer.innerHTML = '<p style="text-align: center; color: #666; padding: 2rem;">ç›®å‰æ²’æœ‰ç‰©ä»¶è³‡æ–™</p>';
                return;
            }
            
            listContainer.innerHTML = propertiesData.properties.map((prop, index) => `
                <div class="property-item">
                    <div class="property-info">
                        <h4>${prop.title || 'æœªå‘½åç‰©ä»¶'}</h4>
                        <p>ç·¨è™Ÿ: ${prop.number || 'N/A'} | æˆ¿å‹: ${prop.type || 'N/A'} | åƒ¹æ ¼: ${prop.price || 'N/A'}</p>
                    </div>
                    <div class="property-actions">
                        <button class="btn-small btn-primary" onclick="editProperty(${index})">âœï¸ ç·¨è¼¯</button>
                        <button class="btn-small btn-danger" onclick="deleteProperty(${index})">ğŸ—‘ï¸ åˆªé™¤</button>
                    </div>
                </div>
            `).join('');
        }
        
        // ç·¨è¼¯ç‰©ä»¶
        function editProperty(index) {
            const prop = propertiesData.properties[index];
            
            // å¡«å…¥è¡¨å–®
            Object.keys(prop).forEach(key => {
                const element = document.getElementById(key);
                if (element) {
                    if (Array.isArray(prop[key])) {
                        element.value = prop[key].join('\n');
                    } else if (typeof prop[key] === 'object') {
                        // è™•ç† transportation ç­‰ç‰©ä»¶
                        if (key === 'transportation') {
                            if (prop[key].facilities) {
                                document.getElementById('facilities').value = prop[key].facilities.join('\n');
                            }
                            if (prop[key].transport) {
                                document.getElementById('transport').value = prop[key].transport.join('\n');
                            }
                            if (prop[key].schools) {
                                document.getElementById('schools').value = prop[key].schools.join('\n');
                            }
                            if (prop[key].market) {
                                document.getElementById('market').value = prop[key].market;
                            }
                            if (prop[key].park) {
                                document.getElementById('park').value = prop[key].park;
                            }
                        }
                    } else {
                        element.value = prop[key];
                    }
                }
            });
            
            // åˆ‡æ›åˆ°æ–°å¢æ¨™ç±¤
            switchTab('add');
            document.querySelectorAll('.tab')[0].classList.add('active');
            document.querySelectorAll('.tab')[0].click();
        }
        
        // åˆªé™¤ç‰©ä»¶
        function deleteProperty(index) {
            if (confirm('ç¢ºå®šè¦åˆªé™¤é€™å€‹ç‰©ä»¶å—ï¼Ÿ')) {
                propertiesData.properties.splice(index, 1);
                updatePropertyList();
                showAlert('success', 'ç‰©ä»¶å·²åˆªé™¤ï¼');
            }
        }
        
        // åŒ¯å‡ºæ‰€æœ‰è³‡æ–™
        function exportAllData() {
            let output = '// ç‰©ä»¶è³‡æ–™æ¨¡çµ„ - å®Œæ•´çš„ç‰©ä»¶è³‡æ–™\n';
            output += '// ğŸ”¥ æ”¯æŒç·©å­˜æ©Ÿåˆ¶ï¼Œå„ªåŒ–æ€§èƒ½\n\n';
            output += '// å„ªåŒ–çš„ç‰©ä»¶è³‡æ–™çµæ§‹\n';
            output += 'const embeddedPropertiesData = {\n';
            output += '    properties: [\n';
            
            propertiesData.properties.forEach((prop, index) => {
                const jsonStr = formatPropertyJSON(prop);
                // æ·»åŠ ç¸®æ’
                const indentedJson = jsonStr.split('\n').map(line => '        ' + line).join('\n');
                output += indentedJson;
                if (index < propertiesData.properties.length - 1) {
                    output += ',\n';
                } else {
                    output += '\n';
                }
            });
            
            output += '    ],\n';
            output += '    settings: {\n';
            output += '        itemsPerPage: 8,\n';
            output += '        maxPages: 10,\n';
            output += '        enableSearch: true,\n';
            output += '        enableFilter: true\n';
            output += '    }\n';
            output += '};\n\n';
            output += '// åŒ¯å‡ºè³‡æ–™ä¾›å…¶ä»–æ¨¡çµ„ä½¿ç”¨\n';
            output += 'if (typeof module !== \'undefined\' && module.exports) {\n';
            output += '    module.exports = embeddedPropertiesData;\n';
            output += '}\n';
            
            document.getElementById('export-output').textContent = output;
            document.getElementById('export-preview').style.display = 'block';
            
            // è¤‡è£½åˆ°å‰ªè²¼ç°¿
            navigator.clipboard.writeText(output).then(() => {
                showAlert('success', 'å®Œæ•´è³‡æ–™å·²è¤‡è£½åˆ°å‰ªè²¼ç°¿ï¼æ‚¨å¯ä»¥è²¼ä¸Šåˆ° property-data.js æª”æ¡ˆä¸­ã€‚');
            });
        }
        
        // é¡¯ç¤ºæç¤ºè¨Šæ¯
        function showAlert(type, message) {
            const alertContainer = document.getElementById('alert-container');
            const alert = document.createElement('div');
            alert.className = `alert alert-${type} show`;
            alert.textContent = message;
            alertContainer.innerHTML = '';
            alertContainer.appendChild(alert);
            
            setTimeout(() => {
                alert.classList.remove('show');
                setTimeout(() => alert.remove(), 300);
            }, 3000);
        }
        
        // é é¢è¼‰å…¥æ™‚
        document.addEventListener('DOMContentLoaded', function() {
            loadExistingData();
        });
    </script>
</body>
</html>

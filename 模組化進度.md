# 模組化實施進度

> 依《模組化方案.md》分階段進行，便於維護與擴充。此文件記錄當前狀態與下一步。

---

## 一、已完成

| 項目 | 說明 |
|------|------|
| **modules/related-links/** | 相關連結後台（backend.js）與前台（frontend.js）已模組化，admin-dashboard / property-detail 以 `<script>` 引用。 |
| **supabase-config.js** | 統一 Supabase 設定，多頁共用；已加註「僅供本專案使用、勿與其他應用共用」。 |
| **scripts/ 目錄** | 新增物件腳本（add-property）、SQL 腳本（sql）已集中於 scripts/，檔案分類清楚。 |
| **css/theme.css** | 全站共用變數與基礎 reset，供後續各頁 CSS 抽離時引用。 |
| **Supabase 隔離說明** | 《Supabase-資料庫隔離與命名說明.md》已建立，確保資料庫不與他專案混用、名稱可辨識。 |
| **Phase 1** | 已將 admin-dashboard、property-detail、property-admin-db 的內嵌 CSS 抽成 `css/admin-dashboard.css`、`css/property-detail.css`、`css/property-admin-db.css`，各頁改為引用 theme.css + 頁面專用 CSS。 |
| **Phase 2** | index.html 底部 JS 已在 js/index-init.js，首頁已為模組化載入。 |
| **Phase 3** | main-script.js 已拆成 js/lib/utils.js、lightbox.js、map-modal.js、tiktok-modal.js、loan-calculator.js；main-script.js 僅保留 F5、分頁初始化、DOMContentLoaded（輪播與下拉選單）。 |
| **Phase 5** | admin-dashboard：QR 載入已抽成 js/admin/qrcode-loader.js，主體 JS 已抽成 js/admin/dashboard.js；admin-dashboard.html 改為引用上述兩檔（related-links 之後載入）。 |
| **Phase 6** | property-admin-db：表單與邏輯已抽成 js/property-admin-db.js；property-admin-db.html 改為引用 Supabase SDK + js/property-admin-db.js（iframe 與獨立開啟皆可正常使用）。 |
| **Phase 7** | property-detail：basePath 計算、動態載入 supabase-config / frontend、詳情渲染與燈箱等已抽成 js/property-detail.js；property-detail.html 改為引用 Supabase SDK + js/property-detail.js。 |

---

## 二、待進行（依《模組化方案.md》順序）

| 階段 | 內容 | 風險 | 備註 |
|------|------|------|------|
| **Phase 4** | pagination-system.js 拆成 embedded / sold（可選） | 中 | 視維護需求決定 |

---

## 三、建議下一步

1. **Phase 4（可選）**：若需維護分頁邏輯，可將 pagination-system.js 拆成 js/pagination-embedded.js 與 js/pagination-sold.js。
2. **Supabase**：在 Dashboard 確認專案顯示名稱為「junyang666」或「子菲濬瑒物件網站」，並勾選《Supabase-資料庫隔離與命名說明.md》中的檢查清單。
3. **測試**：部署後確認 admin-dashboard、property-admin-db（含 iframe）、property-detail 各頁功能與路徑正常。

---

## 四、目錄結構（目標）

```
專案根目錄/
├── css/
│   ├── theme.css          ✅ 已有
│   ├── index.css          ✅ 已有
│   ├── admin-dashboard.css   ✅ 已有（Phase 1 完成）
│   ├── property-detail.css   ✅ 已有（Phase 1 完成）
│   └── property-admin-db.css ✅ 已有（Phase 1 完成）
├── js/
│   ├── index-init.js       ✅ 已有
│   ├── lib/                  ✅ 已有（Phase 3 完成）
│   │   ├── lightbox.js
│   │   ├── map-modal.js
│   │   ├── tiktok-modal.js
│   │   ├── loan-calculator.js
│   │   └── utils.js
│   ├── admin/                  ✅ 已有（Phase 5 完成）
│   │   ├── qrcode-loader.js
│   │   └── dashboard.js
│   ├── property-detail.js      ✅ 已有（Phase 7 完成）
│   └── property-admin-db.js    ✅ 已有（Phase 6 完成）
├── modules/
│   └── related-links/      ✅ 已有
│       ├── backend.js
│       └── frontend.js
├── scripts/
│   ├── add-property/       ✅ 已有
│   └── sql/                ✅ 已有
├── supabase-config.js      ✅ 已有（已加註隔離說明）
└── （各頁 HTML 精簡為結構 + 引用上述 CSS/JS）
```

---

## 五、注意事項

- 每次只完成一個 Phase 或一個檔案抽離，完成後測試再進行下一步。
- 若有 Cloudflare 或 CDN 快取，部署後需確認靜態資源（CSS/JS）更新生效。
- 模組化後若路徑改變（例如從根目錄改到子目錄），需一併檢查 `basePath`、`script src`、`link href`。

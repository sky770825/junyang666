# 物件新增 SOP（標準作業程序）

## 📋 概述

當收到用戶提供的物件資料（截圖、圖片或文字資訊）時，自動執行以下流程：

1. **自動判定內容**
2. **精準提取資料**
3. **建立新增頁面**
4. **驗證資料完整性**

## 🎯 自動判定項目

### 1. 樓層資訊判定

從以下欄位自動提取：
- **出售樓層**：從「出售樓層」欄位提取（例如：7樓）
- **最高樓層**：從「最高樓層」欄位提取（例如：12樓）
- **地下樓層**：從「地下樓層」欄位提取（例如：2樓）
- **格式**：`{出售樓層}/{最高樓層}`（例如：`7樓/12樓`）

**判定規則：**
- 如果只有出售樓層：使用 `{出售樓層}樓`
- 如果有最高樓層：使用 `{出售樓層}樓/{最高樓層}樓`
- 如果有地下樓層：在描述中註明

### 2. 房屋類型判定

從「房屋型式」或「格局」欄位自動判定：

| 圖片中的類型 | 系統對應類型 | 編號前綴 |
|------------|------------|---------|
| 套房 | 套房 | SU |
| 2房 | 2房 | TW |
| 3房 | 3房 | TH |
| 4房 | 4房 | FO |
| 透天 | 透天 | TH |
| 別墅 | 別墅 | VI |
| 店面 | 店面 | SH |
| 華廈 | 2房 或 華廈 | TW |
| 大樓 | 3房 或 大樓 | TH |
| 公寓 | 公寓 | AP |

**判定邏輯：**
1. 優先使用「格局」欄位（例如：3房2廳2衛 → 3房）
2. 如果沒有格局，使用「房屋型式」欄位
3. 華廈預設為2房，大樓預設為3房

### 3. 所在區塊判定（從照片辨別）

**需要提取的資訊：**
- **地址**：完整地址（例如：桃園市楊梅區環南路80巷1號7樓）
- **地址詳情**：不含縣市的地址（例如：環南路80巷1號7樓）
- **區域**：從地址提取（例如：楊梅區）
- **城市**：從地址提取（例如：桃園市）

**從照片辨別：**
- 如果照片中有地圖，提取地圖上的位置資訊
- 如果照片中有地址文字，直接提取
- 驗證地址格式是否正確

## 📊 資料提取清單

### 必填欄位（必須精準提取）

1. **基本資訊**
   - [ ] 案名（Case Name）
   - [ ] 社區名稱（Community Name）
   - [ ] 地址（完整地址）
   - [ ] 售價（Price）

2. **坪數資訊**
   - [ ] 主建物（Main Building）
   - [ ] 附屬建物（Ancillary Building）
   - [ ] 車位（Parking Space）
   - [ ] 公設（Public Facilities）
   - [ ] 總坪數（Total Area）
   - [ ] 持分後地坪（Land Area）

3. **房屋現況**
   - [ ] 格局（Layout）
   - [ ] 房屋型式（Property Type）
   - [ ] 屋齡（Age）
   - [ ] 建物完成日（Building Completion Date）
   - [ ] 管理費/月（Management Fee）
   - [ ] 出售樓層（Floor for Sale）
   - [ ] 最高樓層（Highest Floor）
   - [ ] 座向（Orientation）
   - [ ] 警衛管理（Security Management）
   - [ ] 天然瓦斯（Natural Gas）
   - [ ] 裝潢（Decoration）
   - [ ] 車位資訊（Parking Space Details）
   - [ ] 目前現況（Current Status）

4. **環境及交通**
   - [ ] 鄰近明顯設施（Nearby Facilities）
   - [ ] 交通（Transportation）
   - [ ] 學校（Schools）
   - [ ] 市場（Market）
   - [ ] 公園（Park）

5. **附註/特色**
   - [ ] 物件特色描述
   - [ ] 賣點說明

### 資料格式規範

#### 價格格式
- 必須包含「萬」或「元」
- 範例：`938萬`、`1188萬`

#### 坪數格式
- 必須包含「坪」
- 範例：`16.54坪`、`39.92坪`

#### 格局格式
- 標準格式：`{房數}房{廳數}廳{衛數}衛`
- 範例：`2房2廳1衛`、`3房2廳2衛`

#### 樓層格式
- 標準格式：`{出售樓層}樓/{最高樓層}樓`
- 範例：`7樓/12樓`、`2樓/7樓`

#### 管理費格式
- 標準格式：`{金額}元/月`
- 範例：`3740元/月`、`3087元/月`

## 🔍 資料驗證規則

### 1. 必填欄位檢查
- 案名、地址、售價、格局、總坪數必須存在
- 如果缺少必填欄位，標記為「需要確認」

### 2. 格式驗證
- 價格必須是數字+「萬」或「元」
- 坪數必須是數字+「坪」
- 格局必須符合 `{數字}房{數字}廳{數字}衛` 格式

### 3. 邏輯驗證
- 總坪數 = 主建物 + 附屬建物 + 車位 + 公設（允許小誤差）
- 出售樓層 ≤ 最高樓層
- 屋齡 = 當前年份 - 建物完成年份

## 📝 建立新增頁面範本

### 檔案命名規則
- 格式：`add-{社區名稱或案名簡稱}-property.html`
- 範例：`add-xinsydney-property.html`、`add-guiguan-property.html`

### 頁面結構
1. **標題**：顯示案名和社區
2. **資訊預覽**：顯示提取的關鍵資訊
3. **新增按鈕**：執行新增操作
4. **結果顯示**：顯示新增結果

### 程式碼範本
```javascript
// 自動生成物件編號
async function generatePropertyNumber() {
    const type = '3房'; // 從判定結果取得
    const prefix = getTypePrefix(type); // TH
    // ... 生成邏輯
}

// 準備物件資料
const propertyData = {
    number: propertyNumber,
    title: '案名',
    type: '3房', // 從判定結果取得
    address: '完整地址',
    // ... 其他欄位
};
```

## 🚀 執行流程

### 步驟 1：接收資料
- 用戶提供截圖、圖片或文字資訊

### 步驟 2：自動判定
1. 提取所有可見的文字資訊
2. 判定樓層資訊
3. 判定房屋類型
4. 判定所在區塊

### 步驟 3：建立新增頁面
1. 建立 HTML 檔案
2. 填入所有提取的資料
3. 設定正確的資料格式

### 步驟 4：驗證資料
1. 檢查必填欄位
2. 驗證資料格式
3. 檢查邏輯一致性

### 步驟 5：執行新增
1. 用戶開啟新增頁面
2. 點擊「新增物件到資料庫」
3. 系統自動生成物件編號
4. 新增到 Supabase 資料庫

### 步驟 6：確認顯示
1. 檢查物件卡片是否正確顯示
2. 檢查獨立頁面是否正確顯示
3. 驗證所有資料是否完整

## ⚠️ 注意事項

### 資料精準度要求
- **所有數字必須精準**：不能四捨五入或估算
- **所有文字必須完整**：不能省略或簡化
- **格式必須統一**：遵循既定的格式規範

### 特殊情況處理
1. **缺少資訊**：標記為「需要確認」，在描述中註明
2. **格式不符**：自動轉換為標準格式
3. **圖片模糊**：請用戶提供更清晰的圖片

### 品質檢查
- 新增前：檢查所有必填欄位
- 新增後：驗證資料是否正確寫入
- 顯示後：確認前端顯示是否正確

## 📌 範例

### 輸入：物件銷售資料表截圖
- 案名：楊梅國中景觀三房加車位
- 社區：桂冠A+
- 地址：楊梅區環南路80巷1號7樓
- 售價：1188萬
- 格局：3房2廳2衛
- 總坪數：46.03坪

### 自動判定結果
- **樓層資訊**：7樓/12樓
- **房屋類型**：3房（TH）
- **所在區塊**：桃園市楊梅區環南路

### 輸出：`add-guiguan-property.html`
- 包含所有提取的資料
- 格式正確
- 可直接執行新增

## 🔄 持續改進

1. **學習模式**：記錄每次新增的資料，優化判定準確度
2. **格式更新**：根據實際使用情況調整格式規範
3. **驗證加強**：增加更多驗證規則，確保資料品質

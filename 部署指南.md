# 🚀 部署指南

## 📋 部署前準備

### 1. 後端伺服器部署

#### 選項 A：使用 Node.js 託管服務（推薦）

**Vercel、Railway、Render 等平台：**

1. 將專案推送到 GitHub
2. 在託管平台創建新專案
3. 連接 GitHub 倉庫
4. 設定環境變數（如果需要）
5. 部署完成後會獲得後端 URL，例如：`https://your-api.vercel.app`

#### 選項 B：使用自己的伺服器

1. 在伺服器上安裝 Node.js
2. 上傳專案檔案
3. 執行 `npm install`
4. 使用 PM2 運行：
   ```bash
   npm install -g pm2
   pm2 start server.js --name property-api
   pm2 save
   pm2 startup
   ```

#### 選項 C：使用 Docker

```dockerfile
FROM node:18-alpine
WORKDIR /app
COPY package*.json ./
RUN npm install
COPY . .
EXPOSE 3000
CMD ["node", "server.js"]
```

---

## 🔧 設定 API URL

### 方法 1：自動偵測（已內建）

系統會自動根據當前網域設定 API URL：
- **本地開發**：`http://localhost:3000/api`
- **生產環境**：`https://您的網域/api`（假設後端在同一網域）

### 方法 2：手動設定（後端在不同網域）

1. 打開 `property-admin-db.html`
2. 點擊「⚙️ API 設定」標籤
3. 修改 API 網址為您的後端網址
4. 系統會自動儲存

### 方法 3：修改 config.js

編輯 `config.js` 檔案中的 `production.apiUrl`：

```javascript
production: {
    apiUrl: 'https://your-backend-server.com/api',
    uploadUrl: 'https://your-backend-server.com/api/upload'
}
```

---

## 📁 前端部署

### 選項 A：GitHub Pages（免費）

1. 推送專案到 GitHub
2. Settings → Pages → Source 選擇 main 分支
3. 訪問 `https://yourusername.github.io/repo-name`

**注意：** GitHub Pages 只能部署靜態檔案，後端需要單獨部署

### 選項 B：Netlify / Vercel（推薦）

1. 連接 GitHub 倉庫
2. 設定建置命令（通常不需要）
3. 發布目錄設定為專案根目錄
4. 部署完成

### 選項 C：傳統主機（FTP 上傳）

1. 上傳所有前端檔案（HTML, CSS, JS）
2. 確保檔案結構正確
3. 訪問您的網域即可

---

## 🔐 資料庫和圖片儲存

### SQLite 資料庫

- **本地開發**：`properties.db` 檔案在專案資料夾
- **生產環境**：需要確保伺服器有寫入權限

**建議：** 生產環境考慮使用 PostgreSQL 或 MySQL

### 圖片儲存

- **本地開發**：`uploads/` 資料夾
- **生產環境**：需要確保有寫入權限

**建議：** 
- 使用雲端儲存（AWS S3、Cloudinary、Firebase Storage）
- 或使用 CDN 服務

---

## ⚙️ 修改 server.js 支援生產環境

如果需要修改後端配置：

```javascript
// server.js
const PORT = process.env.PORT || 3000;
const HOST = process.env.HOST || '0.0.0.0'; // 允許外部訪問

app.listen(PORT, HOST, () => {
    console.log(`伺服器運行在 ${HOST}:${PORT}`);
});
```

---

## 🔒 安全性設定

### 1. CORS 設定

在 `server.js` 中設定允許的網域：

```javascript
const cors = require('cors');

app.use(cors({
    origin: [
        'http://localhost:3000', // 本地開發
        'https://yourdomain.com', // 生產環境
        'https://www.yourdomain.com'
    ],
    credentials: true
}));
```

### 2. 環境變數

建立 `.env` 檔案（不要提交到 Git）：

```
NODE_ENV=production
PORT=3000
DATABASE_URL=./properties.db
UPLOAD_DIR=./uploads
```

---

## 📊 部署架構建議

### 架構 1：同網域部署（最簡單）

```
https://yourdomain.com/          → 前端（index.html）
https://yourdomain.com/api/      → 後端 API
https://yourdomain.com/uploads/  → 圖片檔案
```

### 架構 2：分離部署（推薦）

```
https://yourdomain.com/                    → 前端
https://api.yourdomain.com/                → 後端 API
https://cdn.yourdomain.com/uploads/        → CDN 圖片
```

---

## 🧪 測試部署

部署完成後，測試：

1. **前端頁面**：訪問您的網域，確認頁面正常顯示
2. **API 連接**：打開開發者工具，檢查 Console 是否有錯誤
3. **資料載入**：確認物件列表能正常載入
4. **圖片上傳**：測試上傳功能是否正常
5. **新增物件**：測試完整的新增流程

---

## 🔧 故障排除

### 問題 1：API 連接失敗

**解決：**
- 檢查後端是否正常運行
- 檢查 CORS 設定
- 確認 API URL 設定正確

### 問題 2：圖片無法顯示

**解決：**
- 檢查 `uploads/` 資料夾權限
- 確認圖片 URL 路徑正確
- 檢查伺服器靜態檔案設定

### 問題 3：資料庫錯誤

**解決：**
- 確認資料庫檔案權限
- 檢查資料庫檔案是否存在
- 查看伺服器日誌

---

## 📝 檢查清單

- [ ] 後端已部署並正常運行
- [ ] API URL 已正確設定
- [ ] CORS 已設定允許的網域
- [ ] 資料庫有寫入權限
- [ ] 圖片上傳資料夾有寫入權限
- [ ] 前端能正常連接後端
- [ ] 所有功能測試通過

---

## 💡 建議

1. **使用環境變數**管理不同環境的設定
2. **定期備份**資料庫和圖片
3. **監控**伺服器狀態和錯誤日誌
4. **使用 HTTPS**保護資料傳輸
5. **設定防火牆**限制不必要的訪問
